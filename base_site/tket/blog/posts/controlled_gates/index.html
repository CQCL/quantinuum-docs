<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" />

    <!-- Generated with Sphinx 8.2.1 and Furo 2024.08.06 -->
        <title>Improved Controlled Gates in pytket - TKET Developer Blog</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=edea75bb" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../"><div class="brand">TKET Developer Blog</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="improved-controlled-gates-in-pytket">
<h1>Improved Controlled Gates in pytket<a class="headerlink" href="#improved-controlled-gates-in-pytket" title="Link to this heading">¶</a></h1>
<p>Last week brought a new pytket 1.21.0 release! See the <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/changelog.html#october-2023">changelog</a> for a rundown of all the new features and fixes. This blog will focus on improvements to controlled gates in pytket with the new <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.ConjugationBox">ConjugationBox</a> feature enabling some key circuit primitives to be implemented far more efficiently. There are also some improvements to how controlled gates are displayed in the circuit renderer.</p>
<section id="examples-of-controlled-gates">
<h2>Examples of Controlled Gates<a class="headerlink" href="#examples-of-controlled-gates" title="Link to this heading">¶</a></h2>
<p>Controlled gates show up all the time in quantum computing. These gates modify a target qubit depending on the state of a control qubit (or a set of control qubits).</p>
<p>Two commonly used controlled gates are the CX (or CNOT) gate and the CCZ gate.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p>CX</p></th>
<th class="head text-center"><p>CCZ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="" src="../../_images/CX.png" /></p></td>
<td class="text-center"><p><img alt="" src="../../_images/CCZ.png" /></p></td>
</tr>
</tbody>
</table>
</div>
<p>As you probably know, the action of the CX gate is to apply a X operation to flip the state of a target qubit if its control qubit is in the <span class="math notranslate nohighlight">\(|1\rangle\)</span> state. If the control qubit is not in the <span class="math notranslate nohighlight">\(|1\rangle\)</span> state then this gate acts as the identity gate.</p>
<p>We can understand the action of the CX gate on a two qubit state by looking at its truth table. The CX gate has the following action on the two qubit computational basis states.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Input State</p></th>
<th class="head"><p>Output State</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>00</p></td>
<td><p>00</p></td>
</tr>
<tr class="row-odd"><td><p>01</p></td>
<td><p>01</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>10</p></td>
</tr>
</tbody>
</table>
</div>
<p>The action of the CCZ gate shown above is to add a phase of <span class="math notranslate nohighlight">\(-1\)</span> if both control qubits are in the <span class="math notranslate nohighlight">\(|1\rangle\)</span> state. So if the combined state of both controls is <span class="math notranslate nohighlight">\(|11\rangle\)</span>, then a Pauli Z operation is applied to the target qubit.</p>
</section>
<section id="some-terminology">
<h2>Some Terminology<a class="headerlink" href="#some-terminology" title="Link to this heading">¶</a></h2>
<p><strong>Control state:</strong> The state that the control qubits must be in for the operation to be applied to the target. Typically we assume that the control state is “all <span class="math notranslate nohighlight">\(|1\rangle\)</span>” unless specified otherwise. However this need not be the case. In general the control state can be any string of <span class="math notranslate nohighlight">\(|0\rangle\)</span> and <span class="math notranslate nohighlight">\(|1\rangle\)</span>.</p>
<p><strong>Base gate:</strong> The operation that is applied to the target qubit(s) when the control qubits are in the control state. So for the CCZ gate above the control state is <span class="math notranslate nohighlight">\(|11\rangle\)</span> and the base gate is the Pauli <span class="math notranslate nohighlight">\(Z\)</span> operation.</p>
<p><strong>Conjugation pattern:</strong> We say that a unitary operation <span class="math notranslate nohighlight">\(U_c\)</span> fits the conjugation pattern if it can be expressed as follows</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
U_{c} = V \, A \, V^\dagger \, .
\end{equation}
\]</div>
</div>
<p>This compute (<span class="math notranslate nohighlight">\(V\)</span>), action (<span class="math notranslate nohighlight">\(A\)</span>), uncompute (<span class="math notranslate nohighlight">\(V^\dagger\)</span>) pattern occurs frequently in quantum computing. This pattern is captured by the new <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code> construct in pytket.</p>
<p>In pytket <code class="docutils literal notranslate"><span class="pre">1.21.0</span></code> we can find much smarter decompositions for controlled gates where the base gate fits the conjugation pattern <span class="math notranslate nohighlight">\(V \, A \, V^\dagger\)</span>. The trick here is that to construct a controlled <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code> you only have to control on the central <span class="math notranslate nohighlight">\(A\)</span> operation rather than every single gate in the circuit.</p>
</section>
<section id="an-example-using-pauli-gadgets">
<h2>An Example Using Pauli Gadgets<a class="headerlink" href="#an-example-using-pauli-gadgets" title="Link to this heading">¶</a></h2>
<p>Shown below is an example of a Pauli gadget circuit. This is a great example of a common circuit primitive that fits the conjugation pattern <span class="math notranslate nohighlight">\(V \, A \, V^\dagger\)</span>.</p>
<p><img alt="" class="align-center" src="../../_images/Pauli_gadget.png" /></p>
<p>This circuit implements a unitary of the form <span class="math notranslate nohighlight">\( U = e^{-i \frac{\pi}{2} \theta P}\)</span> where <span class="math notranslate nohighlight">\(\theta = 0.7\)</span> and <span class="math notranslate nohighlight">\(P\)</span> is a tensor product of Pauli operators.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
P = Z \otimes Z \otimes Y \otimes X 
\end{equation}
\]</div>
</div>
<p>This type of operation shows up very naturally in quantum chemistry when trotterising Hamiltonians. Readers familiar with the quantum phase estimation algorithm (QPE) may know that QPE requires many controlled unitary operations to implement. Often the unitary will be a time evolved Hamiltonian represented by a Pauli gadget. So being able to implement these controlled unitaries efficiently could reduce the complexity of the circuit needed for QPE.</p>
<p>In addition to having the form of a conjugation pattern, Pauli gadget circuits have some cool algebraic properties that can be exploited for circuit optimisation [<a class="reference internal" href="#references"><span class="xref myst">1</span></a>].</p>
<p>Now if we squint at the circuit diagram above, we see that it’s almost symmetric around the central Rz rotation. In fact, the left hand side of the Rz gate is exactly the dagger of the right hand side. If we identify the central Rz gate as the action <span class="math notranslate nohighlight">\(A\)</span> then it is clear that the subcircuits to the left and right hand side of <span class="math notranslate nohighlight">\(A\)</span> can be identified with <span class="math notranslate nohighlight">\( V\)</span> and <span class="math notranslate nohighlight">\(V^\dagger\)</span>.</p>
<p>Since all Pauli gadget circuits are in the form of a <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code>, it is sufficient to simply control on the central Rz operation like so.</p>
<p><img alt="" class="align-center" src="../../_images/controlled_pauliZZYX.png" /></p>
<p>Let’s now construct a circuit for this Pauli gadget using pytket’s <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> construction. More information on <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> can be found in the <a class="reference internal" href="#../user-guide/manual/manual_circuit.html#pauli-exponential-boxes"><span class="xref myst">user manual</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.pauli</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pauli</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">PauliExpBox</span>

<span class="n">zzyx_box</span> <span class="o">=</span> <span class="n">PauliExpBox</span><span class="p">([</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">],</span> <span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can construct a controlled <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> using <code class="docutils literal notranslate"><span class="pre">QControlBox</span></code>. A <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> is now handled internally as a <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code> so the controlled operation can be done much more efficiently.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">QControlBox</span>

<span class="c1"># A controlled PauliExpBox with a single control (n=1)</span>
<span class="n">controlled_zzyx</span> <span class="o">=</span> <span class="n">QControlBox</span><span class="p">(</span><span class="n">zzyx_box</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have our constructed our controlled unitary, we can do a comparison between pytket versions to highlight the benefit on the <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code>.</p>
<p>Let’s run the code below with pytket 1.20.1 and pytket 1.21 and compare the number of gates required to implement this controlled Pauli gadget. We will decompose the boxes and compile the circuit down to one and two qubit gates with the <code class="docutils literal notranslate"><span class="pre">SynthesiseTK</span></code> pass to ensure a fair comparison.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.passes</span><span class="w"> </span><span class="kn">import</span> <span class="n">DecomposeBoxes</span><span class="p">,</span> <span class="n">SynthesiseTK</span>

<span class="n">test_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">test_circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">controlled_zzyx</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">DecomposeBoxes</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_circ</span><span class="p">)</span>
<span class="n">SynthesiseTK</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_circ</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total gate count:&quot;</span><span class="p">,</span> <span class="n">test_circ</span><span class="o">.</span><span class="n">n_gates</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 qubit gates:&quot;</span><span class="p">,</span> <span class="n">test_circ</span><span class="o">.</span><span class="n">n_2qb_gates</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>pytket 1.20.1</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">gate</span> <span class="n">count</span><span class="p">:</span> <span class="mi">103</span>
<span class="mi">2</span> <span class="n">qubit</span> <span class="n">gates</span><span class="p">:</span> <span class="mi">44</span>
</pre></div>
</div>
<p><strong>pytket 1.21.0</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">gate</span> <span class="n">count</span><span class="p">:</span> <span class="mi">22</span>
<span class="mi">2</span> <span class="n">qubit</span> <span class="n">gates</span><span class="p">:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Now that’s a big difference! We see pytket 1.21.0 is able to use the underlying <code class="docutils literal notranslate"><span class="pre">ConjuagtionBox</span></code> structure of the Pauli gadget to find a far more efficient implementation.</p>
<p>The improvement in the number of two qubit entangling gates is particularly nice when we think about running circuits on real quantum hardware. Entangling gates are in general much more noisy than single qubit gates so getting rid of them where possible can be great for boosting the fidelity of our computation.</p>
<p>The reason for the reduction is that pytket 1.21.0 can simply control on the single Rz in the Pauli gadget. Previously if we wanted to construct a controlled Pauli gadget, pytket would naively construct a controlled version of every single gate in the base Pauli gadget circuit. In version 1.20.1, pytket naively converts all of the CX gates to CCX gates and then has to compile those down to one and two qubit gates with a significant overhead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have shown how we can compile controlled Pauli gadget circuits by making use of the conjugation pattern. This is now logic internal to pytket.</p>
<p>You can also define your own <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.ConjugationBox">ConjugationBox</a> by providing a <code class="docutils literal notranslate"><span class="pre">compute</span></code>, <code class="docutils literal notranslate"><span class="pre">action</span></code> and <code class="docutils literal notranslate"><span class="pre">uncompute</span></code> operation. Can you think of other cases where this construct would be useful?</p>
</div>
</section>
<section id="some-mathematical-details">
<h2>Some Mathematical Details<a class="headerlink" href="#some-mathematical-details" title="Link to this heading">¶</a></h2>
<p>So why does this work?</p>
<p>Here we will show that if we have a controlled gate whose base gates fits the <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code> pattern then it is only necessary to control on the central <span class="math notranslate nohighlight">\(A\)</span> operation.</p>
<p>Recall the the form of the conjugation pattern</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
U_c = V \, A \, V^\dagger \, .
\end{equation}
\]</div>
</div>
<p>To avoid ambiguity in what follows we will denote a controlled-<span class="math notranslate nohighlight">\(P\)</span> operation as <span class="math notranslate nohighlight">\(C[P]\)</span> where <span class="math notranslate nohighlight">\(P\)</span> is some unitary operator.</p>
<p>Now we want to show that</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
C[U_c] = C[V \, A \, V^\dagger] = (I \otimes V) C[A] (I \otimes V^\dagger)\, .
\end{equation}
\]</div>
</div>
<p>A controlled-<span class="math notranslate nohighlight">\(P\)</span> operation can be expanded out as follows</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
C[P]= |0\rangle\langle 0| \otimes I + |1\rangle\langle1| \otimes P \, .
\end{equation}
\]</div>
</div>
<p>To prove our result let’s take the right hand side of our target equation and expand the <span class="math notranslate nohighlight">\(C[A]\)</span> term.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
(I \otimes V) C[A] (I \otimes V^\dagger) &amp;= (I \otimes V ) \,( |0\rangle\langle 0| \otimes I + |1\rangle\langle1| \otimes A )\, (I \otimes V^\dagger) \\
&amp;= |0\rangle\langle 0| \otimes \cancelto{I}{V \, I \, V^\dagger} + |1\rangle\langle1| \otimes V \, A \, V^\dagger \\
\implies (I \otimes V) C[A] (I \otimes V^\dagger) &amp;= |0\rangle\langle 0| \otimes I + |1\rangle\langle1| \otimes U_c = C[U_c]
\end{align}
\end{split}\]</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>A. Cowtan, S. Dilkes, R. Duncan, W. Simmons, and
S. Sivarajah, “Phase gadget synthesis for shallow circuits,” in 16th International Conference on Quantum
Physics and Logic 2019. Open Publishing Association,
2019, pp. 213–228</p></li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Improved Controlled Gates in pytket</a><ul>
<li><a class="reference internal" href="#examples-of-controlled-gates">Examples of Controlled Gates</a></li>
<li><a class="reference internal" href="#some-terminology">Some Terminology</a></li>
<li><a class="reference internal" href="#an-example-using-pauli-gadgets">An Example Using Pauli Gadgets</a></li>
<li><a class="reference internal" href="#some-mathematical-details">Some Mathematical Details</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>