<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Binary classification using pytket-qujax" href="pytket-qujax-classification.html" /><link rel="prev" title="Advanced expectation values and measurement reduction" href="measurement_reduction_example.html" />

    <link rel="shortcut icon" href="../../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Quantum Phase Estimation - pytket user guide</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pytket user guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">pytket user guide</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_intro.html">What is tket?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_circuit.html">Circuit Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_backend.html">Running on Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_compiler.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_noise.html">Noise and the Quantum Circuit Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_assertion.html">Assertion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_zx.html">ZX Diagrams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_analysis_example.html">Circuit analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_generation_example.html">Circuit generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/conditional_gate_example.html">Conditional gates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/backends_example.html">TKET <code class="docutils literal notranslate"><span class="pre">Backend</span></code> tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/comparing_simulators.html">Comparison of the simulators available through TKET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/creating_backends.html">How to create your own <code class="docutils literal notranslate"><span class="pre">Backend</span></code> using <code class="docutils literal notranslate"><span class="pre">pytket</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/qiskit_integration.html">Integrating <code class="docutils literal notranslate"><span class="pre">pytket</span></code> into Qiskit software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/compilation_example.html">Compilation passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/contextual_optimisation.html">Contextual optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/mapping_example.html">Qubit mapping and routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/symbolics_example.html">Symbolic compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ansatz_sequence_example.html">Ansatz sequencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="entanglement_swapping.html">Iterated entanglement swapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="expectation_value_example.html">Expectation values</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_reduction_example.html">Advanced expectation values and measurement reduction</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Quantum Phase Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax-classification.html">Binary classification using <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_heisenberg_vqe.html">VQE example with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_qaoa.html">Symbolic circuits with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ucc_vqe.html">VQE with UCC ansatz</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/examples/algorithms_and_protocols/phase_estimation.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="quantum-phase-estimation">
<h1>Quantum Phase Estimation<a class="headerlink" href="#quantum-phase-estimation" title="Link to this heading">¶</a></h1>
<p><strong>Download this notebook - <a class="reference download internal" download="" href="../../_downloads/c5fa4aaa4c34a6e7c048d6e426ba4e37/phase_estimation.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">phase_estimation.ipynb</span></code></a></strong></p>
<p>When constructing circuits for quantum algorithms it is useful to think of higher level operations than just individual quantum gates. In <code class="docutils literal notranslate"><span class="pre">pytket</span></code> we can construct circuits using box structures which abstract away the complexity of the underlying circuit. This notebook is intended to complement the <a class="reference external" href="https://docs.quantinuum.com/tket/user-guide/manual/manual_circuit.html#boxes">boxes section</a> of the user manual which introduces the different box types.</p>
<p>To demonstrate boxes in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> we will consider the Quantum Phase Estimation algorithm (QPE). This is an important subroutine in several quantum algorithms including Shor’s algorithm and fault-tolerant approaches to quantum chemistry.</p>
<section id="overview-of-phase-estimation">
<h2>Overview of Phase Estimation<a class="headerlink" href="#overview-of-phase-estimation" title="Link to this heading">¶</a></h2>
<p>The Quantum Phase Estimation algorithm can be used to estimate the eigenvalues of some unitary operator <span class="math notranslate nohighlight">\(U\)</span> to some desired precision.</p>
<p>The eigenvalues of <span class="math notranslate nohighlight">\(U\)</span> lie on the unit circle, giving us the following eigenvalue equation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
U |\psi \rangle = e^{2 \pi i \theta} |\psi\rangle\,, \quad 0 \leq \theta \leq 1
\end{equation}
\]</div>
</div>
<p>Here <span class="math notranslate nohighlight">\(|\psi \rangle\)</span> is an eigenstate of the operator <span class="math notranslate nohighlight">\(U\)</span>. In phase estimation we estimate the eigenvalue <span class="math notranslate nohighlight">\(e^{2 \pi i \theta}\)</span> by approximating <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>The circuit for Quantum phase estimation is itself composed of several subroutines which we can realise as circuit boxes.</p>
<p><img alt="" class="align-center" src="../../_images/qpe_circuit.png" /></p>
<p>QPE is generally split up into three stages</p>
<ol class="arabic simple">
<li><p>Firstly we prepare an initial state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> in one register. In parallel we prepare a uniform superposition state using Hadamard gates on some ancilla (measurement) qubits. The number of ancilla qubits determines how precisely we can estimate the phase <span class="math notranslate nohighlight">\(\theta\)</span>.</p></li>
<li><p>Secondly we apply successive controlled <span class="math notranslate nohighlight">\(U\)</span> gates. This has the effect of “kicking back” phases onto the ancilla qubits according to the eigenvalue equation above.</p></li>
<li><p>Finally we apply the inverse Quantum Fourier Transform  (<span class="math notranslate nohighlight">\(QFT^\dagger\)</span>). This essentially plays the role of destructive interference, suppressing amplitudes from “undesirable states” and hopefully allowing us to measure a single outcome (or a small number of outcomes) with high probability.</p></li>
</ol>
<p>There is some subtlety around the first point. The initial state used can be an exact eigenstate of <span class="math notranslate nohighlight">\(U\)</span> however this may be difficult to prepare if we don’t know the eigenvalues of  <span class="math notranslate nohighlight">\(U\)</span> in advance. Alternatively we could use an initial state that is a linear combination of eigenstates, as the phase estimation will project into the eigenspace of <span class="math notranslate nohighlight">\(U\)</span>.</p>
<p>We also assume that we can implement <span class="math notranslate nohighlight">\(U\)</span> with a quantum circuit. In chemistry applications <span class="math notranslate nohighlight">\(U\)</span> could be of the form <span class="math notranslate nohighlight">\(U=e^{-iHt}\)</span> where <span class="math notranslate nohighlight">\(H\)</span> is the Hamiltonian of some system of interest. In the textbook algorithm, the number of controlled unitaries we apply scales exponentially with the number of measurement qubits. This allows more precision at the expense of a larger quantum circuit.</p>
</section>
<section id="the-quantum-fourier-transform">
<h2>The Quantum Fourier Transform<a class="headerlink" href="#the-quantum-fourier-transform" title="Link to this heading">¶</a></h2>
<p>Before considering the other parts of the QPE algorithm, lets focus on the Quantum Fourier Transform (QFT) subroutine.</p>
<p>Mathematically, the QFT has the following action.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
QFT : |j\rangle\ \longmapsto \frac{1}{\sqrt{N}} \sum_{k=0}^{N - 1} e^{2 \pi ijk/N}|k\rangle, \quad N= 2^n
\end{equation}
\]</div>
</div>
<p>This is essentially the Discrete Fourier transform except the input is a quantum state <span class="math notranslate nohighlight">\(|j\rangle\)</span>.</p>
<p>We can build the circuit for the <span class="math notranslate nohighlight">\(n\)</span> qubit QFT using <span class="math notranslate nohighlight">\(n\)</span> Hadamard gates <span class="math notranslate nohighlight">\(\lfloor{\frac{n}{2}}\rfloor\)</span> swap gates and <span class="math notranslate nohighlight">\(\frac{n(n-1)}{2}\)</span> controlled unitary rotations <span class="math notranslate nohighlight">\(\text{CU1}\)</span>.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}
 \begin{equation}
U1(\phi) =
 \begin{pmatrix}
 1 &amp; 0 \\
 0 &amp; e^{i \pi \phi}
 \end{pmatrix}\, , \quad
 CU1(\phi) =
 \begin{pmatrix}
 1 &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; 1 &amp; 0 &amp; 0 \\
 0 &amp; 0 &amp; 1 &amp; 0 \\
 0 &amp; 0 &amp; 0 &amp; e^{i \pi \phi}
 \end{pmatrix}
 \end{equation}
\end{split}\]</div>
</div>
<p>The circuit for the Quantum Fourier transform on three qubits is the following</p>
<p><img alt="" class="align-center" src="../../_images/qft.png" /></p>
<p>We can build this circuit in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> by adding gate operations manually:</p>
<p>lets build the QFT for three qubits</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">Circuit</span>
<span class="kn">from</span> <span class="nn">pytket.circuit.display</span> <span class="kn">import</span> <span class="n">render_circuit_jupyter</span> <span class="k">as</span> <span class="n">draw</span>

<span class="n">qft3_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">CU1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">CU1</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">CU1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qft3_circ</span><span class="o">.</span><span class="n">SWAP</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">draw</span><span class="p">(</span><span class="n">qft3_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div style="resize: vertical; overflow: auto; height: 400px; display: block">
    <iframe srcdoc="
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34;&gt;
    &lt;!-- Download Vue 3--&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://cdn.jsdelivr.net/npm/vue@3&#34;&gt;&lt;/script&gt;
&lt;!-- Download Circuit Renderer with styles --&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.umd.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.css&#34;&gt;
&lt;/head&gt;
&lt;body&gt;


    &lt;div id=&#34;circuit-display-vue-container-08018aca-44be-4d40-b6d2-34c3d59910c6&#34; class=&#34;pytket-circuit-display-container&#34;&gt;
        &lt;div style=&#34;display: none&#34;&gt;
            &lt;div id=&#34;circuit-json-to-display&#34;&gt;{&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]]], &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]]]}&lt;/div&gt;
        &lt;/div&gt;
        &lt;circuit-display-container
                :circuit-element-str=&#34;&#39;#circuit-json-to-display&#39;&#34;
                :init-render-options=&#34;initRenderOptions&#34;
                view-format=&#34;None&#34;
        &gt;&lt;/circuit-display-container&gt;
    &lt;/div&gt;
    &lt;script type=&#34;application/javascript&#34;&gt;
      const circuitRendererUid = &#34;08018aca-44be-4d40-b6d2-34c3d59910c6&#34;;
      const displayOptions = JSON.parse(&#39;{}&#39;);

      // Script to initialise the circuit renderer app

const { createApp } = Vue;
const circuitDisplayContainer = window[&#34;pytket-circuit-renderer&#34;].default;
// Init variables to be shared between circuit display instances
if (typeof window.pytketCircuitDisplays === &#34;undefined&#34;) {
    window.pytketCircuitDisplays = {};
}
// Create the root Vue component
const app = createApp({
    delimiters: [&#39;[[#&#39;, &#39;#]]&#39;],
    components: { circuitDisplayContainer },
    data () {
      return {
        initRenderOptions: displayOptions,
      }
    }
})
app.config.unwrapInjectedRef = true;
app.mount(&#34;#circuit-display-vue-container-&#34;+circuitRendererUid);
window.pytketCircuitDisplays[circuitRendererUid] = app;
    &lt;/script&gt;



&lt;/body&gt;
&lt;/html&gt;
"
            width="100%" height="100%"
            style="border: none; outline: none; overflow: auto"></iframe>
</div>

</div></div>
</div>
<p>We can generalise the quantum Fourier transform to <span class="math notranslate nohighlight">\(n\)</span> qubits by iterating over the qubits as follows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_qft_circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Circuit</span><span class="p">:</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;$$QFT$$&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_qubits</span><span class="p">):</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">CU1</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">),</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_qubits</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">SWAP</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_qubits</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circ</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qft4_circ</span><span class="p">:</span> <span class="n">Circuit</span> <span class="o">=</span> <span class="n">build_qft_circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">draw</span><span class="p">(</span><span class="n">qft4_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div style="resize: vertical; overflow: auto; height: 400px; display: block">
    <iframe srcdoc="
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34;&gt;
    &lt;!-- Download Vue 3--&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://cdn.jsdelivr.net/npm/vue@3&#34;&gt;&lt;/script&gt;
&lt;!-- Download Circuit Renderer with styles --&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.umd.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.css&#34;&gt;
&lt;/head&gt;
&lt;body&gt;


    &lt;div id=&#34;circuit-display-vue-container-5b0cbb6f-85a5-4880-a5da-a01bd2ba787f&#34; class=&#34;pytket-circuit-display-container&#34;&gt;
        &lt;div style=&#34;display: none&#34;&gt;
            &lt;div id=&#34;circuit-json-to-display&#34;&gt;{&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.125&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;name&#34;: &#34;$$QFT$$&#34;, &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}&lt;/div&gt;
        &lt;/div&gt;
        &lt;circuit-display-container
                :circuit-element-str=&#34;&#39;#circuit-json-to-display&#39;&#34;
                :init-render-options=&#34;initRenderOptions&#34;
                view-format=&#34;None&#34;
        &gt;&lt;/circuit-display-container&gt;
    &lt;/div&gt;
    &lt;script type=&#34;application/javascript&#34;&gt;
      const circuitRendererUid = &#34;5b0cbb6f-85a5-4880-a5da-a01bd2ba787f&#34;;
      const displayOptions = JSON.parse(&#39;{}&#39;);

      // Script to initialise the circuit renderer app

const { createApp } = Vue;
const circuitDisplayContainer = window[&#34;pytket-circuit-renderer&#34;].default;
// Init variables to be shared between circuit display instances
if (typeof window.pytketCircuitDisplays === &#34;undefined&#34;) {
    window.pytketCircuitDisplays = {};
}
// Create the root Vue component
const app = createApp({
    delimiters: [&#39;[[#&#39;, &#39;#]]&#39;],
    components: { circuitDisplayContainer },
    data () {
      return {
        initRenderOptions: displayOptions,
      }
    }
})
app.config.unwrapInjectedRef = true;
app.mount(&#34;#circuit-display-vue-container-&#34;+circuitRendererUid);
window.pytketCircuitDisplays[circuitRendererUid] = app;
    &lt;/script&gt;



&lt;/body&gt;
&lt;/html&gt;
"
            width="100%" height="100%"
            style="border: none; outline: none; overflow: auto"></iframe>
</div>

</div></div>
</div>
<p>Now that we have the generalised circuit we can wrap it up in a <code class="docutils literal notranslate"><span class="pre">CircBox</span></code> which can then be added to another circuit as a subroutine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">CircBox</span>

<span class="n">qft4_box</span><span class="p">:</span> <span class="n">CircBox</span> <span class="o">=</span> <span class="n">CircBox</span><span class="p">(</span><span class="n">qft4_circ</span><span class="p">)</span>
<span class="n">qft_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">qft4_box</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">draw</span><span class="p">(</span><span class="n">qft_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div style="resize: vertical; overflow: auto; height: 400px; display: block">
    <iframe srcdoc="
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34;&gt;
    &lt;!-- Download Vue 3--&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://cdn.jsdelivr.net/npm/vue@3&#34;&gt;&lt;/script&gt;
&lt;!-- Download Circuit Renderer with styles --&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.umd.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.css&#34;&gt;
&lt;/head&gt;
&lt;body&gt;


    &lt;div id=&#34;circuit-display-vue-container-0b6fa5cf-7b37-4104-b2aa-2671049073d1&#34; class=&#34;pytket-circuit-display-container&#34;&gt;
        &lt;div style=&#34;display: none&#34;&gt;
            &lt;div id=&#34;circuit-json-to-display&#34;&gt;{&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;box&#34;: {&#34;circuit&#34;: {&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.125&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;params&#34;: [&#34;0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;name&#34;: &#34;$$QFT$$&#34;, &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}, &#34;id&#34;: &#34;a3653f8b-7e1b-4187-ab17-aa59af2d0197&#34;, &#34;type&#34;: &#34;CircBox&#34;}, &#34;type&#34;: &#34;CircBox&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}&lt;/div&gt;
        &lt;/div&gt;
        &lt;circuit-display-container
                :circuit-element-str=&#34;&#39;#circuit-json-to-display&#39;&#34;
                :init-render-options=&#34;initRenderOptions&#34;
                view-format=&#34;None&#34;
        &gt;&lt;/circuit-display-container&gt;
    &lt;/div&gt;
    &lt;script type=&#34;application/javascript&#34;&gt;
      const circuitRendererUid = &#34;0b6fa5cf-7b37-4104-b2aa-2671049073d1&#34;;
      const displayOptions = JSON.parse(&#39;{}&#39;);

      // Script to initialise the circuit renderer app

const { createApp } = Vue;
const circuitDisplayContainer = window[&#34;pytket-circuit-renderer&#34;].default;
// Init variables to be shared between circuit display instances
if (typeof window.pytketCircuitDisplays === &#34;undefined&#34;) {
    window.pytketCircuitDisplays = {};
}
// Create the root Vue component
const app = createApp({
    delimiters: [&#39;[[#&#39;, &#39;#]]&#39;],
    components: { circuitDisplayContainer },
    data () {
      return {
        initRenderOptions: displayOptions,
      }
    }
})
app.config.unwrapInjectedRef = true;
app.mount(&#34;#circuit-display-vue-container-&#34;+circuitRendererUid);
window.pytketCircuitDisplays[circuitRendererUid] = app;
    &lt;/script&gt;



&lt;/body&gt;
&lt;/html&gt;
"
            width="100%" height="100%"
            style="border: none; outline: none; overflow: auto"></iframe>
</div>

</div></div>
</div>
<p>Note how the <code class="docutils literal notranslate"><span class="pre">CircBox</span></code> inherits the name <code class="docutils literal notranslate"><span class="pre">QFT</span></code> from the underlying circuit.</p>
<p>Recall that in our phase estimation algorithm we need to use the inverse QFT.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
\text{QFT}^† : \frac{1}{\sqrt{N}} \sum_{k=0}^{N - 1} e^{2 \pi ijk/N}|k\rangle \longmapsto |j\rangle\,, \quad N= 2^n
\end{equation}
\]</div>
</div>
<p>Now that we have the QFT circuit we can obtain the inverse by using <code class="docutils literal notranslate"><span class="pre">CircBox.dagger</span></code>. We can also verify that this is correct by inspecting the circuit inside with <code class="docutils literal notranslate"><span class="pre">CircBox.get_circuit()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inv_qft4_box</span> <span class="o">=</span> <span class="n">qft4_box</span><span class="o">.</span><span class="n">dagger</span>
<span class="c1"># Explicitly set the name of the `CircBox` to $$QFT^\dagger$$</span>
<span class="n">inv_qft4_box</span><span class="o">.</span><span class="n">circuit_name</span> <span class="o">=</span> <span class="s2">&quot;$$QFT^\dagger$$&quot;</span>
<span class="n">qft_inv_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qft_inv_circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">inv_qft4_box</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">draw</span><span class="p">(</span><span class="n">qft_inv_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div style="resize: vertical; overflow: auto; height: 400px; display: block">
    <iframe srcdoc="
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34;&gt;
    &lt;!-- Download Vue 3--&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://cdn.jsdelivr.net/npm/vue@3&#34;&gt;&lt;/script&gt;
&lt;!-- Download Circuit Renderer with styles --&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.umd.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.css&#34;&gt;
&lt;/head&gt;
&lt;body&gt;


    &lt;div id=&#34;circuit-display-vue-container-3d2dd858-81c1-49f9-b548-72afd6a09631&#34; class=&#34;pytket-circuit-display-container&#34;&gt;
        &lt;div style=&#34;display: none&#34;&gt;
            &lt;div id=&#34;circuit-json-to-display&#34;&gt;{&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;box&#34;: {&#34;circuit&#34;: {&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.125&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;name&#34;: &#34;$$QFT^\\dagger$$&#34;, &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}, &#34;id&#34;: &#34;603cbaf7-bc16-4def-9cc6-19106e3dfe2b&#34;, &#34;type&#34;: &#34;CircBox&#34;}, &#34;type&#34;: &#34;CircBox&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}&lt;/div&gt;
        &lt;/div&gt;
        &lt;circuit-display-container
                :circuit-element-str=&#34;&#39;#circuit-json-to-display&#39;&#34;
                :init-render-options=&#34;initRenderOptions&#34;
                view-format=&#34;None&#34;
        &gt;&lt;/circuit-display-container&gt;
    &lt;/div&gt;
    &lt;script type=&#34;application/javascript&#34;&gt;
      const circuitRendererUid = &#34;3d2dd858-81c1-49f9-b548-72afd6a09631&#34;;
      const displayOptions = JSON.parse(&#39;{}&#39;);

      // Script to initialise the circuit renderer app

const { createApp } = Vue;
const circuitDisplayContainer = window[&#34;pytket-circuit-renderer&#34;].default;
// Init variables to be shared between circuit display instances
if (typeof window.pytketCircuitDisplays === &#34;undefined&#34;) {
    window.pytketCircuitDisplays = {};
}
// Create the root Vue component
const app = createApp({
    delimiters: [&#39;[[#&#39;, &#39;#]]&#39;],
    components: { circuitDisplayContainer },
    data () {
      return {
        initRenderOptions: displayOptions,
      }
    }
})
app.config.unwrapInjectedRef = true;
app.mount(&#34;#circuit-display-vue-container-&#34;+circuitRendererUid);
window.pytketCircuitDisplays[circuitRendererUid] = app;
    &lt;/script&gt;



&lt;/body&gt;
&lt;/html&gt;
"
            width="100%" height="100%"
            style="border: none; outline: none; overflow: auto"></iframe>
</div>

</div></div>
</div>
</section>
<section id="building-the-phase-estimation-circuit">
<h2>Building the Phase Estimation Circuit<a class="headerlink" href="#building-the-phase-estimation-circuit" title="Link to this heading">¶</a></h2>
<p>We can now define a function to build our entire QPE circuit. We can make this function take a state preparation circuit and a unitary circuit as input as well. The function also has the number of measurement qubits as input which will determine the precision of our phase estimate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">QControlBox</span><span class="p">,</span> <span class="n">DiagonalBox</span>

<span class="k">def</span> <span class="nf">build_phase_estimation_circuit</span><span class="p">(</span>
    <span class="n">n_measurement_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_prep</span><span class="p">:</span> <span class="n">CircBox</span><span class="p">,</span> <span class="n">unitary</span><span class="p">:</span> <span class="n">CircBox</span> <span class="o">|</span> <span class="n">DiagonalBox</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Circuit</span><span class="p">:</span>

    <span class="c1"># Define a Circuit with a measurement and prep register</span>
    <span class="n">qpe_circ</span><span class="p">:</span> <span class="n">Circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
    <span class="n">n_state_prep_qubits</span> <span class="o">=</span> <span class="n">state_prep</span><span class="o">.</span><span class="n">n_qubits</span>
    <span class="n">measurement_register</span> <span class="o">=</span> <span class="n">qpe_circ</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">n_measurement_qubits</span><span class="p">)</span>
    <span class="n">state_prep_register</span> <span class="o">=</span> <span class="n">qpe_circ</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">n_state_prep_qubits</span><span class="p">)</span>
    <span class="n">qpe_circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">state_prep</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_prep_register</span><span class="p">))</span>

    <span class="c1"># If we have unitary as a CircBox, change name to U.</span>
    <span class="c1"># Not used in this example, just here for generality.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unitary</span><span class="p">,</span> <span class="n">CircBox</span><span class="p">):</span>
        <span class="n">unitary</span><span class="o">.</span><span class="n">circuit_name</span> <span class="o">=</span> <span class="s2">&quot;$$U$$&quot;</span>

    <span class="c1"># Create a controlled unitary with a single control qubit</span>
    <span class="n">controlled_u_gate</span> <span class="o">=</span> <span class="n">QControlBox</span><span class="p">(</span><span class="n">unitary</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Add Hadamard gates to every qubit in the measurement register</span>
    <span class="k">for</span> <span class="n">m_qubit</span> <span class="ow">in</span> <span class="n">measurement_register</span><span class="p">:</span>
        <span class="n">qpe_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">m_qubit</span><span class="p">)</span>

    <span class="c1"># Add all (2**n_measurement_qubits - 1) of the controlled unitaries sequentially</span>
    <span class="k">for</span> <span class="n">m_qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_measurement_qubits</span><span class="p">):</span>
        <span class="n">control_index</span> <span class="o">=</span> <span class="n">n_measurement_qubits</span> <span class="o">-</span> <span class="n">m_qubit</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">control_qubit</span> <span class="o">=</span> <span class="p">[</span><span class="n">measurement_register</span><span class="p">[</span><span class="n">control_index</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">m_qubit</span><span class="p">):</span>
            <span class="n">qpe_circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">controlled_u_gate</span><span class="p">,</span> <span class="n">control_qubit</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_prep_register</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># Finally, append the inverse qft and measure the qubits</span>
    <span class="n">qft_box</span> <span class="o">=</span> <span class="n">CircBox</span><span class="p">(</span><span class="n">build_qft_circuit</span><span class="p">(</span><span class="n">n_measurement_qubits</span><span class="p">))</span>
    <span class="n">inverse_qft_box</span> <span class="o">=</span> <span class="n">qft_box</span><span class="o">.</span><span class="n">dagger</span>
    <span class="n">inverse_qft_box</span><span class="o">.</span><span class="n">circuit_name</span> <span class="o">=</span> <span class="s2">&quot;$$QFT^{\dagger}$$&quot;</span>
    <span class="n">qpe_circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">inverse_qft_box</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">measurement_register</span><span class="p">))</span>
    <span class="n">qpe_circ</span><span class="o">.</span><span class="n">measure_register</span><span class="p">(</span><span class="n">measurement_register</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qpe_circ</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="phase-estimation-with-a-trivial-eigenstate">
<h2>Phase Estimation with a Trivial Eigenstate<a class="headerlink" href="#phase-estimation-with-a-trivial-eigenstate" title="Link to this heading">¶</a></h2>
<p>Lets test our circuit construction by preparing a trivial <span class="math notranslate nohighlight">\(|11\rangle\)</span> eigenstate of the diagonal <span class="math notranslate nohighlight">\(U\)</span> gate.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}
U = \begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; e^{ i \frac{\pi}{4}} &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; e^{ i \frac{\pi}{8}}
\end{pmatrix}
\end{split}\]</div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
U|11\rangle = e^{ i \frac{\pi}{8}}|11\rangle = e^{2 \pi i \theta} |11\rangle\implies \theta = \frac{1}{16}
\end{equation}
\]</div>
</div>
<p>We can easily prepare this <span class="math notranslate nohighlight">\(|11\rangle\)</span> eigenstate with two Pauli <span class="math notranslate nohighlight">\(X\)</span> gates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prep_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># prepare the |11&gt; eigenstate of D</span>
<span class="n">prep_circuit</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;$$P_{|\psi</span><span class="se">\\</span><span class="s2">rangle}$$&quot;</span>

<span class="n">prep_box</span> <span class="o">=</span> <span class="n">CircBox</span><span class="p">(</span><span class="n">prep_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally we can use the <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.DiagonalBox" title="Project name not set">DiagonalBox</a> to realise a circuit implementation of our operator <span class="math notranslate nohighlight">\(U\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">DiagonalBox</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">u_diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)])</span>
<span class="n">d_box</span> <span class="o">=</span> <span class="n">DiagonalBox</span><span class="p">(</span><span class="n">u_diagonal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have all of the pieces together we can build a phase estimation circuit to estimate the eigenvalues of <span class="math notranslate nohighlight">\(U\)</span> with four measurement qubits to estimate the phase.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qpe_circ_trivial</span> <span class="o">=</span> <span class="n">build_phase_estimation_circuit</span><span class="p">(</span>
    <span class="n">n_measurement_qubits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">state_prep</span><span class="o">=</span><span class="n">prep_box</span><span class="p">,</span> 
    <span class="n">unitary</span><span class="o">=</span><span class="n">d_box</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw</span><span class="p">(</span><span class="n">qpe_circ_trivial</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div style="resize: vertical; overflow: auto; height: 400px; display: block">
    <iframe srcdoc="
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34;&gt;
    &lt;!-- Download Vue 3--&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://cdn.jsdelivr.net/npm/vue@3&#34;&gt;&lt;/script&gt;
&lt;!-- Download Circuit Renderer with styles --&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.umd.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/pytket-circuit-renderer@0.10/dist/pytket-circuit-renderer.css&#34;&gt;
&lt;/head&gt;
&lt;body&gt;


    &lt;div id=&#34;circuit-display-vue-container-3c9a7857-59d4-42f0-a461-4722baab63d1&#34; class=&#34;pytket-circuit-display-container&#34;&gt;
        &lt;div style=&#34;display: none&#34;&gt;
            &lt;div id=&#34;circuit-json-to-display&#34;&gt;{&#34;bits&#34;: [[&#34;c&#34;, [0]], [&#34;c&#34;, [1]], [&#34;c&#34;, [2]], [&#34;c&#34;, [3]]], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;m&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;circuit&#34;: {&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;X&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;X&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]]], &#34;name&#34;: &#34;$$P_{|\\psi\\rangle}$$&#34;, &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]]]}, &#34;id&#34;: &#34;c5c54037-b820-452a-b4eb-cabbf11e5df0&#34;, &#34;type&#34;: &#34;CircBox&#34;}, &#34;type&#34;: &#34;CircBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [3]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [2]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [2]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]], &#34;op&#34;: {&#34;box&#34;: {&#34;control_state&#34;: 1, &#34;id&#34;: &#34;c20099d0-677f-478f-bf0f-430345a20e25&#34;, &#34;n_controls&#34;: 1, &#34;op&#34;: {&#34;box&#34;: {&#34;diagonal&#34;: [[[1.0, 0.0]], [[1.0, 0.0]], [[0.7071067811865476, 0.7071067811865475]], [[0.9238795325112867, 0.3826834323650898]]], &#34;id&#34;: &#34;cf44c25c-ef8d-4762-a265-5d4c29eff835&#34;, &#34;type&#34;: &#34;DiagonalBox&#34;, &#34;upper_triangle&#34;: true}, &#34;type&#34;: &#34;DiagonalBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}, &#34;type&#34;: &#34;QControlBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;m&#34;, [1]], [&#34;m&#34;, [2]], [&#34;m&#34;, [3]]], &#34;op&#34;: {&#34;box&#34;: {&#34;circuit&#34;: {&#34;bits&#34;: [], &#34;commands&#34;: [{&#34;args&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;SWAP&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [3]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.125&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [2]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.25&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [1]], [&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;params&#34;: [&#34;-0.5&#34;], &#34;type&#34;: &#34;CU1&#34;}}, {&#34;args&#34;: [[&#34;q&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;H&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;q&#34;, [0]], [&#34;q&#34;, [0]]], [[&#34;q&#34;, [1]], [&#34;q&#34;, [1]]], [[&#34;q&#34;, [2]], [&#34;q&#34;, [2]]], [[&#34;q&#34;, [3]], [&#34;q&#34;, [3]]]], &#34;name&#34;: &#34;$$QFT^{\\dagger}$$&#34;, &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;q&#34;, [0]], [&#34;q&#34;, [1]], [&#34;q&#34;, [2]], [&#34;q&#34;, [3]]]}, &#34;id&#34;: &#34;c5ae5097-2899-46cd-b8c8-79b876e9e6d6&#34;, &#34;type&#34;: &#34;CircBox&#34;}, &#34;type&#34;: &#34;CircBox&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [0]], [&#34;c&#34;, [0]]], &#34;op&#34;: {&#34;type&#34;: &#34;Measure&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [1]], [&#34;c&#34;, [1]]], &#34;op&#34;: {&#34;type&#34;: &#34;Measure&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [2]], [&#34;c&#34;, [2]]], &#34;op&#34;: {&#34;type&#34;: &#34;Measure&#34;}}, {&#34;args&#34;: [[&#34;m&#34;, [3]], [&#34;c&#34;, [3]]], &#34;op&#34;: {&#34;type&#34;: &#34;Measure&#34;}}], &#34;created_qubits&#34;: [], &#34;discarded_qubits&#34;: [], &#34;implicit_permutation&#34;: [[[&#34;m&#34;, [0]], [&#34;m&#34;, [0]]], [[&#34;m&#34;, [1]], [&#34;m&#34;, [1]]], [[&#34;m&#34;, [2]], [&#34;m&#34;, [2]]], [[&#34;m&#34;, [3]], [&#34;m&#34;, [3]]], [[&#34;p&#34;, [0]], [&#34;p&#34;, [0]]], [[&#34;p&#34;, [1]], [&#34;p&#34;, [1]]]], &#34;phase&#34;: &#34;0.0&#34;, &#34;qubits&#34;: [[&#34;m&#34;, [0]], [&#34;m&#34;, [1]], [&#34;m&#34;, [2]], [&#34;m&#34;, [3]], [&#34;p&#34;, [0]], [&#34;p&#34;, [1]]]}&lt;/div&gt;
        &lt;/div&gt;
        &lt;circuit-display-container
                :circuit-element-str=&#34;&#39;#circuit-json-to-display&#39;&#34;
                :init-render-options=&#34;initRenderOptions&#34;
                view-format=&#34;None&#34;
        &gt;&lt;/circuit-display-container&gt;
    &lt;/div&gt;
    &lt;script type=&#34;application/javascript&#34;&gt;
      const circuitRendererUid = &#34;3c9a7857-59d4-42f0-a461-4722baab63d1&#34;;
      const displayOptions = JSON.parse(&#39;{}&#39;);

      // Script to initialise the circuit renderer app

const { createApp } = Vue;
const circuitDisplayContainer = window[&#34;pytket-circuit-renderer&#34;].default;
// Init variables to be shared between circuit display instances
if (typeof window.pytketCircuitDisplays === &#34;undefined&#34;) {
    window.pytketCircuitDisplays = {};
}
// Create the root Vue component
const app = createApp({
    delimiters: [&#39;[[#&#39;, &#39;#]]&#39;],
    components: { circuitDisplayContainer },
    data () {
      return {
        initRenderOptions: displayOptions,
      }
    }
})
app.config.unwrapInjectedRef = true;
app.mount(&#34;#circuit-display-vue-container-&#34;+circuitRendererUid);
window.pytketCircuitDisplays[circuitRendererUid] = app;
    &lt;/script&gt;



&lt;/body&gt;
&lt;/html&gt;
"
            width="100%" height="100%"
            style="border: none; outline: none; overflow: auto"></iframe>
</div>

</div></div>
</div>
<p>Try clicking on the boxes in the rendered display above to see the circuits which define the <span class="math notranslate nohighlight">\(P_{|\psi \rangle}\)</span> and <span class="math notranslate nohighlight">\(QFT^\dagger\)</span> subroutines.</p>
<p>Lets use the noiseless <a class="reference external" href="https://docs.quantinuum.com/tket/extensions/pytket-qiskit/api.html#pytket.extensions.qiskit.AerBackend" title="Project name not set">AerBackend</a> simulator from pytket-qiskit to run our phase estimation circuit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.extensions.qiskit</span> <span class="kn">import</span> <span class="n">AerBackend</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Before we can execute the QPE circuit on the Aer simulator we need to decompose the <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.DiagonalBox" title="Project name not set">DiagonalBox</a>, <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.CircBox" title="Project name not set">CircBox</a> and <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.QControlBox" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QControlBox</span></code></a>primitives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">DecomposeBoxes</span>

<span class="n">DecomposeBoxes</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">qpe_circ_trivial</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_shots</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run_circuit</span><span class="p">(</span><span class="n">qpe_circ_trivial</span><span class="p">,</span> <span class="n">n_shots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>plotting function for QPE Notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends.backendresult</span> <span class="kn">import</span> <span class="n">BackendResult</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">plot_qpe_results</span><span class="p">(</span>
    <span class="n">sim_result</span><span class="p">:</span> <span class="n">BackendResult</span><span class="p">,</span>
    <span class="n">n_strings</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">y_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results in a barchart given a BackendResult. the number of stings displayed</span>
<span class="sd">    can be specified with the n_strings argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts_dict</span> <span class="o">=</span> <span class="n">sim_result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
    <span class="n">sorted_shots</span> <span class="o">=</span> <span class="n">counts_dict</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
    <span class="n">n_most_common_strings</span> <span class="o">=</span> <span class="n">sorted_shots</span><span class="p">[:</span><span class="n">n_strings</span><span class="p">]</span>
    <span class="n">x_axis_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">n_most_common_strings</span><span class="p">]</span>  <span class="c1"># basis states</span>
    <span class="n">y_axis_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">n_most_common_strings</span><span class="p">]</span>  <span class="c1"># counts</span>

    <span class="k">if</span> <span class="n">dark_mode</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
        
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orange&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_axis_values</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_axis_values</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">y_axis_values</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Results&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_limit</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Basis State&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Shots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_qpe_results</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">y_limit</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">n_shots</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bb3700a137047680ca75591e8ec648d09def650ec22dc84fd07ba22c0620465a.png" src="../../_images/bb3700a137047680ca75591e8ec648d09def650ec22dc84fd07ba22c0620465a.png" />
</div>
</div>
<p>We see that our measurements always give the computational basis state <span class="math notranslate nohighlight">\(|0001\rangle\)</span>. This is the integer <span class="math notranslate nohighlight">\(j=1\)</span> encoded in 4 bits. From this we can easily calculate the phase estimate which in this highly idealised case will be exact.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
\theta_{estimate} = \frac{j}{2^m}
\end{equation}
\]</div>
</div>
<p>Where <span class="math notranslate nohighlight">\(m\)</span> is the number of measurement qubits. In this case <span class="math notranslate nohighlight">\(m=4\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends.backendresult</span> <span class="kn">import</span> <span class="n">BackendResult</span>

<span class="k">def</span> <span class="nf">single_phase_from_backendresult</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">BackendResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="c1"># Extract most common measurement outcome</span>
    <span class="n">basis_state</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">basis_state</span><span class="p">])</span>
    <span class="n">integer_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bitstring</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate theta estimate</span>
    <span class="k">return</span> <span class="n">integer_j</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitstring</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">single_phase_from_backendresult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0625
</pre></div>
</div>
</div>
</div>
<p>Our output is exactly <span class="math notranslate nohighlight">\(\theta = \frac{1}{2^4} =  \frac{1}{16}=0.0625\)</span> as we would expect from looking at our matrix <span class="math notranslate nohighlight">\(U\)</span>.</p>
</section>
<section id="phase-estimation-with-time-evolution">
<h2>Phase Estimation with Time Evolution<a class="headerlink" href="#phase-estimation-with-time-evolution" title="Link to this heading">¶</a></h2>
<p>In the phase estimation algorithm we repeatedly perform controlled unitary operations. In the textbook variant of QPE presented here, the number of controlled unitaries will be <span class="math notranslate nohighlight">\(2^m - 1\)</span> where <span class="math notranslate nohighlight">\(m\)</span> is the number of measurement qubits.</p>
<p>In the example above we’ve shown a trivial instance of QPE where we know the exact phase in advance. For more realistic applications of QPE we will have some non-trivial state preparation required.</p>
<p>For chemistry or condensed matter physics <span class="math notranslate nohighlight">\(U\)</span> typically be the time evolution operator <span class="math notranslate nohighlight">\(U(t) = e^{- i H t}\)</span> where <span class="math notranslate nohighlight">\(H\)</span> is the problem Hamiltonian.
Suppose that we had the following decomposition for <span class="math notranslate nohighlight">\(H\)</span> in terms of Pauli strings <span class="math notranslate nohighlight">\(P_j\)</span> and complex coefficients <span class="math notranslate nohighlight">\(\alpha_j\)</span>.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
\begin{equation}
H = \sum_j \alpha_j P_j\,, \quad \, P_j \in \{I, \,X, \,Y, \,Z\}^{\otimes n}
\end{equation}
\]</div>
</div>
<p>Here the term Pauli strings refers to tensor products of Pauli operators. These strings form an orthonormal basis for <span class="math notranslate nohighlight">\(2^n \times 2^n\)</span> matrices.</p>
<p>If we have a Hamiltonian in the form above, we can then implement <span class="math notranslate nohighlight">\(U(t)\)</span> as a sequence of Pauli gadget circuits. We can do this with the <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.PauliExpBox" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliExpBox</span></code></a> construct in pytket. For more on <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.PauliExpBox" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliExpBox</span></code></a> see the <a class="reference external" href="https://docs.quantinuum.com/tket/user-guide/manual/manual_circuit.html#pauli-exponential-boxes">user manual</a>.</p>
<p>Once we have a circuit to implement our time evolution operator <span class="math notranslate nohighlight">\(U(t)\)</span>, we can construct the controlled <span class="math notranslate nohighlight">\(U(t)\)</span> operations using <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.QControlBox" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QControlBox</span></code></a>. If our base unitary is a sequence of <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code>(es) then there is some structure we can exploit to simplify our circuit. See this <a class="reference external" href="https://docs.quantinuum.com/tket/blog/posts/controlled_gates/">blog post</a> on <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/circuit.html#pytket.circuit.ConjugationBox" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConjugationBox</span></code></a> for more.</p>
<p>As an exercise, try to use phase estimation to calculate the ground state of diatomic hydrogen <span class="math notranslate nohighlight">\(H_2\)</span>.</p>
</section>
<section id="suggestions-for-further-reading">
<h2>Suggestions for further reading<a class="headerlink" href="#suggestions-for-further-reading" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Quantinuum paper on Bayesian phase estimation -&gt; https://arxiv.org/pdf/2306.16608.pdf</p></li>
<li><p><a class="reference external" href="https://docs.quantinuum.com/tket/blog/posts/controlled_gates/">Blog post on <code class="docutils literal notranslate"><span class="pre">ConjugationBox</span></code></a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="pytket-qujax-classification.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Binary classification using <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="measurement_reduction_example.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Advanced expectation values and measurement reduction</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Quantum Phase Estimation</a><ul>
<li><a class="reference internal" href="#overview-of-phase-estimation">Overview of Phase Estimation</a></li>
<li><a class="reference internal" href="#the-quantum-fourier-transform">The Quantum Fourier Transform</a></li>
<li><a class="reference internal" href="#building-the-phase-estimation-circuit">Building the Phase Estimation Circuit</a></li>
<li><a class="reference internal" href="#phase-estimation-with-a-trivial-eigenstate">Phase Estimation with a Trivial Eigenstate</a></li>
<li><a class="reference internal" href="#phase-estimation-with-time-evolution">Phase Estimation with Time Evolution</a></li>
<li><a class="reference internal" href="#suggestions-for-further-reading">Suggestions for further reading</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>