<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Expectation values" href="expectation_value_example.html" /><link rel="prev" title="Ansatz sequencing" href="ansatz_sequence_example.html" />

    <link rel="shortcut icon" href="../../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Iterated entanglement swapping - pytket user guide</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pytket user guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">pytket user guide</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_intro.html">What is tket?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_circuit.html">Circuit Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_backend.html">Running on Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_compiler.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_noise.html">Noise and the Quantum Circuit Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_assertion.html">Assertion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_zx.html">ZX Diagrams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_analysis_example.html">Circuit analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_generation_example.html">Circuit generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/conditional_gate_example.html">Conditional gates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/backends_example.html">TKET <code class="docutils literal notranslate"><span class="pre">Backend</span></code> tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/comparing_simulators.html">Comparison of the simulators available through TKET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/creating_backends.html">How to create your own <code class="docutils literal notranslate"><span class="pre">Backend</span></code> using <code class="docutils literal notranslate"><span class="pre">pytket</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/qiskit_integration.html">Integrating <code class="docutils literal notranslate"><span class="pre">pytket</span></code> into Qiskit software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/compilation_example.html">Compilation passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/contextual_optimisation.html">Contextual optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/mapping_example.html">Qubit mapping and routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/symbolics_example.html">Symbolic compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ansatz_sequence_example.html">Ansatz sequencing</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Iterated entanglement swapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="expectation_value_example.html">Expectation values</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_reduction_example.html">Advanced expectation values and measurement reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="phase_estimation.html">Quantum Phase Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax-classification.html">Binary classification using <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_heisenberg_vqe.html">VQE example with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_qaoa.html">Symbolic circuits with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ucc_vqe.html">VQE with UCC ansatz</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/examples/algorithms_and_protocols/entanglement_swapping.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="iterated-entanglement-swapping">
<h1>Iterated entanglement swapping<a class="headerlink" href="#iterated-entanglement-swapping" title="Link to this heading">¶</a></h1>
<p><strong>Download this notebook - <a class="reference download internal" download="" href="../../_downloads/4061fb72cb75444721fd25b83d4f0e10/entanglement_swapping.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">entanglement_swapping.ipynb</span></code></a></strong></p>
<p>In this tutorial, we will focus on:</p>
<ul class="simple">
<li><p>designing circuits with mid-circuit measurement and conditional gates;</p></li>
<li><p>utilising noise models in supported simulators.</p></li>
</ul>
<p>This example assumes the reader is familiar with the Qubit Teleportation and Entanglement Swapping protocols, and basic models of noise in quantum devices.</p>
<p>To run this example, you will need <code class="docutils literal notranslate"><span class="pre">pytket</span></code>, <code class="docutils literal notranslate"><span class="pre">pytket-qiskit</span></code>, and <code class="docutils literal notranslate"><span class="pre">plotly</span></code> (installed via <code class="docutils literal notranslate"><span class="pre">pip</span></code>). To view the graphs, you will need an intallation of <code class="docutils literal notranslate"><span class="pre">plotly-orca</span></code>.</p>
<p>Current quantum hardware fits into the NISQ (Noisy, Intermediate-Scale Quantum) regime. This noise cannot realistically be combatted using conventional error correcting codes, because of the lack of available qubits, noise levels exceeding the code thresholds, and very few devices available that can perform measurements and corrections mid-circuit. Analysis of how quantum algorithms perform under noisy conditions is a very active research area, as is finding ways to cope with it. Here, we will look at how well we can perform the Entanglement Swapping protocol with different noise levels.</p>
<p>The Entanglement Swapping protocol requires two parties to share Bell pairs with a third party, who applies the Qubit Teleportation protocol to generate a Bell pair between the two parties. The Qubit Teleportation step requires us to be able to measure some qubits and make subsequent corrections to the remaining qubits. There are only a handful of simulators and devices that currently support this, with others restricted to only measuring the qubits at the end of the circuit.</p>
<p>The most popular circuit model with conditional gates at the moment is that provided by the OpenQASM language. This permits a very restricted model of classical logic, where we can apply a gate conditionally on the exact value of a classical register. There is no facility in the current spec for Boolean logic or classical operations to apply any function to the value prior to the equality check. For example, Qubit Teleportation can be performed by the following QASM:
<code class="docutils literal notranslate"><span class="pre">OPENQASM</span> <span class="pre">2.0;</span></code>
<code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">&quot;qelib1.inc&quot;;</span></code>
<code class="docutils literal notranslate"><span class="pre">qreg</span> <span class="pre">a[2];</span></code>
<code class="docutils literal notranslate"><span class="pre">qreg</span> <span class="pre">b[1];</span></code>
<code class="docutils literal notranslate"><span class="pre">creg</span> <span class="pre">c[2];</span></code>
<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">Bell</span> <span class="pre">state</span> <span class="pre">between</span> <span class="pre">Alice</span> <span class="pre">and</span> <span class="pre">Bob</span></code>
<code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">a[1];</span></code>
<code class="docutils literal notranslate"><span class="pre">cx</span> <span class="pre">a[1],b[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">Bell</span> <span class="pre">measurement</span> <span class="pre">of</span> <span class="pre">Alice's</span> <span class="pre">qubits</span></code>
<code class="docutils literal notranslate"><span class="pre">cx</span> <span class="pre">a[0],a[1];</span></code>
<code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">a[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">measure</span> <span class="pre">a[0]</span> <span class="pre">-&gt;</span> <span class="pre">c[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">measure</span> <span class="pre">a[1]</span> <span class="pre">-&gt;</span> <span class="pre">c[1];</span></code>
<code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">Correction</span> <span class="pre">of</span> <span class="pre">Bob's</span> <span class="pre">qubit</span></code>
<code class="docutils literal notranslate"><span class="pre">if(c==1)</span> <span class="pre">z</span> <span class="pre">b[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">if(c==3)</span> <span class="pre">z</span> <span class="pre">b[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">if(c==2)</span> <span class="pre">x</span> <span class="pre">b[0];</span></code>
<code class="docutils literal notranslate"><span class="pre">if(c==3)</span> <span class="pre">x</span> <span class="pre">b[0];</span></code></p>
<p>This corresponds to the following <code class="docutils literal notranslate"><span class="pre">pytket</span></code> code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Circuit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qtel</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">alice</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">bob</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Bell state between Alice and Bob:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qtel</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Bell measurement of Alice’s qubits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qtel</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Correction of Bob’s qubit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qtel</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qtel</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So to demonstrate the Entanglement Swapping protocol, we just need to run this on one side of a Bell pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">es</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">ava</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">bella</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">charlie</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Bell state between Ava and Bella:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">es</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">es</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Teleport <code class="docutils literal notranslate"><span class="pre">bella[0]</span></code> to <code class="docutils literal notranslate"><span class="pre">charlie[0]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tel_to_c</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tel_to_c</span><span class="o">.</span><span class="n">rename_units</span><span class="p">({</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tel_to_c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">get_commands</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start by running a noiseless simulation of this to verify that what we get looks like a Bell pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.extensions.qiskit</span> <span class="kn">import</span> <span class="n">AerBackend</span>
</pre></div>
</div>
</div>
</div>
<p>Connect to a simulator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Make a ZZ measurement of the Bell pair:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bell_test</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bell_test</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">bell_test</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Run the experiment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bell_test</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">bell_test</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pytket.circuit.display</span> <span class="kn">import</span> <span class="n">render_circuit_jupyter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">bell_test</span><span class="p">)</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">process_circuit</span><span class="p">(</span><span class="n">bell_test</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is good, we have got roughly 50/50 measurement results of 00 and 11 under the ZZ operator. But there are many other states beyond the Bell state that also generate this distribution, so to gain more confidence in our claim about the state we should make more measurements that also characterise it, i.e. perform state tomography.</p>
<p>Here, we will demonstrate a naive approach to tomography that makes 3^n measurement circuits for an n-qubit state. More elaborate methods also exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.pauli</span> <span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>
<span class="kn">from</span> <span class="nn">pytket.utils</span> <span class="kn">import</span> <span class="n">append_pauli_measurement</span><span class="p">,</span> <span class="n">probs_from_counts</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">lstsq</span><span class="p">,</span> <span class="n">eigh</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gen_tomography_circuits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
    <span class="c1"># Yields {X, Y, Z}^n measurements in lexicographical order</span>
    <span class="c1"># Only measures qubits, storing the result in bits</span>
    <span class="c1"># (since we don&#39;t care about the ancilla qubits)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">paulis</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)):</span>
        <span class="n">circ</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">qb</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">paulis</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="n">circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qb</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="n">circ</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">qb</span><span class="p">)</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">qb</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">circ</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_tomography_circuits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
    <span class="n">circs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gen_tomography_circuits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="n">bits</span><span class="p">))</span>
    <span class="c1"># Compile and run each circuit</span>
    <span class="n">circs</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_compiled_circuits</span><span class="p">(</span><span class="n">circs</span><span class="p">)</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">process_circuits</span><span class="p">(</span><span class="n">circs</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
    <span class="c1"># Get the observed measurement probabilities</span>
    <span class="n">probs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">handles</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">probs_from_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="n">probs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">probs_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_tomography_outcomes</span><span class="p">(</span><span class="n">probs_list</span><span class="p">,</span> <span class="n">n_qbs</span><span class="p">):</span>
    <span class="c1"># Define the density matrices for the basis states</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="n">j</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="n">j</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">basis</span><span class="p">[(</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">n_qbs</span>
    <span class="c1"># Define vector all_probs as a concatenation of probability vectors for each measurement (2**n x 3**n, 1)</span>
    <span class="c1"># Define matrix all_ops mapping a (vectorised) density matrix to a vector of probabilities for each measurement</span>
    <span class="c1"># (2**n x 3**n, 2**n x 2**n)</span>
    <span class="n">all_probs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_ops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">paulis</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">product</span><span class="p">([</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">n_qbs</span><span class="p">),</span> <span class="n">probs_list</span>
    <span class="p">):</span>
        <span class="n">prob_vec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meas_ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">n_qbs</span><span class="p">):</span>
            <span class="n">prob_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paulis</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">basis</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">)])</span>
            <span class="n">meas_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
        <span class="n">all_probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">prob_vec</span><span class="p">))</span>
        <span class="n">all_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">meas_ops</span><span class="p">))</span>
    <span class="c1"># Solve for density matrix by minimising || all_ops * dm - all_probs ||</span>
    <span class="n">dm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lstsq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">all_ops</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">all_probs</span><span class="p">))</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="c1"># Make density matrix positive semi-definite</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">w</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span>
    <span class="c1"># Normalise trace of density matrix</span>
    <span class="n">dm</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probs_list</span> <span class="o">=</span> <span class="n">run_tomography_circuits</span><span class="p">(</span>
    <span class="n">es</span><span class="p">,</span> <span class="p">[</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">backend</span>
<span class="p">)</span>
<span class="n">dm</span> <span class="o">=</span> <span class="n">fit_tomography_outcomes</span><span class="p">(</span><span class="n">probs_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This is very close to the true density matrix for a pure Bell state. We can attribute the error here to the sampling error since we only take 2000 samples of each measurement circuit.</p>
<p>To quantify exactly how similar it is to the correct density matrix, we can calculate the fidelity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">sqrtm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fidelity</span><span class="p">(</span><span class="n">dm0</span><span class="p">,</span> <span class="n">dm1</span><span class="p">):</span>
    <span class="c1"># Calculate the fidelity between two density matrices</span>
    <span class="n">sq0</span> <span class="o">=</span> <span class="n">sqrtm</span><span class="p">(</span><span class="n">dm0</span><span class="p">)</span>
    <span class="n">sq1</span> <span class="o">=</span> <span class="n">sqrtm</span><span class="p">(</span><span class="n">dm1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sq0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sq1</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bell_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fidelity</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">bell_state</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This high fidelity is unsurprising since we have a completely noiseless simulation. So the next step is to add some noise to the simulation and observe how the overall fidelity is affected. The <code class="docutils literal notranslate"><span class="pre">AerBackend</span></code> wraps around the Qiskit Aer simulator and can pass on any <code class="docutils literal notranslate"><span class="pre">qiskit.providers.aer.noise.NoiseModel</span></code> to the simulator. Let’s start by adding some uniform depolarising noise to each CX gate and some uniform measurement error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_aer.noise</span> <span class="kn">import</span> <span class="n">NoiseModel</span><span class="p">,</span> <span class="n">depolarizing_error</span><span class="p">,</span> <span class="n">ReadoutError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_noise_model</span><span class="p">(</span><span class="n">dep_err_rate</span><span class="p">,</span> <span class="n">ro_err_rate</span><span class="p">,</span> <span class="n">qubits</span><span class="p">):</span>
    <span class="c1"># Define a noise model that applies uniformly to the given qubits</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">NoiseModel</span><span class="p">()</span>
    <span class="n">dep_err</span> <span class="o">=</span> <span class="n">depolarizing_error</span><span class="p">(</span><span class="n">dep_err_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ro_err</span> <span class="o">=</span> <span class="n">ReadoutError</span><span class="p">(</span>
        <span class="p">[[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ro_err_rate</span><span class="p">,</span> <span class="n">ro_err_rate</span><span class="p">],</span> <span class="p">[</span><span class="n">ro_err_rate</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ro_err_rate</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="c1"># Add depolarising error to CX gates between any qubits (implying full connectivity)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add_quantum_error</span><span class="p">(</span><span class="n">dep_err</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cx&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="c1"># Add readout error for each qubit</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add_readout_error</span><span class="p">(</span><span class="n">ro_err</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_model</span> <span class="o">=</span> <span class="n">make_noise_model</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">(</span><span class="n">noise_model</span><span class="o">=</span><span class="n">test_model</span><span class="p">)</span>
<span class="n">probs_list</span> <span class="o">=</span> <span class="n">run_tomography_circuits</span><span class="p">(</span>
    <span class="n">es</span><span class="p">,</span> <span class="p">[</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">backend</span>
<span class="p">)</span>
<span class="n">dm</span> <span class="o">=</span> <span class="n">fit_tomography_outcomes</span><span class="p">(</span><span class="n">probs_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fidelity</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">bell_state</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Despite the very small circuit and the relatively small error rates, the fidelity of the final state has reduced considerably.</p>
<p>As far as circuits go, the entanglement swapping protocol is little more than a toy example and is nothing close to the scale of circuits for most interesting quantum computational problems. However, it is possible to iterate the protocol many times to build up a larger computation, allowing us to see the impact of the noise at different scales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">OpType</span>
<span class="kn">from</span> <span class="nn">plotly.graph_objects</span> <span class="kn">import</span> <span class="n">Scatter</span><span class="p">,</span> <span class="n">Figure</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">iterated_entanglement_swap</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
    <span class="c1"># Iterate the entanglement swapping protocol n_iter times</span>
    <span class="n">it_es</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
    <span class="n">ava</span> <span class="o">=</span> <span class="n">it_es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bella</span> <span class="o">=</span> <span class="n">it_es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">charlie</span> <span class="o">=</span> <span class="n">it_es</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">it_es</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Start with an initial Bell state</span>
    <span class="n">it_es</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">it_es</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Teleport bella[0] to charlie[0] to give a Bell pair between ava[0] and charlier[0]</span>
            <span class="n">tel_to_c</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tel_to_c</span><span class="o">.</span><span class="n">rename_units</span><span class="p">(</span>
                <span class="p">{</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="p">)</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tel_to_c</span><span class="p">)</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">bella</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Teleport charlie[0] to bella[0] to give a Bell pair between ava[0] and bella[0]</span>
            <span class="n">tel_to_b</span> <span class="o">=</span> <span class="n">qtel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tel_to_b</span><span class="o">.</span><span class="n">rename_units</span><span class="p">(</span>
                <span class="p">{</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="p">)</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tel_to_b</span><span class="p">)</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">bella</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">it_es</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="c1"># Return the circuit and the qubits expected to share a Bell pair</span>
    <span class="k">if</span> <span class="n">n_iter</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">it_es</span><span class="p">,</span> <span class="p">[</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bella</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">it_es</span><span class="p">,</span> <span class="p">[</span><span class="n">ava</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">charlie</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">iterated_noisy_experiment</span><span class="p">(</span><span class="n">dep_err_rate</span><span class="p">,</span> <span class="n">ro_err_rate</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">):</span>
    <span class="c1"># Set up the noisy simulator with the given error rates</span>
    <span class="n">test_model</span> <span class="o">=</span> <span class="n">make_noise_model</span><span class="p">(</span><span class="n">dep_err_rate</span><span class="p">,</span> <span class="n">ro_err_rate</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">(</span><span class="n">noise_model</span><span class="o">=</span><span class="n">test_model</span><span class="p">)</span>
    <span class="c1"># Estimate the fidelity after n iterations, from 0 to max_iter (inclusive)</span>
    <span class="n">fid_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">it_es</span><span class="p">,</span> <span class="n">qubits</span> <span class="o">=</span> <span class="n">iterated_entanglement_swap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">probs_list</span> <span class="o">=</span> <span class="n">run_tomography_circuits</span><span class="p">(</span><span class="n">it_es</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">backend</span><span class="p">)</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">fit_tomography_outcomes</span><span class="p">(</span><span class="n">probs_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">fid</span> <span class="o">=</span> <span class="n">fidelity</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">bell_state</span><span class="p">)</span>
        <span class="n">fid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fid_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Iterated Entanglement Swapping under Noise (dep_err = 0.03)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Iterations&quot;</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Fidelity&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">iter_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">fids</span> <span class="o">=</span> <span class="n">iterated_noisy_experiment</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">plot_data</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">iter_range</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ro_err=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mf">0.025</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">plot_data</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># requires plotly-orca</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Iterated Entanglement Swapping under Noise (ro_err = 0.05)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Iterations&quot;</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Fidelity&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">iter_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">fids</span> <span class="o">=</span> <span class="n">iterated_noisy_experiment</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">plot_data</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">iter_range</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dep_err=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">plot_data</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># requires plotly-orca</span>
</pre></div>
</div>
</div>
</div>
<p>These graphs are not very surprising, but are still important for seeing that the current error rates of typical NISQ devices become crippling for fidelities very quickly after repeated mid-circuit measurements and corrections (even with this overly-simplified model with uniform noise and no crosstalk or higher error modes). This provides good motivation for the adoption of error mitigation techniques, and for the development of new techniques that are robust to errors in mid-circuit measurements.</p>
<p>Exercises:</p>
<ul class="simple">
<li><p>Vary the fixed noise levels to compare how impactful the depolarising and measurement errors are.</p></li>
<li><p>Add extra noise characteristics to the noise model to obtain something that more resembles a real device. Possible options include adding error during the reset operations, extending the errors to be non-local, or constructing the noise model from a device’s calibration data.</p></li>
<li><p>Change the circuit from iterated entanglement swapping to iterated applications of a correction circuit from a simple error-correcting code. Do you expect this to be more sensitive to depolarising errors from unitary gates or measurement errors?</p></li>
</ul>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="expectation_value_example.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Expectation values</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="ansatz_sequence_example.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Ansatz sequencing</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>