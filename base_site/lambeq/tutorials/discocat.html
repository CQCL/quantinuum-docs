<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Advanced: Extending lambeq" href="extend-lambeq.html" /><link rel="prev" title="Monoidal categories in lambeq" href="monoidal.html" />

    <link rel="shortcut icon" href="../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.07.18 -->
        <title>DisCoCat in lambeq - λambeq 0.4.3</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=613ab9ff" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/table-wrap.css?v=38dfa0aa" />
    <link rel="stylesheet" type="text/css" href="../_static/css/sidebar-title.css?v=6ae2c5cb" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../_static/tokens.css"/>
<link rel="stylesheet" href="../_static/styles.css"/>
<link rel="stylesheet" href="../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">λambeq 0.4.3</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">λambeq 0.4.3</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">What is lambeq?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing to lambeq</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../string-diagrams.html">String diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parsing.html">Syntactic parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-cases.html">lambeq use cases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NLP-101</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp-intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp-data.html">Working with text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp-class.html">Text classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp-ml.html">Machine learning best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp-refs.html">References for further study</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sentence-input.html">Step 1. Sentence input</a></li>
<li class="toctree-l1"><a class="reference internal" href="rewrite.html">Step 2. Diagram rewriting</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameterise.html">Step 3. Parameterisation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../training.html">Step 4: Training</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Step 4: Training</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="trainer-classical.html">Training: Classical case</a></li>
<li class="toctree-l2"><a class="reference internal" href="trainer-quantum.html">Training: Quantum case</a></li>
<li class="toctree-l2"><a class="reference internal" href="trainer-hybrid.html">Training: Hybrid case</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Choosing a model</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../manual-training.html">Advanced: Manual training</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Advanced: Manual training</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="training-symbols.html">Introduction to symbols</a></li>
<li class="toctree-l2"><a class="reference internal" href="training-usecase.html">A complete use case</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../advanced.html">Advanced: low-level lambeq</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Advanced: low-level lambeq</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="monoidal.html">Monoidal categories in lambeq</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">DisCoCat in lambeq</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extend-lambeq.html">Advanced: Extending lambeq</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notebooks.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/tokenisation.html">Tokenisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/unk-words.html">Handling unknown words</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/parser.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/reader.html">Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/tree-reader.html">Tree reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/rewrite.html">Rewrite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/circuit.html">Circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/tensor.html">Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/rotosolve-optimizer.html">Rotosolve optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/classical-pipeline.html">Classical pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/quantum-pipeline.html">Quantum pipeline using the Quantum Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/quantum-pipeline-jax.html">Quantum pipeline using JAX backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/pennylane.html">Training hybrid models using the Pennylane backend</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Toolkit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../root-api.html">lambeq package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../package-api.html">Subpackages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uml-diagrams.html">Class diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command-line interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://qnlp.cambridgequantum.com/downloads.html">Resources</a></li>
<li class="toctree-l1"><a class="reference external" href="https://qnlp.cambridgequantum.com/generate.html">Web demo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discopy.readthedocs.io">DisCoPy</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorials/discocat.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="discocat-in-lambeq">
<h1>DisCoCat in lambeq<a class="headerlink" href="#discocat-in-lambeq" title="Link to this heading">¶</a></h1>
<p>In the previous tutorial, we learnt the basics of <a class="reference internal" href="../glossary.html#term-monoidal-category"><span class="xref std std-term">monoidal categories</span></a> and how to represent them in <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>. In this tutorial, we look at the <em>Distributional Compositional Categorical</em> model <span id="id1">[<a class="reference internal" href="../bibliography.html#id6" title="Bob Coecke, Mehrnoosh Sadrzadeh, and Stephen Clark. Mathematical Foundations for a Compositional Distributional Model of Meaning. 2010. URL: https://arxiv.org/abs/1003.4394, arXiv:1003.4394.">CSC10</a>]</span>, which uses functors to map diagrams from the <a class="reference internal" href="monoidal.html#Rigid-monoidal-categories"><span class="std std-ref">rigid category</span></a> of <a class="reference internal" href="../string-diagrams.html#Pregroup-grammars"><span class="std std-ref">pregroup grammars</span></a> to vector space semantics.</p>
<p><a class="reference download internal" download="" href="../_downloads/917bbd1e1e31c3413993fb1e434efd18/discocat.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">⬇️</span> <span class="pre">Download</span> <span class="pre">code</span></code></a></p>
<section id="pregroup-grammars">
<h2>Pregroup grammars<a class="headerlink" href="#pregroup-grammars" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../string-diagrams.html#Pregroup-grammars"><span class="std std-ref">Pregroup grammar</span></a> is a grammatical formalism devised by Joachim Lambek in 1999 <span id="id2">[<a class="reference internal" href="../bibliography.html#id15" title="Joachim Lambek. Type Grammar Revisited. In Alain Lecomte, François Lamarche, and Guy Perrier, editors, Logical Aspects of Computational Linguistics, 1–27. Berlin, Heidelberg, 1999. Springer Berlin Heidelberg.">Lam99</a>]</span>. In pregroups, each word is a morphism with type <span class="math notranslate nohighlight">\(I \to T\)</span> where <span class="math notranslate nohighlight">\(I\)</span> is the monoidal unit and <span class="math notranslate nohighlight">\(T\)</span> is a rigid type, referred to as the <em>pregroup type</em>. Here are some examples for pregroup type assignments:</p>
<ul class="simple">
<li><p>a noun is given the base type <span class="math notranslate nohighlight">\(n\)</span>.</p></li>
<li><p>an adjective consumes a noun on the noun’s left to return another noun, so it is given the type <span class="math notranslate nohighlight">\(n\cdot n^l\)</span>.</p></li>
<li><p>a transitive verb consumes a noun on its left and another noun on its right to give a sentence, so is given the type <span class="math notranslate nohighlight">\(n^r \cdot s \cdot n^l\)</span>.</p></li>
</ul>
<p>In the context of pregroups, the <a class="reference internal" href="../glossary.html#term-adjoint"><span class="xref std std-term">adjoints</span></a> <span class="math notranslate nohighlight">\(n^l\)</span> and <span class="math notranslate nohighlight">\(n^r\)</span> can be thought of as the left and right inverses of a type <span class="math notranslate nohighlight">\(n\)</span> respectively. In a pregroup derivation, the words are concatenated using the monoidal product <span class="math notranslate nohighlight">\(\otimes\)</span> and linked using <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a>, which are special morphisms that exist in any <a class="reference internal" href="../glossary.html#term-rigid-category"><span class="xref std std-term">rigid category</span></a>. A sentence is grammatically sound if its derivation has a single uncontracted sentence wire.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>, words are defined using the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Word" title="lambeq.backend.grammar.Word"><code class="xref py py-class docutils literal notranslate"><span class="pre">Word</span></code></a> class. A <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Word" title="lambeq.backend.grammar.Word"><code class="xref py py-class docutils literal notranslate"><span class="pre">Word</span></code></a> is just a <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Box" title="lambeq.backend.grammar.Box"><code class="xref py py-class docutils literal notranslate"><span class="pre">Box</span></code></a> where the input type is fixed to be the monoidal unit <span class="math notranslate nohighlight">\(I\)</span> (or <code class="docutils literal notranslate"><span class="pre">Ty()</span></code>). A pregroup derivation diagram can be drawn using either the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram.draw" title="lambeq.backend.grammar.Diagram.draw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">backend.grammar.Diagram.draw()</span></code></a> method or the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.drawing.draw" title="lambeq.backend.drawing.draw"><code class="xref py py-func docutils literal notranslate"><span class="pre">backend.drawing.draw()</span></code></a> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.drawing</span> <span class="kn">import</span> <span class="n">draw</span>
<span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Cap</span><span class="p">,</span> <span class="n">Cup</span><span class="p">,</span> <span class="n">Id</span><span class="p">,</span> <span class="n">Ty</span><span class="p">,</span> <span class="n">Word</span>


<span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Ty</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">Ty</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>

<span class="n">words</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;she&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
    <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;goes&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span> <span class="o">@</span> <span class="n">s</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">l</span><span class="p">),</span>
    <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">cups</span> <span class="o">=</span> <span class="n">Cup</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">@</span> <span class="n">Id</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">@</span> <span class="n">Cup</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">Id</span><span class="p">()</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">*</span><span class="n">words</span><span class="p">)</span> <span class="o">==</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">@</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">@</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">Ty</span><span class="p">()</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">l</span><span class="p">])</span> <span class="o">==</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span> <span class="o">@</span> <span class="n">s</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">l</span>

<span class="n">diagram</span> <span class="o">=</span> <span class="n">Id</span><span class="p">()</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">*</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">cups</span>
<span class="n">draw</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/47d221f51adc5b97d4c268641a710b0c0c0f09ec7c13477ba6075452732abc52.png" src="../_images/47d221f51adc5b97d4c268641a710b0c0c0f09ec7c13477ba6075452732abc52.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>, method <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram.create_pregroup_diagram" title="lambeq.backend.grammar.Diagram.create_pregroup_diagram"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_pregroup_diagram()</span></code></a> provides an alternative, more compact way to create pregroup diagrams, by explicitly defining a list of <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a> and <a class="reference internal" href="../glossary.html#term-swap"><span class="xref std std-term">swaps</span></a>. For example, the above diagram can be also generated using the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Diagram</span><span class="p">,</span> <span class="n">Ty</span>

<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">Word</span><span class="p">(</span><span class="s1">&#39;she&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;goes&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span> <span class="o">@</span> <span class="n">s</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">l</span><span class="p">),</span> <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
<span class="n">morphisms</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Cup</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">Cup</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
<span class="n">diagram</span> <span class="o">=</span> <span class="n">Diagram</span><span class="o">.</span><span class="n">create_pregroup_diagram</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">morphisms</span><span class="p">)</span>
</pre></div>
</div>
<p>where the numbers in <code class="docutils literal notranslate"><span class="pre">morphisms</span></code> define the indices of the corresponding wires at the top of the diagram
<code class="docutils literal notranslate"><span class="pre">(n</span> <span class="pre">&#64;</span> <span class="pre">n.r</span> <span class="pre">&#64;</span> <span class="pre">s</span> <span class="pre">&#64;</span> <span class="pre">n.l</span> <span class="pre">&#64;</span> <span class="pre">n)</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.drawing</span> <span class="kn">import</span> <span class="n">draw_equation</span>

<span class="c1"># In the original diagram, words appear before the cups</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before normal form:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">diagram</span><span class="o">.</span><span class="n">boxes</span><span class="p">)))</span>

<span class="n">diagram_nf</span> <span class="o">=</span> <span class="n">diagram</span><span class="o">.</span><span class="n">normal_form</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After normal form:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">diagram_nf</span><span class="o">.</span><span class="n">boxes</span><span class="p">)))</span>

<span class="n">draw_equation</span><span class="p">(</span><span class="n">diagram</span><span class="p">,</span> <span class="n">diagram_nf</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">draw_as_pregroup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foliated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Before normal form: she, goes, home, CUP, CUP
After normal form: she, goes, CUP, home, CUP
</pre></div>
</div>
<img alt="../_images/63c2d7c41e540f4decf5f5b7133ad9e940909e2f4b8e859cf65860c77a4a70c9.png" src="../_images/63c2d7c41e540f4decf5f5b7133ad9e940909e2f4b8e859cf65860c77a4a70c9.png" />
</div>
</div>
<p>In the example above, the application of normal form to the diagram introduces a <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cup</span></a> before the word “home”.</p>
</section>
<section id="functors">
<h2>Functors<a class="headerlink" href="#functors" title="Link to this heading">¶</a></h2>
<p>Given <a class="reference internal" href="../glossary.html#term-monoidal-category"><span class="xref std std-term">monoidal categories</span></a> <span class="math notranslate nohighlight">\(\mathcal{C}\)</span> and <span class="math notranslate nohighlight">\(\mathcal{D}\)</span>, a monoidal <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> <span class="math notranslate nohighlight">\(F: \mathcal{C} \to \mathcal{D}\)</span> satisfies the following properties:</p>
<ul class="simple">
<li><p>monoidal structure of objects is preserved: <span class="math notranslate nohighlight">\(F(A \otimes B) = F(A) \otimes F(B)\)</span></p></li>
<li><p><a class="reference internal" href="../glossary.html#term-adjoint"><span class="xref std std-term">adjoints</span></a> are preserved: <span class="math notranslate nohighlight">\(F(A^l) = F(A)^l\)</span>, <span class="math notranslate nohighlight">\(F(A^r) = F(A)^r\)</span></p></li>
<li><p>monoidal structure of morphism is preserved: <span class="math notranslate nohighlight">\(F(g \otimes f) = F(g) \otimes F(f)\)</span></p></li>
<li><p>compositonal structure of morphisms is preserved: <span class="math notranslate nohighlight">\(F(g \circ f) = F(g) \circ F(f)\)</span></p></li>
</ul>
<p>Put simply, a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> is a structure-preserving transformation. In a free <a class="reference internal" href="../glossary.html#term-monoidal-category"><span class="xref std std-term">monoidal category</span></a>, applying a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> to a diagram amounts to simply providing a mapping for each generating object and morphism. In <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>, a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> is defined by passing mappings (dictionaries or functions) as arguments <code class="docutils literal notranslate"><span class="pre">ob</span></code> and <code class="docutils literal notranslate"><span class="pre">ar</span></code> to the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Functor" title="lambeq.backend.grammar.Functor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Functor</span></code></a> class.</p>
<p><a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">Functors</span></a> are one of the most powerful concepts in category theory. In fact, the encoding, rewriting and parameterisation steps of <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>’s <a class="reference internal" href="../pipeline.html#sec-pipeline"><span class="std std-ref">pipeline</span></a> are implemented individually as <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functors</span></a>, resulting in an overall functorial transformation from <a class="reference internal" href="../glossary.html#term-syntax-tree"><span class="xref std std-term">parse trees</span></a> to <a class="reference internal" href="../glossary.html#term-tensor-network"><span class="xref std std-term">tensor networks</span></a> and <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">circuits</span></a>. More specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../root-api.html#lambeq.CCGParser" title="lambeq.CCGParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.CCGParser</span></code></a> uses a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> to transform a biclosed CCG diagram to a pregroup diagram <span id="id3">[<a class="reference internal" href="../bibliography.html#id16" title="Richie Yeung and Dimitri Kartsaklis. A CCG-Based Version of the DisCoCat Framework. In Martha Lewis and Mehrnoosh Sadrzadeh, editors, Proceedings of the 2021 Workshop on Semantic Spaces at the Intersection of NLP, Physics, and Cognitive Science (SemSpace), 20–31. Groningen, The Netherlands, June 2021. Association for Computational Linguistics. URL: https://aclanthology.org/2021.semspace-1.3.">YK21</a>]</span>.</p></li>
<li><p><a class="reference internal" href="../root-api.html#lambeq.Rewriter" title="lambeq.Rewriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.Rewriter</span></code></a> functorially transforms a pregroup diagram to a simpler pregroup diagram.</p></li>
<li><p><a class="reference internal" href="../root-api.html#lambeq.TensorAnsatz" title="lambeq.TensorAnsatz"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.TensorAnsatz</span></code></a> functorially transforms a pregroup diagram to a tensor diagram, which can be evaluated as a tensor network using NumPy, JAX or PyTorch.</p></li>
<li><p><a class="reference internal" href="../root-api.html#lambeq.CircuitAnsatz" title="lambeq.CircuitAnsatz"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.CircuitAnsatz</span></code></a> functorially transforms a pregroup diagram to a <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">quantum circuit</span></a>, for evaluation on a quantum device.</p></li>
</ul>
<p>Below we present two examples of <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functors</span></a>, implemented in <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>.</p>
<section id="example-1-very-functor">
<h3>Example 1: “Very” functor<a class="headerlink" href="#example-1-very-functor" title="Link to this heading">¶</a></h3>
<p>This <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> adds the word “very” in front of every adjective in a <a class="reference internal" href="../glossary.html#term-DisCoCat"><span class="xref std std-term">DisCoCat</span></a> diagram.
Since the mapping is from a <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram" title="lambeq.backend.grammar.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Diagram</span></code></a> to another <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram" title="lambeq.backend.grammar.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Diagram</span></code></a>, a <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Functor" title="lambeq.backend.grammar.Functor"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Functor</span></code></a> should be used. Further, the word “very” modifies an adjective to return another adjective, so it should have type
<span class="math notranslate nohighlight">\((n \otimes n^l) \otimes (n \otimes n^l)^l = n \otimes n^l \otimes n^{ll} \otimes n^l\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq</span> <span class="kn">import</span> <span class="n">BobcatParser</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">BobcatParser</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;suppress&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.drawing</span> <span class="kn">import</span> <span class="n">draw_equation</span>
<span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Diagram</span><span class="p">,</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">Functor</span>

<span class="c1"># determiners have the same type as adjectives</span>
<span class="c1"># but we shouldn&#39;t add &#39;very&#39; behind them</span>
<span class="n">determiners</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;his&#39;</span><span class="p">,</span> <span class="s1">&#39;her&#39;</span><span class="p">,</span> <span class="s1">&#39;their&#39;</span><span class="p">]</span>

<span class="c1"># type for an adjective</span>
<span class="n">adj</span> <span class="o">=</span> <span class="n">n</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">l</span>
<span class="n">very</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="s1">&#39;very&#39;</span><span class="p">,</span> <span class="n">adj</span> <span class="o">@</span> <span class="n">adj</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
<span class="n">cups</span> <span class="o">=</span> <span class="n">Diagram</span><span class="o">.</span><span class="n">cups</span><span class="p">(</span><span class="n">adj</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">very_ob</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ty</span>

<span class="k">def</span> <span class="nf">very_ar</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">box</span> <span class="o">!=</span> <span class="n">very</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">determiners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">cod</span> <span class="o">==</span> <span class="n">adj</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">very</span> <span class="o">@</span> <span class="n">box</span> <span class="o">&gt;&gt;</span> <span class="n">Id</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span> <span class="o">@</span> <span class="n">cups</span>
    <span class="k">return</span> <span class="n">box</span>

<span class="n">very_functor</span> <span class="o">=</span> <span class="n">Functor</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span>
                       <span class="n">ob</span><span class="o">=</span><span class="n">very_ob</span><span class="p">,</span>
                       <span class="n">ar</span><span class="o">=</span><span class="n">very_ar</span><span class="p">,)</span>

<span class="n">diagram</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">sentence2diagram</span><span class="p">(</span><span class="s1">&#39;a big bad wolf&#39;</span><span class="p">)</span>
<span class="n">new_diagram</span> <span class="o">=</span> <span class="n">very_functor</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span>

<span class="n">draw_equation</span><span class="p">(</span><span class="n">diagram</span><span class="p">,</span> <span class="n">new_diagram</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/77a9c331569c606576da1de6d282a1287ddc5aea750665e83de46a5f8d98b803.png" src="../_images/77a9c331569c606576da1de6d282a1287ddc5aea750665e83de46a5f8d98b803.png" />
</div>
</div>
</section>
<section id="example-2-twist-functor">
<h3>Example 2: Twist functor<a class="headerlink" href="#example-2-twist-functor" title="Link to this heading">¶</a></h3>
<p>In this <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a>, <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a> and <a class="reference internal" href="../glossary.html#term-cap"><span class="xref std std-term">caps</span></a> are treated specially and are not passed to the <code class="docutils literal notranslate"><span class="pre">ar</span></code> function; instead they are passed to <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram.register_special_box" title="lambeq.backend.grammar.Diagram.register_special_box"><code class="xref py py-meth docutils literal notranslate"><span class="pre">grammar.Diagram.register_special_box()</span></code></a> method.</p>
<p>Here is an example of how to map a <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cup</span></a> to a custom diagram, such as a “twisted” <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cup</span></a>. Note that it is up to the user to ensure the new <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a> and <a class="reference internal" href="../glossary.html#term-cap"><span class="xref std std-term">caps</span></a> satisfy the <a class="reference internal" href="../glossary.html#term-snake-equations"><span class="xref std std-term">snake equations</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Ty</span><span class="p">,</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">Diagram</span><span class="p">,</span> <span class="n">Functor</span><span class="p">,</span> <span class="n">Box</span><span class="p">,</span> <span class="n">Cup</span><span class="p">,</span> <span class="n">Cap</span><span class="p">,</span> <span class="n">Swap</span>


<span class="n">twisted</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span><span class="s1">&#39;twisted&#39;</span><span class="p">)</span>

<span class="nd">@twisted</span><span class="p">(</span><span class="s1">&#39;Diagram&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TwistedDiagram</span><span class="p">(</span><span class="n">Diagram</span><span class="p">):</span> <span class="o">...</span>

<span class="nd">@twisted</span><span class="p">(</span><span class="s1">&#39;Ty&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TwistedTy</span><span class="p">(</span><span class="n">Ty</span><span class="p">):</span> <span class="o">...</span>

<span class="nd">@twisted</span><span class="p">(</span><span class="s1">&#39;Box&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TwistedBox</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span> <span class="o">...</span>

<span class="nd">@twisted</span><span class="p">(</span><span class="s1">&#39;Layer&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TwistedLayer</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">TwistedCup</span><span class="p">(</span><span class="n">Cup</span><span class="p">,</span> <span class="n">TwistedBox</span><span class="p">):</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">TwistedCap</span><span class="p">(</span><span class="n">Cap</span><span class="p">,</span> <span class="n">TwistedBox</span><span class="p">):</span> <span class="o">...</span>

<span class="nd">@TwistedDiagram</span><span class="o">.</span><span class="n">register_special_box</span><span class="p">(</span><span class="s1">&#39;swap&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TwistedSwap</span><span class="p">(</span><span class="n">Swap</span><span class="p">,</span> <span class="n">TwistedBox</span><span class="p">):</span> <span class="o">...</span>

<span class="nd">@TwistedDiagram</span><span class="o">.</span><span class="n">register_special_box</span><span class="p">(</span><span class="s1">&#39;cap&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">twisted_cap_factory</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">is_reversed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">caps</span> <span class="o">=</span> <span class="n">TwistedCap</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">is_reversed</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_reversed</span><span class="p">)</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="n">TwistedSwap</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">caps</span> <span class="o">&gt;&gt;</span> <span class="n">swaps</span>

<span class="nd">@TwistedDiagram</span><span class="o">.</span><span class="n">register_special_box</span><span class="p">(</span><span class="s1">&#39;cup&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">twisted_cup_factory</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">is_reversed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="n">TwistedSwap</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    <span class="n">cups</span> <span class="o">=</span> <span class="n">TwistedCup</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">is_reversed</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_reversed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">swaps</span> <span class="o">&gt;&gt;</span> <span class="n">cups</span>


<span class="n">twist_functor</span> <span class="o">=</span> <span class="n">Functor</span><span class="p">(</span>
    <span class="n">ob</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">ty</span><span class="p">:</span> <span class="n">TwistedTy</span><span class="p">(</span><span class="n">ty</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
    <span class="n">ar</span><span class="o">=</span><span class="k">lambda</span> <span class="n">func</span><span class="p">,</span> <span class="n">box</span><span class="p">:</span> <span class="n">TwistedBox</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">dom</span><span class="p">),</span> <span class="n">func</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">cod</span><span class="p">)),</span>
    <span class="n">target_category</span><span class="o">=</span><span class="n">twisted</span><span class="p">)</span>

<span class="n">diagram</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">sentence2diagram</span><span class="p">(</span><span class="s1">&#39;This is twisted&#39;</span><span class="p">)</span>
<span class="n">twisted_diagram</span> <span class="o">=</span> <span class="n">twist_functor</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span>

<span class="n">draw</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span>
<span class="n">draw</span><span class="p">(</span><span class="n">twisted_diagram</span><span class="p">)</span>

<span class="n">snake</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">@</span> <span class="n">Cap</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Cup</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">to_diagram</span><span class="p">()</span> <span class="o">@</span> <span class="n">Id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">draw_equation</span><span class="p">(</span><span class="n">twist_functor</span><span class="p">(</span><span class="n">snake</span><span class="p">),</span> <span class="n">Id</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ad576bf5063263086eb2ddba2abb77a3a0a4820eafd15d79000533090da86efc.png" src="../_images/ad576bf5063263086eb2ddba2abb77a3a0a4820eafd15d79000533090da86efc.png" />
<img alt="../_images/a605dd307feb29c3943ef0c1fcd2dc4a6ae440b75107aa3d8980bcf6c477d390.png" src="../_images/a605dd307feb29c3943ef0c1fcd2dc4a6ae440b75107aa3d8980bcf6c477d390.png" />
<img alt="../_images/9a6a172163ed05c50cbfe0cceb3898721c5ec4132269fadfb8254dbf9186031c.png" src="../_images/9a6a172163ed05c50cbfe0cceb3898721c5ec4132269fadfb8254dbf9186031c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TwistedDiagram</span><span class="o">.</span><span class="n">cups</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">TwistedDiagram</span><span class="o">.</span><span class="n">caps</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8be0d06893b7bc7d598fc56262f9d6be162fa19098b6d6009925fa49868b04a8.png" src="../_images/8be0d06893b7bc7d598fc56262f9d6be162fa19098b6d6009925fa49868b04a8.png" />
<img alt="../_images/2bb7bd4187f6c9dbe4569dd85b2fba6831df5e851f9ca5db81bdb7b6f5839671.png" src="../_images/2bb7bd4187f6c9dbe4569dd85b2fba6831df5e851f9ca5db81bdb7b6f5839671.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Twisting the nested <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a> for “is” and “twisted” together is <strong>not</strong> a functorial operation, so it cannot be implemented using <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Functor" title="lambeq.backend.grammar.Functor"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Functor</span></code></a>.</p>
</div>
</section>
</section>
<section id="classical-discocat-tensor-networks">
<h2>Classical DisCoCat: Tensor networks<a class="headerlink" href="#classical-discocat-tensor-networks" title="Link to this heading">¶</a></h2>
<p>The classical version of <a class="reference internal" href="../glossary.html#term-DisCoCat"><span class="xref std std-term">DisCoCat</span></a> sends diagrams in the <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of pregroup derivations to tensors in the <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of vector spaces <strong>FVect</strong>. <strong>FVect</strong> is a <a class="reference internal" href="../glossary.html#term-monoidal-category"><span class="xref std std-term">monoidal category</span></a> with vector spaces (e.g. <span class="math notranslate nohighlight">\(\mathbb{R}^2 \otimes \mathbb{R}^2\)</span>) as objects and linear maps between vector spaces as morphisms. It is in fact a <a class="reference internal" href="../glossary.html#term-compact-closed-category"><span class="xref std std-term">compact closed category</span></a>, which is a special case of rigid categories where <span class="math notranslate nohighlight">\(A^l = A^r = A^*\)</span>.</p>
<p>Using the <a class="reference internal" href="../lambeq.backend.html#module-lambeq.backend.tensor" title="lambeq.backend.tensor"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lambeq.backend.tensor</span></code></a> module, you can define a free <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of vector spaces: objects are defined with the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Dim" title="lambeq.backend.tensor.Dim"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.backend.tensor.Dim</span></code></a> class and morphisms with the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Box" title="lambeq.backend.tensor.Box"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.backend.tensor.Box</span></code></a> class. Composite morphisms are constructed by freely combining the generating morphisms using the <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> operator. This is similar to how <a class="reference internal" href="../glossary.html#term-rigid-category"><span class="xref std std-term">rigid categories</span></a> and <a class="reference internal" href="../glossary.html#term-monoidal-category"><span class="xref std std-term">monoidal categories</span></a> are defined. The concrete value of the tensor is passed to the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute as an unshaped list; <code class="docutils literal notranslate"><span class="pre">lambeq</span></code> will reshape it later based on the input and output dimensions.</p>
<p>It is worth noting that <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Diagram" title="lambeq.backend.tensor.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lambeq.backend.tensor.Diagram</span></code></a> delays the computation of tensor contractions until <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Diagram.eval" title="lambeq.backend.tensor.Diagram.eval"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tensor.Diagram.eval()</span></code></a> is called.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">lambeq.backend.tensor</span> <span class="kn">import</span> <span class="n">Box</span><span class="p">,</span> <span class="n">Diagram</span><span class="p">,</span> <span class="n">Dim</span><span class="p">,</span> <span class="n">Id</span>

<span class="c1"># Dim(1) is the unit object, so disappears when tensored with another Dim</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Dim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Dim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Dim</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dim(1) @ Dim(2) @ Dim(3)=Dim(2, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">id_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="s1">&#39;Id Box&#39;</span><span class="p">,</span> <span class="n">Dim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Dim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">id_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># the actual values of id_box and id_tensor are equal</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">id_box</span><span class="o">.</span><span class="n">array</span> <span class="o">==</span> <span class="n">id_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">id_box</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id_box.eval()=array([[1., 0.],
       [0., 1.]])
</pre></div>
</div>
</div>
</div>
<p>In the <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of vector spaces, <a class="reference internal" href="../glossary.html#term-cup"><span class="xref std std-term">cups</span></a>, <a class="reference internal" href="../glossary.html#term-cap"><span class="xref std std-term">caps</span></a> and <a class="reference internal" href="../glossary.html#term-swap"><span class="xref std std-term">swaps</span></a> take on concrete values as tensors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Diagram</span><span class="o">.</span><span class="n">cups</span><span class="p">(</span><span class="n">Dim</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">Dim</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 0, 0],
       [0, 1, 0],
       [0, 0, 1]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Diagram</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">Dim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Dim</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[[1, 0],
         [0, 0]],

        [[0, 0],
         [1, 0]]],


       [[[0, 1],
         [0, 0]],

        [[0, 0],
         [0, 1]]]])
</pre></div>
</div>
</div>
</div>
<p>To implement a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> from <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Diagram" title="lambeq.backend.grammar.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Diagram</span></code></a> to <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Diagram" title="lambeq.backend.tensor.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">tensor.Diagram</span></code></a>, use a <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.grammar.Functor" title="lambeq.backend.grammar.Functor"><code class="xref py py-class docutils literal notranslate"><span class="pre">grammar.Functor</span></code></a> with <code class="docutils literal notranslate"><span class="pre">target_category</span> <span class="pre">=</span> <span class="pre">lambeq.backend.tensor.tensor</span></code>, and with <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Dim" title="lambeq.backend.tensor.Dim"><code class="xref py py-class docutils literal notranslate"><span class="pre">tensor.Dim</span></code></a> and <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Diagram" title="lambeq.backend.tensor.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">tensor.Diagram</span></code></a> as <code class="docutils literal notranslate"><span class="pre">cod</span></code>, respectively. In addition, <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.tensor.Diagram" title="lambeq.backend.tensor.Diagram"><code class="xref py py-class docutils literal notranslate"><span class="pre">tensor.Diagram</span></code></a>s can be instantiated with concrete values to be evaluated later using a custom tensor contractor. See the implementation of <a class="reference internal" href="../root-api.html#lambeq.TensorAnsatz" title="lambeq.ansatz.tensor.TensorAnsatz"><code class="xref py py-class docutils literal notranslate"><span class="pre">TensorAnsatz</span></code></a> for an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Functor</span>
<span class="kn">from</span> <span class="nn">lambeq.backend</span> <span class="kn">import</span> <span class="n">tensor</span>


<span class="k">def</span> <span class="nf">one_ob</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Dim</span><span class="p">(</span><span class="o">*</span><span class="n">dims</span><span class="p">)</span> <span class="c1"># does Dim(2,2,..)</span>

<span class="k">def</span> <span class="nf">one_ar</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">one_ob</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">dom</span><span class="p">)</span>
    <span class="n">cod</span> <span class="o">=</span> <span class="n">one_ob</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">cod</span><span class="p">)</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">cod</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dom</span> <span class="o">@</span> <span class="n">cod</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">box</span><span class="si">}</span><span class="s1">&quot; becomes&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">box</span>

<span class="n">one_functor</span> <span class="o">=</span> <span class="n">Functor</span><span class="p">(</span>
    <span class="n">target_category</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span>
    <span class="n">ob</span><span class="o">=</span><span class="n">one_ob</span><span class="p">,</span> <span class="n">ar</span><span class="o">=</span><span class="n">one_ar</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">one_diagram</span> <span class="o">=</span> <span class="n">one_functor</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">one_diagram</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">one_diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;This&quot; becomes
[1. 1.]
&quot;is&quot; becomes
[[[[1. 1.]
   [1. 1.]]

  [[1. 1.]
   [1. 1.]]]


 [[[1. 1.]
   [1. 1.]]

  [[1. 1.]
   [1. 1.]]]]
&quot;twisted&quot; becomes
[[1. 1.]
 [1. 1.]]
one_diagram = Diagram(dom=Dim(1), cod=Dim(2), layers=[Layer(left=Dim(1), box=[This; Dim(1) -&gt; Dim(2)], right=Dim(1)), Layer(left=Dim(2), box=[is; Dim(1) -&gt; Dim(2, 2, 2, 2)], right=Dim(1)), Layer(left=Dim(2, 2, 2, 2, 2), box=[twisted; Dim(1) -&gt; Dim(2, 2)], right=Dim(1)), Layer(left=Dim(2, 2, 2, 2), box=[CUP; Dim(2, 2) -&gt; Dim(1)], right=Dim(2)), Layer(left=Dim(2, 2, 2), box=[CUP; Dim(2, 2) -&gt; Dim(1)], right=Dim(1)), Layer(left=Dim(1), box=[CUP; Dim(2, 2) -&gt; Dim(1)], right=Dim(2))])
</pre></div>
</div>
<img alt="../_images/9e0cfd53ba140a8d91bbbb2e4269c95cabe60c31a7e3b3d398758b3007c535b8.png" src="../_images/9e0cfd53ba140a8d91bbbb2e4269c95cabe60c31a7e3b3d398758b3007c535b8.png" />
</div>
</div>
</section>
<section id="quantum-discocat-quantum-circuits">
<h2>Quantum DisCoCat: Quantum circuits<a class="headerlink" href="#quantum-discocat-quantum-circuits" title="Link to this heading">¶</a></h2>
<p>The quantum version of <a class="reference internal" href="../glossary.html#term-DisCoCat"><span class="xref std std-term">DisCoCat</span></a> sends diagrams in the <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of pregroup derivations to <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">circuits</span></a> in the category of Hilbert spaces <strong>FHilb</strong>. This is a <a class="reference internal" href="../glossary.html#term-compact-closed-category"><span class="xref std std-term">compact closed</span></a> monoidal category with Hilbert spaces (e.g. <span class="math notranslate nohighlight">\(\mathbb{C}^{2^n}\)</span>) as objects and unitary maps between Hilbert spaces as morphisms.</p>
<p>The <a class="reference internal" href="../lambeq.backend.html#module-lambeq.backend.quantum" title="lambeq.backend.quantum"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lambeq.backend.quantum</span></code></a> module is a framework for the free <a class="reference internal" href="../glossary.html#term-category"><span class="xref std std-term">category</span></a> of <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">quantum circuits</span></a>: objects are generated using the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Ty" title="lambeq.backend.quantum.Ty"><code class="xref py py-class docutils literal notranslate"><span class="pre">quantum.Ty</span></code></a> class and morphisms by using the available <a class="reference internal" href="../glossary.html#term-quantum-gate"><span class="xref std std-term">quantum gates</span></a> which are subclasses of <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Box" title="lambeq.backend.quantum.Box"><code class="xref py py-class docutils literal notranslate"><span class="pre">quantum.Box</span></code></a>. In <code class="docutils literal notranslate"><span class="pre">lambeq</span></code>, rotation values range from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(1\)</span> rather than from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(2\pi\)</span>. The circuit can then either be evaluated using tensor contraction with the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Diagram.eval" title="lambeq.backend.quantum.Diagram.eval"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eval()</span></code></a> method, or exported to <a class="reference internal" href="../glossary.html#term-pytket"><span class="xref std std-term">pytket</span></a> using the <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Diagram.to_tk" title="lambeq.backend.quantum.Diagram.to_tk"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_tk()</span></code></a> method, which supports multiple hardware backends.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.quantum</span> <span class="kn">import</span> <span class="n">CX</span><span class="p">,</span> <span class="n">Id</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">Rz</span><span class="p">,</span> <span class="n">X</span>


<span class="n">circuit</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">circuit</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">CX</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">circuit</span> <span class="o">&gt;&gt;=</span> <span class="n">CX</span> <span class="o">@</span> <span class="n">CX</span>
<span class="n">circuit</span> <span class="o">&gt;&gt;=</span> <span class="n">Rz</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">same_circuit</span> <span class="o">=</span> <span class="p">(</span><span class="n">Id</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">circuit</span> <span class="o">==</span> <span class="n">same_circuit</span>

<span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">draw_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">to_tk</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/00b888e03556780726960ecf53559ce33602e649089a9cf0c91d6d859e2fb3ef.png" src="../_images/00b888e03556780726960ecf53559ce33602e649089a9cf0c91d6d859e2fb3ef.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tk.Circuit(4).CX(1, 2).X(3).CX(0, 1).CX(2, 3).Rz(0.2, 0).Rz(0.4, 1).Rz(0.6, 2).Rz(0.8, 3)
</pre></div>
</div>
</div>
</div>
<p>To apply multi-qubit <a class="reference internal" href="../glossary.html#term-quantum-gate"><span class="xref std std-term">gates</span></a> to non-consecutive <a class="reference internal" href="../glossary.html#term-qubit"><span class="xref std std-term">qubits</span></a>, use <a class="reference internal" href="../glossary.html#term-swap"><span class="xref std std-term">swaps</span></a> to permute the wires, apply the <a class="reference internal" href="../glossary.html#term-quantum-gate"><span class="xref std std-term">gate</span></a>, then unpermute the wires. These <a class="reference internal" href="../glossary.html#term-swap"><span class="xref std std-term">swaps</span></a> are only logical swaps and do not result in more gates when converted to <a class="reference internal" href="../glossary.html#term-tket"><span class="xref std std-term">tket</span></a> format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.quantum</span> <span class="kn">import</span> <span class="n">Diagram</span> <span class="k">as</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">SWAP</span>

<span class="c1"># to apply a CNOT on qubits 2 and 0:</span>
<span class="n">circuit1</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circuit1</span> <span class="o">&gt;&gt;=</span> <span class="n">SWAP</span> <span class="o">@</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circuit1</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">SWAP</span>
<span class="n">circuit1</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">CX</span>
<span class="n">circuit1</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">SWAP</span>
<span class="n">circuit1</span> <span class="o">&gt;&gt;=</span> <span class="n">SWAP</span> <span class="o">@</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># or you can do</span>
<span class="n">perm</span> <span class="o">=</span> <span class="n">Circuit</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">circuit1</span><span class="o">.</span><span class="n">dom</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">circuit2</span> <span class="o">=</span> <span class="n">perm</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">Id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">CX</span> <span class="o">&gt;&gt;</span> <span class="n">perm</span>

<span class="k">assert</span> <span class="n">circuit1</span> <span class="o">==</span> <span class="n">circuit2</span>
<span class="n">circuit1</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">draw_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># no swaps introduced when converting to tket</span>
<span class="n">circuit1</span><span class="o">.</span><span class="n">to_tk</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a055e7e2de2c5f971f872da58063661dbabec26e8da3c926a834d5052a3feeec.png" src="../_images/a055e7e2de2c5f971f872da58063661dbabec26e8da3c926a834d5052a3feeec.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tk.Circuit(3).CX(2, 0)
</pre></div>
</div>
</div>
</div>
<p>We also have long-ranged controlled gates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.quantum</span> <span class="kn">import</span> <span class="n">Controlled</span><span class="p">,</span> <span class="n">Rz</span><span class="p">,</span> <span class="n">X</span>

<span class="p">(</span><span class="n">Controlled</span><span class="p">(</span><span class="n">Rz</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">distance</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Controlled</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">distance</span><span class="o">=-</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">draw_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Controlled</span><span class="p">(</span><span class="n">Controlled</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">distance</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">draw_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cd20f1dcf1d163788e0f3799ef5e4ca6aba6b316d564b2c4fb062b78499462ed.png" src="../_images/cd20f1dcf1d163788e0f3799ef5e4ca6aba6b316d564b2c4fb062b78499462ed.png" />
<img alt="../_images/01cdf8bb56db8776908d51ca0d8db34207601efe5b6a5a1bd209e52ffff0270c.png" src="../_images/01cdf8bb56db8776908d51ca0d8db34207601efe5b6a5a1bd209e52ffff0270c.png" />
</div>
</div>
<p>So far, our <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">circuits</span></a> have been “pure” circuits, consisting of unitaries. Pure circuits can be evaluated locally to return a unitary <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array. Circuits containing <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Discard" title="lambeq.backend.quantum.Discard"><code class="xref py py-class docutils literal notranslate"><span class="pre">Discard</span></code></a>s and <a class="reference internal" href="../lambeq.backend.html#lambeq.backend.quantum.Measure" title="lambeq.backend.quantum.Measure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Measure</span></code></a>s are considered “mixed”, and return non-unitary <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays when evaluated, as they are classical-quantum maps (for more details, see Chapter 5 in <span id="id4">[<a class="reference internal" href="../bibliography.html#id20" title="Chris Heunen and Jamie Vicary. Introduction to Categorical Quantum Mechanics. http://www.cs.ox.ac.uk/people/jamie.vicary/IntroductionToCategoricalQuantumMechanics.pdf, 2013. [Accessed 01-10-2024].">HV13</a>]</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.quantum</span> <span class="kn">import</span> <span class="n">Discard</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Ket</span><span class="p">,</span> <span class="n">Bra</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Discard</span><span class="p">()</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Measure</span><span class="p">()</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Ket</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># circuits that have measurements in them are no longer unitary</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">Ket</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Measure</span><span class="p">())</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1.+0.j 0.+0.j]
 [0.+0.j 1.+0.j]]

[[[1.+0.j 0.+0.j]
  [0.+0.j 0.+0.j]]

 [[0.+0.j 0.+0.j]
  [0.+0.j 1.+0.j]]]

[1. 0.]

[1.+0.j 0.+0.j]
</pre></div>
</div>
</div>
</div>
<p>Pure <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">circuits</span></a> can be coerced to evaluate into a classical-quantum map representation by setting <code class="docutils literal notranslate"><span class="pre">mixed=True</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CX</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">mixed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[[[[[[1.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 1.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]],




         [[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 1.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [1.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]]],





        [[[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[1.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 1.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]],




         [[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 1.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [1.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]]]],






       [[[[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[1.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 1.+0.j],
             [0.+0.j, 0.+0.j]]]]],




         [[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 1.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [1.+0.j, 0.+0.j]]]]]],





        [[[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[1.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 1.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]],




         [[[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [0.+0.j, 1.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]],



          [[[[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]],


           [[[0.+0.j, 0.+0.j],
             [1.+0.j, 0.+0.j]],

            [[0.+0.j, 0.+0.j],
             [0.+0.j, 0.+0.j]]]]]]]])
</pre></div>
</div>
</div>
</div>
<p>Note that the tensor order of classical-quantum maps is doubled, compared to that of pure quantum circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">CX</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CX</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">mixed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 2, 2, 2)
(2, 2, 2, 2, 2, 2, 2, 2)
</pre></div>
</div>
</div>
</div>
<p>We can implement a <a class="reference internal" href="../glossary.html#term-functor"><span class="xref std std-term">functor</span></a> from <a class="reference internal" href="../glossary.html#term-string-diagram"><span class="xref std std-term">string diagrams</span></a> to <a class="reference internal" href="../glossary.html#term-quantum-circuit"><span class="xref std std-term">quantum circuits</span></a> like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lambeq.backend.grammar</span> <span class="kn">import</span> <span class="n">Functor</span>
<span class="kn">from</span> <span class="nn">lambeq.backend.quantum</span> <span class="kn">import</span> <span class="n">quantum</span><span class="p">,</span> <span class="n">Id</span>


<span class="k">def</span> <span class="nf">cnot_ob</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
    <span class="c1"># this implicitly maps all rigid types to 1 qubit</span>
    <span class="k">return</span> <span class="n">qubit</span> <span class="o">**</span> <span class="nb">len</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cnot_ar</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">dom</span><span class="p">)</span>
    <span class="n">cod</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">cod</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">cod</span><span class="p">)</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">circuit</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">@</span> <span class="n">CX</span><span class="o">.</span><span class="n">to_diagram</span><span class="p">()</span> <span class="o">@</span> <span class="n">Id</span><span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Add Bras (post-selection) and Kets (states)</span>
    <span class="c1"># to get a circuit with the right amount of</span>
    <span class="c1"># input and output wires</span>
    <span class="k">if</span> <span class="n">cod</span> <span class="o">&lt;=</span> <span class="n">dom</span><span class="p">:</span>
        <span class="n">circuit</span> <span class="o">&gt;&gt;=</span> <span class="n">Id</span><span class="p">(</span><span class="n">cod</span><span class="p">)</span> <span class="o">@</span> <span class="n">Bra</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span> <span class="o">-</span> <span class="n">cod</span><span class="p">))</span><span class="o">.</span><span class="n">to_diagram</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">circuit</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="n">dom</span><span class="p">)</span> <span class="o">@</span> <span class="n">Ket</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">cod</span> <span class="o">-</span> <span class="n">dom</span><span class="p">))</span><span class="o">.</span><span class="n">to_diagram</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">circuit</span>
    <span class="k">return</span> <span class="n">circuit</span>

<span class="n">cnot_functor</span> <span class="o">=</span> <span class="n">Functor</span><span class="p">(</span><span class="n">target_category</span><span class="o">=</span><span class="n">quantum</span><span class="p">,</span> <span class="n">ob</span><span class="o">=</span><span class="n">cnot_ob</span><span class="p">,</span> <span class="n">ar</span><span class="o">=</span><span class="n">cnot_ar</span><span class="p">)</span>
<span class="n">diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">cnot_functor</span><span class="p">(</span><span class="n">diagram</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">draw_type_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f7678304bc9848d61774c4b3a1fbb799aebac0fde78be8482b402309d788ec4c.png" src="../_images/f7678304bc9848d61774c4b3a1fbb799aebac0fde78be8482b402309d788ec4c.png" />
<img alt="../_images/a3551fce87fa6160a32f0a2f3051d7bb156c879914a9992a1672f3d276aa6ccb.png" src="../_images/a3551fce87fa6160a32f0a2f3051d7bb156c879914a9992a1672f3d276aa6ccb.png" />
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="extend-lambeq.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Advanced: Extending lambeq</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="monoidal.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Monoidal categories in lambeq</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">DisCoCat in lambeq</a><ul>
<li><a class="reference internal" href="#pregroup-grammars">Pregroup grammars</a></li>
<li><a class="reference internal" href="#functors">Functors</a><ul>
<li><a class="reference internal" href="#example-1-very-functor">Example 1: “Very” functor</a></li>
<li><a class="reference internal" href="#example-2-twist-functor">Example 2: Twist functor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classical-discocat-tensor-networks">Classical DisCoCat: Tensor networks</a></li>
<li><a class="reference internal" href="#quantum-discocat-quantum-circuits">Quantum DisCoCat: Quantum circuits</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=5bfaad31"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>