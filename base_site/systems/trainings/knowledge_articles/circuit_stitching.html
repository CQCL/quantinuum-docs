<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Product Change Notifications" href="../../support/product_change_notifications.html" /><link rel="prev" title="GHZ State Fidelity" href="Quantinuum_n56_ghz_state_fidelity.html" />

    <link rel="shortcut icon" href="../../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.2.1 and Furo 2024.08.06 -->
        <title>Circuit Stitching - Quantinuum Systems</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d7660fb1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Quantinuum Systems</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/systems.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user_guide/hardware_user_guide/access.html">Hardware User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hardware User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/access.html">Quantinuum Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/system_operation.html">System Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/workflow.html">System Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/fair_queue.html">Fair Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/error_measurements.html">Error Measurements</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user_guide/emulator_user_guide/introduction.html">Emulator User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Emulator User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/introduction.html">Quantinuum Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/noise_model.html">Noise Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/emulators/h1_emulators.html">H1 Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/emulators/h2_emulators.html">H2 Emulators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://docs.quantinuum.com/nexus/user_guide/user_guide.html">Nexus User Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.quantinuum.com/nexus/admin_guide/admin_guide.html">Nexus Admin Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Trainings</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/getting_started_index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Getting Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started_index.html">Unique Capabilities</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.quantinuum.com/nexus/trainings/getting_started.html">Quantinuum Nexus</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.quantinuum.com/tket/user-guide/index.html">TKET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/emulators.html">Quantinuum Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/mcmr.html">Mid-Circuit Measurement &amp; Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/arbitrary_angle_2_qubit_gates.html">Native Arbitrary Angle Hardware Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/conditional_operations_and_classical_logic.html">Conditional Operations &amp; Classical Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/batch_jobs.html">Batch Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/api_options.html">Quantinuum Systems API Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/access_systems_with_qiskit.html">Using Qiskit with Quantinuum Devices</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/qec_decoder_toolkit.html">QEC Decoder Toolkit</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of QEC Decoder Toolkit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/qec_decoder_toolkit.html">QEC Decoder Toolkit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/repeat_until_success/rus_index.html">Repeat Until Success</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/repetition_code/repetition_code_index.html">Repetition Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/surface_code/surface_code_index.html">Surface Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/pytket_quantinuum/pytket_quantinuum.html"><code class="docutils literal notranslate"><span class="pre">pytket-quantinuum</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="ka_index.html">Knowledge Articles</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Knowledge Articles</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_chemistry_chemically_aware_ucc.html">Quantum Chemistry Calculations with Arbitrary Angle 2-Qubit Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_high_energy_physics_experiment.html">High Energy Physics: Implementing <span class="math notranslate nohighlight">\(SU(2)\)</span> Lattice Gauge Theory Trotter Circuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_leakage_detection.html">Automatic Leakage Error Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_toric_code.html">Topological Order from Measurements and Feed-Forward</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_variational_experiment_with_batching.html">Variational Experiment with Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_n56_ghz_state_fidelity.html">GHZ State Fidelity</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Circuit Stitching</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support/product_change_notifications.html">Product Change Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/faqs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/quantinuum_systems_citations.html">How to Cite Quantinuum Systems</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="circuit-stitching">
<h1>Circuit Stitching<a class="headerlink" href="#circuit-stitching" title="Link to this heading">¶</a></h1>
<p>Circuit stitching is a workflow to “stitch” multiple jobs into 1 job using mid-circuit measurement and reset (MCMR). Stitching involves appending circuits depth-wise and width-wise across the qubit register. On Quantinuum Systems MCMR is high-fidelity, so users can derive multiple benefits from stitching. The first benefit is the reduction of job runtime because many jobs are stitched into one job submission. For each new job, the system performs a sequence of actions in repetition which contribute to the overall job runtime. However, by “stitching” many jobs into one job these actions are reduced. The second benefit is to minimize Hardware Quantum Credits (HQCs) consumption for experiments consisting of multiple jobs.  Circuit stitching for a 5-qubit classical shadows use case shows a 100x improvement in HQC cost.</p>
<a class="reference internal image-reference" href="../../_images/circuit_stitching_workflow.png"><img alt="../../_images/circuit_stitching_workflow.png" class="align-center" src="../../_images/circuit_stitching_workflow.png" style="width: 1200px;" />
</a>
<p>There are two components to cost jobs in terms of HQCs:</p>
<ol class="arabic simple">
<li><p>Fixed contribution of 5 HQCs for each circuit submitted to Quantinuum Systems for execution</p></li>
<li><p>Circuit-specific cost accounting for the number of gate operations and shots</p></li>
</ol>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
\textrm{HQC} = 5 + \frac{\left( N_{1q} + 10 N_{2q} + 5 N_m \right)}{5000} \times C
\end{equation}\]</div>
</div>
<p>The schematic above shows a basic stitching workflow. Instead of submitting multiple circuits to the system, HQC consumption can be minimized by stitching circuits together depth-wise. Additionally, if the number of qubits needed is smaller than the number of device qubits, then circuits can be stitched in parallel across the qubit register. <a class="reference internal" href="#workflow">Workflow</a> details the necessary steps to perform circuit stitching during program construction. <a class="reference internal" href="#classical-shadows">Classical Shadows</a> demonstrates a 5-qubit GHZ state reconstruction using <a class="reference internal" href="#circuit-stitching">circuit stitching</a> and no stitching.</p>
<p>To ensure optimal performance, the following constraints must be satisfied by the stitched circuit:</p>
<ul class="simple">
<li><p>The size of the underlying QASM program must not exceed 6 MBs.</p></li>
<li><p>The stitched circuit must have a total cost of &lt; 50 HQCs.</p></li>
<li><p>The stitched circuit uses less than the maximum number of classical registers supported by the system.</p></li>
<li><p>The maximum number of bits per classical register is specific to each system and should not be exceeded.</p></li>
<li><p>Each subcircuit, added to the stitched circuit, consumes a new distinct classical register.</p></li>
<li><p>Multiple classical registers would be consumed by subcircuits with MCMR operations.</p></li>
</ul>
<p>The primary advantage of circuit stitching is the reduction in HQCs for classical shadow type use cases, where each shot is a new circuit. Additional benefits in execution time maybe observed since the number of system actions to verify performance is reduced. The 50 HQCs hard limit ensures the chunk, corresponding to the single-shot stitched circuit, does not exceed the <em>chunk duration</em>. This helps minimize impact on system performance. This is discussed further in <a class="reference internal" href="#impact-on-system-operation">System Operation</a>.</p>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">circuit_stitching</span></code> function accepts a list of circuits and first stitches the circuit in parallel, across the qubit register, and then depth-wise. The <code class="docutils literal notranslate"><span class="pre">input_circuit</span></code> list must be consistent in the number of qubits. This routine is followed until all circuits have been stitched. The number of classical registers on the output circuit is equal to the number of circuits stitched together. For parallel stitching, the function first checks the number of qubits in the circuit to be stitched are less than the number of device qubits. If this is true, a parameter, <code class="docutils literal notranslate"><span class="pre">p</span></code>, estimates the number of times the input circuits will fit into the register. Based on this step, a list of list of circuits is constructed. Each sublist is stitched depth-wise. Each circuit in the sublist is stitched in parallel across the register.</p>
<p><strong>Assumptions</strong>:</p>
<ul class="simple">
<li><p>Does not support subcircuits with MCMR operations.</p></li>
<li><p>Assumes all circuits in a subcircuit are measured.</p></li>
<li><p>Each subcircuit (to be stitched) consumes a classical register.</p></li>
</ul>
<p>The end user is encouraged to limit the total number of 2-qubit gates on the stitched circuit to less than 12,500 2-qubit gates. The total number of 2-qubit gates can be derived by inspecting the HQC formula for 1 circuit and assuming 2-qubit gates, <span class="math notranslate nohighlight">\(N_{2q}\)</span>, are the dominant gates on the stitched circuit. In this case, the impact of 1-qubit gates, <span class="math notranslate nohighlight">\(N_{1q}\)</span>, and measurement-gates, <span class="math notranslate nohighlight">\(N_m\)</span>, are negligible (<span class="math notranslate nohighlight">\(N_{1q}\)</span>, <span class="math notranslate nohighlight">\(N_{m}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> 0). The classical shadows use case only requires 1 shot (<span class="math notranslate nohighlight">\(C = 1\)</span>). The stitched circuit must have overall cost below the 50 HQCs hard limit (<span class="math notranslate nohighlight">\(\textrm{HQC} = 50\)</span>),</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
N_{2q} \approx 22,500 \quad \textrm{when} \quad N_{1q}, N_{m} \rightarrow 0 \quad \textrm{and} \quad C = 1.
\end{equation}\]</div>
</div>
<p>The reset operation is required to stitch measurement circuits. After each measurement operation a  operation is applied to set the qubit to the <span class="math notranslate nohighlight">\(|0 \rangle\)</span> state before proceeding with the operations in the next subcircuit. The method below generates a circuit with reset operations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">CircBox</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reset_operations</span><span class="p">(</span>
    <span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CircBox</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate a n-qubit CircBox instance containing OpType.Reset operations.</span>

<span class="sd">    :param n_qubits: Number of qubits used in the CircBox instance</span>
<span class="sd">    :param_type int:</span>
<span class="sd">    :returns: CircBox</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Reset&quot;</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">circuit</span><span class="o">.</span><span class="n">qubits</span><span class="p">:</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">Reset</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">CircBox</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">circuit_stitching</span></code> function allow a list of circuits to be stitched together. The second positional argument, <code class="docutils literal notranslate"><span class="pre">BackendInfo</span></code>, is used to determine how many circuits can be stitched in parallel across the qubit register. Note that <code class="docutils literal notranslate"><span class="pre">BackendInfo</span></code> is a pytket class, following a certain specification. The <code class="docutils literal notranslate"><span class="pre">_add_circuits</span></code> function is used to add circuits to a global circuit instance.</p>
<a class="reference internal image-reference" href="../../_images/stitching_workflow.png"><img alt="../../_images/stitching_workflow.png" class="align-center" src="../../_images/stitching_workflow.png" style="width: 1200px;" />
</a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">CircBox</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">,</span> <span class="n">BitRegister</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.backends.backendinfo</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackendInfo</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_add_circuit</span><span class="p">(</span>
    <span class="n">circuit_instance</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">,</span>
    <span class="n">circbox</span><span class="p">:</span> <span class="n">CircBox</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">qubits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Qubit</span><span class="p">],</span>
    <span class="n">resetbox</span><span class="p">:</span> <span class="n">CircBox</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="n">creg</span> <span class="o">=</span> <span class="n">circuit_instance</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;creg_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">))</span>
    <span class="n">circuit_instance</span><span class="o">.</span><span class="n">add_circbox</span><span class="p">(</span><span class="n">circbox</span><span class="p">,</span> <span class="n">qubits</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">creg</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">resetbox</span><span class="p">:</span>
        <span class="n">circuit_instance</span><span class="o">.</span><span class="n">add_circbox</span><span class="p">(</span><span class="n">resetbox</span><span class="p">,</span> <span class="n">qubits</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">circuit_stitching</span><span class="p">(</span>
    <span class="n">input_circuits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Circuit</span><span class="p">],</span> 
    <span class="n">backend_info</span><span class="p">:</span> <span class="n">BackendInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Circuit</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">BitRegister</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate a stitched circuit based on a list of input circuits. The circuit is </span>
<span class="sd">    stitched width-wise and then depth-wise.</span>

<span class="sd">    :param input_circuit: Circuit instance to stitch `n` times.</span>
<span class="sd">    :param backend_info: BackendInfo instance containing information on number </span>
<span class="sd">        of device qubits, number of allowed classical register and maximum width </span>
<span class="sd">        for each classical register.</span>
<span class="sd">    :returns: Circuit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">input_circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n_qubits</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">n_qubits</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">input_circuits</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All circuits should have the same number of qubits.&quot;</span><span class="p">)</span>
    <span class="n">n_qubits_device</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">backend_info</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span><span class="n">n_qubits_device</span><span class="p">,</span> <span class="n">input_circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="n">num_c_reg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits_device</span><span class="p">)</span>
    <span class="n">reset_box</span> <span class="o">=</span> <span class="n">reset_operations</span><span class="p">(</span><span class="n">input_circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n_qubits</span><span class="p">)</span>

    <span class="n">circuits_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_circuits</span><span class="p">),</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">circuits_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">input_circuits</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">p</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">circuits</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">circuits_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">circuits</span><span class="p">):</span>
            <span class="n">circ</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;box_</span><span class="si">{</span><span class="n">num_c_reg</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">circ</span><span class="o">.</span><span class="n">n_qubits</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">circ</span><span class="o">.</span><span class="n">n_qubits</span>
            <span class="n">qubits</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="n">a</span><span class="p">:</span> <span class="n">b</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">circuits_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">reset_box</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">_add_circuit</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">CircBox</span><span class="p">(</span><span class="n">circ</span><span class="p">),</span> <span class="n">num_c_reg</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="n">resetbox</span><span class="o">=</span><span class="n">reset_box</span><span class="p">)</span>
            <span class="n">num_c_reg</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
</div>
<p>The classical register needs to be extracted from the stitched circuit and sorted by name. This data is required to destitch the measurement result. If the job submission process is across multiple python sessions, then the classical registers from the stitched circuit need to be saved to local disk. The <code class="docutils literal notranslate"><span class="pre">save_classical_registers</span></code> function performs this task and optionally saves the data to a file, if a filename is specified. The function requires a list of <code class="docutils literal notranslate"><span class="pre">BitRegister</span></code> instances and an optional filename. The output is a list of <code class="docutils literal notranslate"><span class="pre">BitRegister</span></code> sorted by the integer suffix in the register name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">BitRegister</span>

<span class="k">def</span><span class="w"> </span><span class="nf">save_classical_registers</span><span class="p">(</span>
    <span class="n">registers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BitRegister</span><span class="p">],</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BitRegister</span><span class="p">]:</span>
    <span class="n">registers</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">register_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">reg</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">reg</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">registers</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">json_io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">registers</span><span class="p">)</span>
        <span class="n">json_io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">registers</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">load_classical_registers</span></code> loads in classical register data stored in json format on local disk. This is required to load data saved using <code class="docutils literal notranslate"><span class="pre">save_classical_registers</span></code>. The <code class="docutils literal notranslate"><span class="pre">load_classical_registers</span></code> function requires the filepath as input and outputs a python list of <code class="docutils literal notranslate"><span class="pre">BitRegister</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">BitRegister</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_classical_registers</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BitRegister</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_io</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_io</span><span class="p">)</span>
    <span class="n">register_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">BitRegister</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">register_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">register_list</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">destitch_results</span></code> destitches results, i.e it converts the measurement result from the stitched circuit execution into a python list of measurement results. Each measurement result in the list corresponds to a subcircuit on the stitched circuit. The measurement result and a list of classical registers (used by the stitched circuit), are required as input. The classical register list corresponds to each subcircuit on the stitched circuit and respects the ordering of the subcircuits. The measurement result contains the shot distribution and is represented by the <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> object. <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> allows the user to represent the measurement result as a shot table, or as a python dict, mapping bitstrings to either a probability or a count of occurrence. In addition, measurement data can be retrieved for a specified classical register. The class <code class="docutils literal notranslate"><span class="pre">OutcomeArray</span></code> is used internally within <code class="docutils literal notranslate"><span class="pre">destitch_results</span></code> to read and compress the measurement data for a specific classical register.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.backends.backendresult</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackendResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.utils.outcomearray</span><span class="w"> </span><span class="kn">import</span> <span class="n">OutcomeArray</span>

<span class="k">def</span><span class="w"> </span><span class="nf">destitch_results</span><span class="p">(</span>
    <span class="n">stitched_result</span><span class="p">:</span> <span class="n">BackendResult</span><span class="p">,</span>
    <span class="n">register_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BitRegister</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BackendResult</span><span class="p">]:</span>
    <span class="n">destitched_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">register_list</span><span class="p">:</span>
        <span class="n">outcome_array</span> <span class="o">=</span> <span class="n">OutcomeArray</span><span class="o">.</span><span class="n">from_readouts</span><span class="p">(</span><span class="n">stitched_result</span><span class="o">.</span><span class="n">get_shots</span><span class="p">(</span><span class="n">reg</span><span class="p">))</span>
        <span class="n">destitched_results</span> <span class="o">+=</span> <span class="p">[</span><span class="n">BackendResult</span><span class="p">(</span><span class="n">shots</span><span class="o">=</span><span class="n">outcome_array</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">destitched_results</span>
</pre></div>
</div>
</div>
</div>
<p>The size of the underlying QASM program can be estimated using <code class="docutils literal notranslate"><span class="pre">estimate_qasm_program_size</span></code>. All stitched circuits must be below the QASM program size limit of 6 MBs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.qasm</span><span class="w"> </span><span class="kn">import</span> <span class="n">circuit_to_qasm_str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">estimate_qasm_program_size</span><span class="p">(</span>
    <span class="n">circuit</span><span class="p">:</span> <span class="n">Circuit</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">qasm_str</span> <span class="o">=</span> <span class="n">circuit_to_qasm_str</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;hqslib1&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">qasm_str</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="impact-on-system-operation">
<h2>Impact on System Operation<a class="headerlink" href="#impact-on-system-operation" title="Link to this heading">¶</a></h2>
<p>System actions, such as validations or calibrations, are periodically executed to ensure maximal system performance, during system operation. Jobs are submitted to the hardware with an integer-number of shots specified by the user. Circuits are split into chunks of shots executed together. The number of shots in a single chunk is chosen so that the execution of a single chunk does not cause too much time to elapse between calibrations and validations.</p>
<a class="reference internal image-reference" href="../../_images/chunking_with_stitching.png"><img alt="../../_images/chunking_with_stitching.png" class="align-center" src="../../_images/chunking_with_stitching.png" style="width: 1200px;" />
</a>
<p>Stitching subcircuits into one large circuit will result in the group of subcircuits being run as a single chunk, reducing the number of calibrations or validations undertaken during execution of the group of subcircuits and providing wall-clock time savings for circuit execution of all the subcircuits. However, to ensure minimal impact on system performance, the 50 HQCs limit ensures the execution time for the single chunk of a large, stitched, single-shot, single-circuit does not exceed the maximum duration threshold between validations and calibrations on the system.</p>
<p>Improvement in wall-clock time savings for circuit execution may be offset by repeated chunk invalidation. If the execution of the single chunk of the large stitched circuit consistently fails, this can affect system throughput and the overall execution time of the stitched circuit.</p>
<a class="reference internal image-reference" href="../../_images/chunk_duration.png"><img alt="../../_images/chunk_duration.png" class="align-center" src="../../_images/chunk_duration.png" style="width: 800px;" />
</a>
</section>
<section id="backend-information">
<h2>Backend Information<a class="headerlink" href="#backend-information" title="Link to this heading">¶</a></h2>
<p>Device specific information can be retrieved using the <code class="docutils literal notranslate"><span class="pre">get_all</span></code> function. Using the <code class="docutils literal notranslate"><span class="pre">issuers</span></code> kwarg filters the output to only include Quantinuum targets. This information can be visualized as a pandas dataframe using <code class="docutils literal notranslate"><span class="pre">.df()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">qnexus</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qnx</span>

<span class="n">devices</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">issuers</span><span class="o">=</span><span class="p">[</span><span class="n">qnx</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">IssuerEnum</span><span class="o">.</span><span class="n">QUANTINUUM</span><span class="p">])</span>

<span class="n">devices_df</span> <span class="o">=</span> <span class="n">devices</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
<span class="n">devices_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">BackendInfo</span></code> can be retrieved using the Nexus <code class="docutils literal notranslate"><span class="pre">Device</span></code> class and filtering for the desired Quantinuum System using the pandas DataFrame output. From <code class="docutils literal notranslate"><span class="pre">BackendInfo</span></code>, the maximum number of classical registers and the maximum width (maximum number of bits in 1 register) are reported. These parameters are required for the client-side circuit stitching procedure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">device_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;H2-1&quot;</span><span class="p">,</span> <span class="s2">&quot;H1-1&quot;</span><span class="p">]:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">devices_df</span><span class="p">[</span><span class="n">devices_df</span><span class="p">[</span><span class="s2">&quot;device_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H2-1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">backend_info</span> <span class="o">=</span> <span class="n">devices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">backend_info</span>
    <span class="n">n_cl_reg</span> <span class="o">=</span> <span class="n">backend_info</span><span class="o">.</span><span class="n">n_cl_reg</span>
    <span class="n">max_classical_register_width</span> <span class="o">=</span> <span class="n">backend_info</span><span class="o">.</span><span class="n">get_misc</span><span class="p">(</span><span class="s2">&quot;max_classical_register_width&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum number of classical registers (</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">n_cl_reg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum number of bits in 1 classical register (</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">max_classical_register_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="classical-shadows">
<h2>Classical Shadows<a class="headerlink" href="#classical-shadows" title="Link to this heading">¶</a></h2>
<p>Estimating properties of unknown quantum states is a key objective of quantum computing. Classical shadow approximation is one method to estimate those properties [<a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_classical_shadows/#huang2020">Huang et al</a>]. The workflow presented below reconstructs the classical shadow representation of an unknown quantum state. Initially, an <span class="math notranslate nohighlight">\(n\)</span>-qubit quantum state is prepared by a circuit, and a unitary, <span class="math notranslate nohighlight">\(\hat{U}\)</span>, is applied,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
    \rho \rightarrow \hat{U} \rho \hat{U}^{\dagger}.
\end{equation}\]</div>
</div>
<p>Next, we measure in the computational basis and obtain a bit string of outcomes <span class="math notranslate nohighlight">\(|b \rangle = |0011...10\rangle\)</span>. If the unitaries, <span class="math notranslate nohighlight">\(\hat{U}\)</span>, are chosen at random from a particular ensemble, then we can store the reverse operation, <span class="math notranslate nohighlight">\(\hat{U} | b \rangle \langle b | \hat{U}^{\dagger}\)</span>, efficiently in classical memory. We call this a snapshot of the state. Moreover, we can view the average over these snapshots as a measurement channel,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
E \left[\hat{U} | b \rangle \langle b | \hat{U}^{\dagger} \right] = M(\rho).
\end{equation}\]</div>
</div>
<p>If the ensemble of unitaries defines a tomographically complete set of measurements, we can invert the channel and reconstruct the state,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
\rho = E \left[ M^{-1} \left( \hat{U} | b \rangle \langle b | \hat{U}^{\dagger} \right) \right]
\end{equation}\]</div>
</div>
<p>If we apply the procedure outlined above <span class="math notranslate nohighlight">\(N\)</span> times, then the collection of inverted snapshots is what we call the classical shadow,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
    S(\rho, N) = \left\{ \hat{\rho}_1 = M^{-1} \left( \hat{U}_1 | b_1 \rangle \langle b_1 | \hat{U}^{\dagger}_1 \right), ... , \hat{\rho}_N = M^{-1} \left( \hat{U}_N | b_N \rangle \langle b_N | \hat{U}^{\dagger}_N \right) \right\}.
\end{equation}\]</div>
</div>
<p>The workflow below will demonstrate GHZ state construction from classical shadows initially without circuit stitching and subsequently with stitching to reduce HQC consumption.</p>
<p>THe <code class="docutils literal notranslate"><span class="pre">create_measurement_basis</span></code> function generates a subcircuit containing measurement operations on qubits to measure in <span class="math notranslate nohighlight">\(X\)</span>, <span class="math notranslate nohighlight">\(Y\)</span> or <span class="math notranslate nohighlight">\(Z\)</span> Pauli bases. This function requires a <a class="reference external" href="https://tket.quantinuum.com/api-docs/pauli.html#pytket.pauli.QubitPauliString"><code class="docutils literal notranslate"><span class="pre">pytket.pauli.QubitPauliString</span></code></a> as input and based on the <a class="reference external" href="https://tket.quantinuum.com/api-docs/pauli.html#pytket.pauli.Pauli"><code class="docutils literal notranslate"><span class="pre">pytket.pauli.Pauli</span></code></a> operation on each qubit, performs the relevant basis transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">choice</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">Bit</span><span class="p">,</span> <span class="n">Qubit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementSetup</span><span class="p">,</span> <span class="n">MeasurementBitMap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.pauli</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_measurement_basis</span><span class="p">(</span>
    <span class="n">qps</span><span class="p">:</span> <span class="n">QubitPauliString</span><span class="p">,</span> 
    <span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Circuit</span><span class="p">:</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">pauli</span> <span class="ow">in</span> <span class="n">qps</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">bit</span> <span class="o">=</span> <span class="n">Bit</span><span class="p">(</span><span class="n">qubit</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">add_bit</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pauli</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">pauli</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">pauli</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">construct_randomized_shadows</span></code> function returns a list of circuits measuring pseudo-random qubit Pauli words and a <code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code> object which contains information on how each measurement circuit relates to Pauli word. Each circuit contains <a class="reference external" href="https://tket.quantinuum.com/api-docs/optype.html#pytket.circuit.OpType"><code class="docutils literal notranslate"><span class="pre">OpType.Measure</span></code></a> operations and basis transformations gates. The number of subcircuits is determined by the input parameter <code class="docutils literal notranslate"><span class="pre">measurement_budget</span></code>. This function calls <code class="docutils literal notranslate"><span class="pre">create_measurement_basis</span></code> internally. The number of qubits, <code class="docutils literal notranslate"><span class="pre">n_qubits</span></code>, also needs to be passed as an integer. The <code class="docutils literal notranslate"><span class="pre">n_qubits</span></code> input must be equal to the number of qubits on the state preparation circuit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">construct_randomized_shadows</span><span class="p">(</span>
    <span class="n">measurement_budget</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Circuit</span><span class="p">],</span> <span class="n">MeasurementSetup</span><span class="p">]:</span>
    <span class="n">measurement_setup</span> <span class="o">=</span> <span class="n">MeasurementSetup</span><span class="p">()</span>
    <span class="n">circuit_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">PAULIS</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">measurement_budget</span><span class="p">):</span>
        <span class="n">qps</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="n">choice</span><span class="p">(</span><span class="n">PAULIS</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)})</span>
        <span class="n">measurement_circ</span> <span class="o">=</span> <span class="n">create_measurement_basis</span><span class="p">(</span><span class="n">qps</span><span class="p">,</span> <span class="n">n_qubits</span><span class="p">)</span>
        <span class="n">circuit_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">measurement_circ</span><span class="p">]</span>
        <span class="n">measurement_setup</span><span class="o">.</span><span class="n">add_measurement_circuit</span><span class="p">(</span><span class="n">measurement_circ</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qps</span> <span class="o">==</span> <span class="n">QubitPauliString</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qps_items</span> <span class="o">=</span> <span class="n">qps</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qps_items</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qps</span><span class="o">.</span><span class="n">map</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">qps_items</span><span class="p">:</span>
            <span class="n">bits</span> <span class="o">+=</span> <span class="p">[</span><span class="n">qubit</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bits</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">bitmap</span> <span class="o">=</span> <span class="n">MeasurementBitMap</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">bits</span><span class="p">)</span>
            <span class="n">measurement_setup</span><span class="o">.</span><span class="n">add_result_for_term</span><span class="p">(</span><span class="n">qps</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circuit_list</span><span class="p">,</span> <span class="n">measurement_setup</span>
</pre></div>
</div>
</div>
</div>
<p>The code below generates 100 subcircuits each with 5 qubits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">measurement_budget</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">mcircs</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">construct_randomized_shadows</span><span class="p">(</span><span class="n">measurement_budget</span><span class="p">,</span> <span class="n">n_qubits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The code below synthesizes the 5-qubit GHZ state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span>

<span class="n">ghz_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="n">ghz_circuit</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Nexus project for classical shadows is created here and is required before submission to Quantinuum Systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">qnexus</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="s2">&quot;classical_shadows&quot;</span><span class="p">)</span>
<span class="n">qnx</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set_active_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<span class="n">name_suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">-%H_%M_%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The Quantinuum Configuration, <code class="docutils literal notranslate"><span class="pre">qnx.QuantinuumConfig</span></code>, is initialized to target the Nexus <code class="docutils literal notranslate"><span class="pre">H1-Emulator</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">QuantinuumConfig</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;H1-Emulator&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The code below generates each measurement circuit by appending the measurement subcircuit to a copy of the state preparation circuit. The circuits are uploaded to the Nexus server, and the circuit references are collated into a python list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_ref_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mcircs</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;classical_shadow_circuit-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="n">circuit_ref</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">circuits</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">circuit_ref_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">circuit_ref</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The circuit references are submitted as a compile job to Nexus. The job will compiled uploaded classical shadows measurement circuits into circuits using the native Quantinuum gate set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compile_ref_list</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">start_compile_job</span><span class="p">(</span>
    <span class="n">circuits</span><span class="o">=</span><span class="n">circuit_ref_list</span><span class="p">,</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;compile-job-classical-shadows-</span><span class="si">{</span><span class="n">name_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Compile classical shadows jobs&quot;</span><span class="p">,</span>
    <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The compiled circuit references are retrieved. Retrieval is blocked until all compile jobs are completed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_status</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">compile_ref_list</span><span class="p">)</span>
<span class="n">compiled_circuit_ref_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">compile_ref_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>The HQC credit cost for all the circuits is reported using the <code class="docutils literal notranslate"><span class="pre">cost</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_cost_no_stitching</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">qnx</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">circuits</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backend_config</span><span class="o">=</span><span class="n">qnx</span><span class="o">.</span><span class="n">QuantinuumConfig</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;H1-1&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">compiled_circuit_ref_list</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Cost (No Stitching): </span><span class="si">{</span><span class="n">total_cost_no_stitching</span><span class="si">}</span><span class="s2"> HQC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The compiled circuit references are submitted as part of a execute job to a Nexus-hosted Quantinuum emulator. Each circuit will be emulated with 1 shot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">execute_job_ref_list</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">start_execute_job</span><span class="p">(</span>
    <span class="n">circuits</span><span class="o">=</span><span class="n">compiled_circuit_ref_list</span><span class="p">,</span>
    <span class="n">n_shots</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">compiled_circuit_ref_list</span><span class="p">],</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;classical-shadows-execute-job-</span><span class="si">{</span><span class="n">name_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Submission of classical shadows execute job to Nexus-hosted quantinuum emulator&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The measurement result is retrieved and downloaded into a local instance of <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code>. Retrieval is blocked until all execute jobs are completed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_status</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">execute_job_ref_list</span><span class="p">)</span>
<span class="n">execute_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">download_result</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">execute_job_ref_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>If the ensemble of unitaries defines a tomographically complete set of measurements, we can invert the channel and reconstruct the state,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
\rho = E \left[ M^{-1} \left( \hat{U} | b \rangle \langle b | \hat{U}^{\dagger} \right) \right].
\end{equation}\]</div>
</div>
<p>The inverse measurement channel can be computed explicitly and this defined in the expression for the reconstructed <span class="math notranslate nohighlight">\(\rho\)</span>.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{equation}
    \hat{\rho} = \bigotimes_{j=1}^{n} \left( 3 \hat{U}_j^{\dagger} | \hat{b}_j \rangle \langle \hat{b}_j | \hat{U}_j - I \right).
\end{equation}\]</div>
</div>
<p>The snapshot, <span class="math notranslate nohighlight">\(\rho\)</span>, would be averaged over multiple rounds.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">shadow_reconstruction</span></code> function requires <code class="docutils literal notranslate"><span class="pre">results</span></code> (<code class="docutils literal notranslate"><span class="pre">List[BackendResult]</span></code>) and <code class="docutils literal notranslate"><span class="pre">measurement_setup</span></code> (from pytket’s <code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code> class) as inputs. The output is an averaged snapshot of the GHZ state, reconstructed from its classical shadow. The function iterates over the <code class="docutils literal notranslate"><span class="pre">results</span></code> property to access the <code class="docutils literal notranslate"><span class="pre">QubitPauliString</span></code> and metadata necessary for post-processing. Specifically, the measurement result required for post-processing and the classical bits it spans. Each <code class="docutils literal notranslate"><span class="pre">Pauli</span></code> and the value of its corresponding <code class="docutils literal notranslate"><span class="pre">Bit</span></code> are used to compute a snapshot of the GHZ state, using the expression for <span class="math notranslate nohighlight">\(\rho\)</span>. The <code class="docutils literal notranslate"><span class="pre">Pauli</span></code> is used to invert the measurement channel classically. This snapshot is averaged over all the shots captured in the measurement data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.backends.backendresult</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackendResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementSetup</span>

<span class="k">def</span><span class="w"> </span><span class="nf">shadow_reconstruction</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BackendResult</span><span class="p">],</span> 
    <span class="n">measurement_setup</span><span class="p">:</span> <span class="n">MeasurementSetup</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">zero_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">one_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>  
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">vdg</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">identity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">shadow_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">bitmap_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">measurement_setup</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">bm</span> <span class="ow">in</span> <span class="n">bitmap_list</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">circ_index</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bm</span><span class="o">.</span><span class="n">bits</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_qubits</span>
            <span class="n">rho_snapshot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pauli</span><span class="p">,</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">qps</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">get_shots</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">bit</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">one_state</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">zero_state</span>
                
                <span class="k">if</span> <span class="n">pauli</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">H</span>
                <span class="k">elif</span> <span class="n">pauli</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">vdg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">identity</span>
                <span class="n">local_rho</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">state</span> <span class="o">@</span> <span class="n">op</span><span class="p">)</span> <span class="o">-</span> <span class="n">identity</span>
                <span class="n">rho_snapshot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">rho_snapshot</span><span class="p">,</span> <span class="n">local_rho</span><span class="p">)</span>
            <span class="n">shadow_rho</span> <span class="o">+=</span> <span class="n">rho_snapshot</span>
    <span class="k">return</span> <span class="n">shadow_rho</span> <span class="o">/</span> <span class="n">measurement_budget</span>
</pre></div>
</div>
</div>
</div>
<p>The averaged snapshot of the GHZ state is approximated using <code class="docutils literal notranslate"><span class="pre">shadow_reconstruction</span></code> for the calculation without circuit stitching.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shadow_state</span> <span class="o">=</span> <span class="n">shadow_reconstruction</span><span class="p">(</span><span class="n">execute_results</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The theoretical GHZ state is computed in the code below and will be used as a baseline to estimate errors using circuit stitching.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>

<span class="n">ghz_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Circuit Stitching<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>For Classical Shadows use cases, each shot requires a new circuit. The 5 HQCs offset cost most often dominates the total HQC cost. For the 5-qubit GHZ classical shadows workflow without circuit stitching, 500 HQCs are required. With circuit stitching, a 100x decrease in HQCs can be demonstrated because all circuits can be stitched together into 1 circuit. Using the maximum 2-qubit gate number defined in <a class="reference internal" href="#workflow">Workflow</a>, allows estimation of the maximum number of subcircuits that can be stitched into 1 circuit,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">22500</span> <span class="o">/</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">n_2qb_gates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The measurement circuits (GHZ state fidelity and measurement operations) are collated into a list and then stitched using <code class="docutils literal notranslate"><span class="pre">circuit_stitching</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="n">mcircs</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="n">circuits</span> <span class="o">+=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

<span class="n">stitched_circuit</span> <span class="o">=</span> <span class="n">circuit_stitching</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The size of the stitched circuit can be estimated using <code class="docutils literal notranslate"><span class="pre">estimate_qasm_program_size</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qasm_program_size</span> <span class="o">=</span> <span class="n">estimate_qasm_program_size</span><span class="p">(</span><span class="n">stitched_circuit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qasm_program_size</span><span class="si">}</span><span class="s2"> MBs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The classical registers on the stitched circuit are ordered, but not saved to local disk. Each classical register and its position in the list corresponds to each subcircuit and its ordering within the stitched circuit. The first classical register (first subcircuit) and the last classical register (last subcircuit) are reported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registers</span> <span class="o">=</span> <span class="n">save_classical_registers</span><span class="p">(</span><span class="n">stitched_circuit</span><span class="o">.</span><span class="n">c_registers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First register on the stitched circuit</span><span class="se">\n</span><span class="s2">Name:</span><span class="si">{</span><span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">Size: </span><span class="si">{</span><span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bits&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last register on the stithced circuit</span><span class="se">\n</span><span class="s2">Name:</span><span class="si">{</span><span class="n">registers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">Size: </span><span class="si">{</span><span class="n">registers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The stitched circuit is uploaded to Nexus and subsequently compiled remotely, and executed on the Nexus-hosted Quantinuum emulator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_ref_stitched</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">circuits</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">circuit</span><span class="o">=</span><span class="n">stitched_circuit</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;stitched_classical_shadows_circuit&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;stitched classical shadows circuit before compilation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compiled_job_stitched</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">start_compile_job</span><span class="p">(</span>
    <span class="n">circuits</span><span class="o">=</span><span class="p">[</span><span class="n">circuit_ref_stitched</span><span class="p">],</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;compile_job_stitched_</span><span class="si">{</span><span class="n">name_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">compiled_job_stitched</span><span class="p">)</span>
<span class="n">compiled_circuit_ref</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">compiled_job_stitched</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The HQC credit cost for the stitched circuit is reported using the <code class="docutils literal notranslate"><span class="pre">cost</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hqc_cost</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">circuits</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">compiled_circuit_ref</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backend_config</span><span class="o">=</span><span class="n">qnx</span><span class="o">.</span><span class="n">QuantinuumConfig</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;H1-1&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stitched Circuit Cost: </span><span class="si">{</span><span class="n">hqc_cost</span><span class="si">}</span><span class="s2"> HQC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">execute_job_stitched</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">start_execute_job</span><span class="p">(</span>
    <span class="n">circuits</span><span class="o">=</span><span class="p">[</span><span class="n">compiled_circuit_ref</span><span class="p">],</span>
    <span class="n">backend_config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;execute_job_stitched_</span><span class="si">{</span><span class="n">name_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">n_shots</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">execute_job_stitched</span><span class="p">)</span>
<span class="n">result_stitched</span> <span class="o">=</span> <span class="n">qnx</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">execute_job_stitched</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">download_result</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Once the measurement result is available for the stitched circuit execution, the <code class="docutils literal notranslate"><span class="pre">destitch_results</span></code> function can be used to <em>destitch</em> the measurement result into measurement results for each subcircuit composing the stitched circuit. The order classical registers enable the measurement result for the stitched circuit to be destitched.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_after_destitching</span> <span class="o">=</span> <span class="n">destitch_results</span><span class="p">(</span><span class="n">result_stitched</span><span class="p">,</span> <span class="n">stitched_circuit</span><span class="o">.</span><span class="n">c_registers</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Similar to the “no stitching” workflow, the classical shadows data is used to reconstruct an averaged snapshot of the GHZ state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stitched_shadow_state</span> <span class="o">=</span> <span class="n">shadow_reconstruction</span><span class="p">(</span><span class="n">results_after_destitching</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</pre></div>
</div>
</div>
</div>
<p>The theoretical GHZ state is used as a baseline to estimate the absolute for the reconstructed GHZ state snapshot for both circuit stitching and no stitching. This is visualized as a Heat map below using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> and the <code class="docutils literal notranslate"><span class="pre">viridis</span></code> color scheme.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="n">absolute_error_no_stitching</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">shadow_state</span> <span class="o">-</span> <span class="n">ghz_state</span><span class="p">)</span>
<span class="n">absolute_error_stitched</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">stitched_shadow_state</span> <span class="o">-</span> <span class="n">ghz_state</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Plot the heatmaps with a shared color bar</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Absolute Error reconstructing GHZ State using classical shadows with and without circuit stitching.&quot;</span><span class="p">)</span>

<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">absolute_error_no_stitching</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">absolute_error_stitched</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">absolute_error_no_stitching</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">absolute_error_stitched</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">absolute_error_no_stitching</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No Stitching&#39;</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">absolute_error_stitched</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Circuit Stitching&#39;</span><span class="p">)</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Absolute Error in GHZ State Reconstruction from Randomized Classical Shadows&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../../_images/state_reconstruction_output.png"><img alt="../../_images/state_reconstruction_output.png" class="align-center" src="../../_images/state_reconstruction_output.png" style="width: 1200px;" />
</a>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../support/product_change_notifications.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Product Change Notifications</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Quantinuum_n56_ghz_state_fidelity.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">GHZ State Fidelity</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Circuit Stitching</a><ul>
<li><a class="reference internal" href="#workflow">Workflow</a></li>
<li><a class="reference internal" href="#impact-on-system-operation">Impact on System Operation</a></li>
<li><a class="reference internal" href="#backend-information">Backend Information</a></li>
<li><a class="reference internal" href="#classical-shadows">Classical Shadows</a><ul>
<li><a class="reference internal" href="#id1">Circuit Stitching</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>