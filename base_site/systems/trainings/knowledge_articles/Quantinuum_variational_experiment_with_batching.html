<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="GHZ State Fidelity" href="Quantinuum_n56_ghz_state_fidelity.html" /><link rel="prev" title="Topological Order from Measurements and Feed-Forward" href="Quantinuum_toric_code.html" />

    <link rel="shortcut icon" href="../../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Variational Experiment with Batching - Quantinuum Systems</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d7660fb1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Quantinuum Systems</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/systems.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user_guide/hardware_user_guide/access.html">Hardware User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hardware User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/access.html">Quantinuum Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/system_operation.html">System Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/workflow.html">System Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/hardware_user_guide/fair_queue.html">Fair Queue</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../user_guide/hardware_user_guide/performance_validation.html">Performance Validation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Performance Validation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/hardware_user_guide/performance_validation.html">Component Benchmarks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/hardware_user_guide/benchmarks/system_benchmarks.html">System Benchmarks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/hardware_user_guide/benchmarks/hardware_data.html">Accessing Hardware Specification Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user_guide/emulator_user_guide/introduction.html">Emulator User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Emulator User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/introduction.html">Quantinuum Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/noise_model.html">Noise Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/emulators/h1_emulators.html">H1 Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/emulator_user_guide/emulators/h2_emulators.html">H2 Emulators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://docs.quantinuum.com/nexus/user_guide/user_guide.html">Nexus User Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.quantinuum.com/nexus/admin_guide/admin_guide.html">Nexus Admin Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Trainings</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/getting_started_index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Getting Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started_index.html">Unique Capabilities</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.quantinuum.com/nexus/trainings/getting_started.html">Quantinuum Nexus</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.quantinuum.com/tket/user-guide/index.html">TKET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/emulators.html">Quantinuum Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/mcmr.html">Mid-Circuit Measurement &amp; Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/parameterized_angle_2_qubit_gates.html">Native Parameterized Angle Hardware Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/conditional_operations_and_classical_logic.html">Conditional Operations &amp; Classical Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/batch_jobs.html">Batch Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/api_options.html">Quantinuum Systems API Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/access_systems_with_qiskit.html">Using Qiskit with Quantinuum Devices</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/qec_decoder_toolkit.html">QEC Decoder Toolkit</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of QEC Decoder Toolkit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/qec_decoder_toolkit.html">QEC Decoder Toolkit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/repeat_until_success/rus_index.html">Repeat Until Success</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/repetition_code/repetition_code_index.html">Repetition Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/qec_decoder_toolkit/surface_code/surface_code_index.html">Surface Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/pytket_quantinuum/pytket_quantinuum.html"><code class="docutils literal notranslate"><span class="pre">pytket-quantinuum</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="ka_index.html">Knowledge Articles</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Knowledge Articles</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_chemistry_chemically_aware_ucc.html">Quantum Chemistry Calculations with Parameterized Angle 2-Qubit Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_high_energy_physics_experiment.html">High Energy Physics: Implementing <span class="math notranslate nohighlight">\(SU(2)\)</span> Lattice Gauge Theory Trotter Circuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_leakage_detection.html">Automatic Leakage Error Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_toric_code.html">Topological Order from Measurements and Feed-Forward</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Variational Experiment with Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="Quantinuum_n56_ghz_state_fidelity.html">GHZ State Fidelity</a></li>
<li class="toctree-l2"><a class="reference internal" href="circuit_stitching.html">Circuit Stitching</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support/product_change_notifications.html">Product Change Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/faqs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/quantinuum_systems_citations.html">How to Cite Quantinuum Systems</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="variational-experiment-with-batching">
<h1>Variational Experiment with Batching<a class="headerlink" href="#variational-experiment-with-batching" title="Link to this heading">¶</a></h1>
<p>Hybrid Quantum-Classical variational quantum algorithms consist of optimizing a trial parametric wavefunction, <span class="math notranslate nohighlight">\(| \psi (\vec{\theta}) \rangle\)</span>, to estimate the lowest eigenvalue (or expectation value) of a Hamiltonian, <span class="math notranslate nohighlight">\(\hat{H}\)</span>. This could be an Electronic Structure Hamiltonian or a Hamiltonian defining a QUBO (quadratic unconstrained binary optimization) or MAXCUT problem. The optimal parameters of the wavefunction, <span class="math notranslate nohighlight">\((\vec{\theta})\)</span> are an estimation of the lowest eigenvector of the Hamiltonian.</p>
<p>Further details can be found in the following articles:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/1304.3061">A variational eigenvalue solver on a quantum processor</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1507.08969">Towards Practical Quantum Variational Algorithms</a></p></li>
</ul>
<p>For the problem today, we will evaluate the ground-state energy (lowest eigenvalue) of a di-Hydrogen molecule. A Hamiltonian is defined over 2-qubits (<a class="reference external" href="https://journals.aps.org/prx/abstract/10.1103/PhysRevX.6.031007">PhysRevX.6.031007</a>). A state-preparation (or Ansatz) circuit, a sequence of 1-qubit and 2-qubit gates, is used to generate a trial wavefunction. The wavefunction parameters are rotations on the circuit.</p>
<p>The hardware-efficient state-preparation method is used for today’s problem (<a class="reference external" href="https://www.nature.com/articles/nature23879">nature23879</a>). The variational experiment optimizes the parameters on this circuit, over multiple iterations, in order to minimize the expectation value of the Hamiltonian, <span class="math notranslate nohighlight">\(\langle \psi (\vec{\theta}) | \hat{H} | \psi (\vec{\theta}) \rangle\)</span>.</p>
<section id="workflow-and-tools">
<h2>Workflow and Tools<a class="headerlink" href="#workflow-and-tools" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pytket</span></code> is used to synthesize a state-preparation circuit, prepare measurement circuits with <code class="docutils literal notranslate"><span class="pre">pytket-quantinuum</span></code> being used to submit (retrieve) jobs in a batch to (from) the Quantinuum service. The variational experiment requires the following as inputs:<br></p>
<ul class="simple">
<li><p>a symbolic state-preparation circuit.<br></p></li>
<li><p>an Hamiltonian defining the problem to be solved.</p></li>
</ul>
<p>The state-preparation, described above, consists of fixed-angle 1-qubit and 2-qubit gates in addition to variable-angle 1-qubit gates. In pytket, variable-angle 1-qubit gates can have two types of parameters:<br></p>
<ul class="simple">
<li><p>numerical parameters (<code class="docutils literal notranslate"><span class="pre">float</span></code>);<br></p></li>
<li><p>symbolic parameters (<code class="docutils literal notranslate"><span class="pre">sympy.symbol</span></code>).</p></li>
</ul>
<p>Numerical parameters are native python <code class="docutils literal notranslate"><span class="pre">float</span></code>s. Symbolic parameters require the use of the symbolic library, <code class="docutils literal notranslate"><span class="pre">sympy</span></code>, which is also a dependency of <code class="docutils literal notranslate"><span class="pre">pytket</span></code>. Throughout the variational experiment, symbolic parameters on the state-preparation circuit are replaced with additional numerical parameters.</p>
<p>The variational procedure consists of <span class="math notranslate nohighlight">\(n\)</span> iterations until a specific criterion is satisfied. A batch session will run over these <span class="math notranslate nohighlight">\(n\)</span> iterations.<br>
Inactivity for over 1 minutes will lead to the batch session ending, given how the batch feature works for Quantinuum hardware and emulators.</p>
<p>During the variational experiment, each iteration updates the numerical values in the parameter set, as described above. Subsequently, these are substituted into a new copy of the original symbolic state-preparation circuit. A set of sub-circuits, each containing measurement information defined by the input Hamiltonian, are appended to the numerical state-preparation circuit, leading to a set of measurement circuits. Finally, these circuits are submitted to Quantinuum.</p>
<p>Specifically, each iteration consists of:</p>
<ul class="simple">
<li><p>classical pre-processing to define measurement circuits;</p></li>
<li><p>batch submission to Quantinuum;</p></li>
<li><p>retrieval of measurement results;</p></li>
<li><p>classical post-processing to evaluate the cost function;</p></li>
</ul>
<p>determining whether to stop or continue the variational procedure.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> minimizer is used to control the optimization of the cost function. The minimised value of the cost function and the optimal parameters can be retrieved at the end of the variational experiment.</p>
<p>The observable is a sum of Pauli-strings (tensor product over <code class="docutils literal notranslate"><span class="pre">m</span></code> qubits of Pauli-<span class="math notranslate nohighlight">\(\hat{X}\)</span>, Pauli-<span class="math notranslate nohighlight">\(\hat{Y}\)</span>, Pauli-<span class="math notranslate nohighlight">\(\hat{Z}\)</span> &amp; Pauli-<span class="math notranslate nohighlight">\(\hat{I}\)</span>) multiplied by numerical coefficients.<br></p>
<ul class="simple">
<li><p>a set of initial numerical parameters to substitute into the symbolic state-preparation circuit. For example, this can be a set of random numerical floating-point numbers.<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pytket.backends.Backend</span></code> object to interface with the Quantinuum quantum computing service.<br></p></li>
<li><p>Number of shots to simulate each circuit with to generate a distribution of measurements.<br></p></li>
<li><p>Maximum batch cost to limit the credit cost of the variational experiment.</p></li>
</ul>
</section>
<section id="quantinuumbackend">
<h2>QuantinuumBackend<a class="headerlink" href="#quantinuumbackend" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">QuantinuumBackend</span></code> is used to submit and retreive all circuits required for the variational experiment. This backend is included in the <code class="docutils literal notranslate"><span class="pre">pytket-quantinuum</span></code> extension. With this backend, the end-user can access Quantinuum hardware, emulators, syntax checkers. The Quantinuum user portal lists all devices and emulators the end-user can access.</p>
<p>In  the code cell below, the instance of QuantinuumBackend uses the Quantinuum emulator, <code class="docutils literal notranslate"><span class="pre">H1-1E</span></code>. The H1 syntax checker’s target is <code class="docutils literal notranslate"><span class="pre">H1-1SC</span></code> and the quantum device’s target is <code class="docutils literal notranslate"><span class="pre">H1-1</span></code>. The Quantinuum emulators are a useful utility to test and cost the performance of an algorithm before any hardware session.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">QuantinuumBackend</span></code> instance requires the user to be authenticated before any jobs can be submitted. The <code class="docutils literal notranslate"><span class="pre">login</span></code> method will allow authentication.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.extensions.quantinuum</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantinuumBackend</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quantinuum_backend</span> <span class="o">=</span> <span class="n">QuantinuumBackend</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;H1-1E&quot;</span><span class="p">)</span>
<span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="synthesize-symbolic-state-preparation-circuit">
<h2>1. Synthesize Symbolic State-Preparation Circuit<a class="headerlink" href="#synthesize-symbolic-state-preparation-circuit" title="Link to this heading">¶</a></h2>
<p>The code-cell below synthesizes a 2-qubit circuit consisting of parameterized angle 2-qubit <code class="docutils literal notranslate"><span class="pre">ZZPhase</span></code> gates (<code class="docutils literal notranslate"><span class="pre">pytket.circuit.OpType.ZZPhase</span></code>) and fixed-angle 1-qubit <code class="docutils literal notranslate"><span class="pre">X</span></code> gate (<code class="docutils literal notranslate"><span class="pre">pytket.circuit.OpType.X</span></code>). This state-preparation technique is inspired by the Hardware-Efficient Ansatz (HEA) (<a class="reference external" href="https://www.nature.com/articles/nature23879">nature23879</a>),  instead of the usual chemistry state-preparation method, Unitary Coupled Cluster (UCC) (<a class="reference external" href="https://arxiv.org/abs/1701.02691">arxiv.1701.02691</a>).<br>
<br>
The hardware-efficient state-preparation method requires alternating layers of 2-qubit gates and 1-qubit  gates. Ultimately, this leads to fewer 2-qubit gates, but requires a greater number of variational parameters, compared to UCC. The optimal parameters for HEA are governed by the noise profile of the device. The HEA circuit used in this example consists of one-layer <code class="docutils literal notranslate"><span class="pre">ZZPhase</span></code> gates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circuit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Symbol</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Symbol</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
<span class="n">symbolic_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">ZZPhase</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The symbolic state-preparation circuit can be visualised using the <code class="docutils literal notranslate"><span class="pre">pytket.circuit.display</span></code> submodule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_circuit_jupyter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">symbolic_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hamiltonian-definition-and-analysis">
<h2>2. Hamiltonian Definition and Analysis<a class="headerlink" href="#hamiltonian-definition-and-analysis" title="Link to this heading">¶</a></h2>
<p>A problem hamiltonian is defined using the <a class="reference external" href="https://tket.quantinuum.com/api-docs/utils.html#pytket.utils.QubitPauliOperator"><code class="docutils literal notranslate"><span class="pre">pytket.utils.operator.QubitPauliOperator</span></code></a> class. Each <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> consists of complex coefficients and tensor products of Pauli-operations. The tensor products are referred to as Pauli-strings. This particular Hamiltonian consists of 5 terms operating on qubits <code class="docutils literal notranslate"><span class="pre">q[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">q[1]</span></code>. The problem Hamiltonian, <span class="math notranslate nohighlight">\(\hat{H}\)</span>, is defined as:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align} \hat{H} &amp;= g_0 \hat{I}_{q[0]} \otimes \hat{I}_{q[1]} + g_1 \hat{Z}_{q[0]} \otimes \hat{I}_{q[1]} + g_2 \hat{I}_{q[0]} \otimes \hat{Z}_{q[1]} \\ &amp;+ g_3 \hat{Z}_{q[0]} \otimes \hat{Z}_{q[1]} + g_4 \hat{X}_{q[0]} \otimes \hat{X}_{q[1]} + g_5 \hat{Y}_{q[0]} \otimes \hat{Y}_{q[1]} \\ \end{align}\end{split}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(g_0, g_1, g_2\)</span>, <span class="math notranslate nohighlight">\(g_3\)</span>, <span class="math notranslate nohighlight">\(g_4\)</span> and <span class="math notranslate nohighlight">\(g_5\)</span> are real numercial coefficients.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> is a dictionary mapping <a class="reference external" href="https://tket.quantinuum.com/api-docs/pauli.html#pytket.pauli.QubitPauliString"><code class="docutils literal notranslate"><span class="pre">pytket.pauli.QubitPauliString</span></code></a> to a complex coefficient. These coefficients are sympified (converted from python <code class="docutils literal notranslate"><span class="pre">complex</span></code> types to sympy <code class="docutils literal notranslate"><span class="pre">complex</span></code> types).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">QubitPauliString</span></code> is a map from <code class="docutils literal notranslate"><span class="pre">pytket.circuit.Qubit</span></code> to <code class="docutils literal notranslate"><span class="pre">pytket.pauli.Pauli</span></code>.</p>
<p>The coefficients in the Hamiltonian are obtained from <a class="reference external" href="https://journals.aps.org/prx/abstract/10.1103/PhysRevX.6.031007">PhysRevX.6.031007</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.utils.operators</span><span class="w"> </span><span class="kn">import</span> <span class="n">QubitPauliOperator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.pauli</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qubit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4804</span><span class="p">,</span> <span class="mf">0.3435</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4347</span><span class="p">,</span> <span class="mf">0.5716</span><span class="p">,</span> <span class="mf">0.0910</span><span class="p">,</span> <span class="mf">0.0910</span><span class="p">]</span>
<span class="n">term0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">QubitPauliString</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">,</span>
            <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">term1</span> <span class="o">=</span> <span class="p">{</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">}):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<span class="n">term2</span> <span class="o">=</span> <span class="p">{</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
<span class="n">term3</span> <span class="o">=</span> <span class="p">{</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
<span class="n">term4</span> <span class="o">=</span> <span class="p">{</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">}):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">4</span><span class="p">]}</span>
<span class="n">term5</span> <span class="o">=</span> <span class="p">{</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">}):</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span>
<span class="n">term_sum</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term0</span><span class="p">)</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term1</span><span class="p">)</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term2</span><span class="p">)</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term3</span><span class="p">)</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term4</span><span class="p">)</span>
<span class="n">term_sum</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">term5</span><span class="p">)</span>
<span class="n">hamiltonian</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">(</span><span class="n">term_sum</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hamiltonian</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This Hamiltonian can be converted into a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> instance, and the lowest eigenvalue can be obtained using <code class="docutils literal notranslate"><span class="pre">numpy.linalg.eig</span></code>. This value is used as a benchmark for the VQE result. The ground-state energy is measured in units of Hartrees (Ha).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">eig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="o">.</span><span class="n">to_sparse_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">ground_state_energy</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">sm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ground_state_energy</span><span class="si">}</span><span class="s2"> Ha&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To measure <span class="math notranslate nohighlight">\(\hat{H}\)</span> on hardware, naively 5 measurement circuits are required. The Identity term does not need to measured, since its expectation value always equals 1.<br>
With pytket, <span class="math notranslate nohighlight">\(\hat{H}\)</span> only requires simulating 2 measurement circuit, thanks to measurement reduction. The four terms <span class="math notranslate nohighlight">\(\hat{X}_{q[0]} \otimes \hat{X}_{q[1]}\)</span>, <span class="math notranslate nohighlight">\(\hat{Y}_{q[0]} \otimes \hat{Y}_{q[1]}\)</span>, <span class="math notranslate nohighlight">\(\hat{Z}_{q[0]} \otimes \hat{Z}_{q[1]}\)</span>, <span class="math notranslate nohighlight">\(\hat{Z}_{q[0]} \otimes \hat{Z}_{q[1]}\)</span> and <span class="math notranslate nohighlight">\(\hat{I}_{q[0]} \otimes \hat{Z}_{q[1]}\)</span>, form a commuting set and can be measured with two circuits instead of three. This partitioning can be performed automatically using the <a class="reference external" href="https://tket.quantinuum.com/api-docs/partition.html#pytket.partition.measurement_reduction"><code class="docutils literal notranslate"><span class="pre">measurement_reduction</span></code></a> function available in <a class="reference external" href="https://tket.quantinuum.com/api-docs/partition.html#module-pytket.partition"><code class="docutils literal notranslate"><span class="pre">pytket.partition</span></code></a> submodule.</p>
<p>The measurement operations for the two commuting set,<br></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\left\{ \hat{X}_{q[0]} \otimes \hat{X}_{q[1]}, \hat{Y}_{q[0]} \otimes \hat{Y}_{q[1]} \right\}\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\left\{ \hat{Z}_{q[0]} \otimes \hat{Z}_{q[1]}, \hat{Z}_{q[0]} \otimes \hat{I}_{q[1]}, \hat{I}_{q[0]} \otimes \hat{Z}_{q[1]}\right\}\)</span></p></li>
</ul>
<p>include additional 2-qubit gate resources.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">measurement_reduction</span><span class="p">,</span>
    <span class="n">PauliPartitionStrat</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strat</span> <span class="o">=</span> <span class="n">PauliPartitionStrat</span><span class="o">.</span><span class="n">CommutingSets</span>
<span class="n">pauli_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">hamiltonian</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">measurement_setup</span> <span class="o">=</span> <span class="n">measurement_reduction</span><span class="p">(</span><span class="n">pauli_strings</span><span class="p">,</span> <span class="n">strat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A measurement subcircuit contains the necessary operations to measure the terms in a commuting set. The subcircuit is appended to the numerical state-preparation circuit. Combining the numerical state-preparation circuit and the measurement subcircuits results in a set of measurement circuits required to solve the problem. The <a class="reference external" href="https://tket.quantinuum.com/api-docs/partition.html#pytket.partition.MeasurementSetup"><code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code></a> instance contains all the necessary sub-circuits to measure <span class="math notranslate nohighlight">\(\hat{H}\)</span>. The next code cell lists and visualises all measurement subcircuits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_circuit_jupyter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">measurement_subcircuit</span> <span class="ow">in</span> <span class="n">measurement_setup</span><span class="o">.</span><span class="n">measurement_circs</span><span class="p">:</span>
    <span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">measurement_subcircuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once the quantum computation has been completed, the measurement results can be mapped back to the Pauli-operations and coefficients in the Hamiltonian. This enables calculation of the expectation value for the Hamiltonian. The results attribute in the <a class="reference external" href="https://tket.quantinuum.com/api-docs/partition.html#pytket.partition.MeasurementSetup"><code class="docutils literal notranslate"><span class="pre">pytket.partition.MeasurementSetup</span></code></a> lists:</p>
<ul class="simple">
<li><p>all the Pauli-strings that have been measured;<br></p></li>
<li><p>information to process the quantum computed measurement result in order</p></li>
</ul>
<p>to estimate the expectation value of each Pauli-strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">bitmap_list</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measurement_setup</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">term</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">bitmap_list</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-expectation-values">
<span id="variational-batching-expval"></span><h2>3. Computing Expectation Values<a class="headerlink" href="#computing-expectation-values" title="Link to this heading">¶</a></h2>
<p>Once the Hamiltonian has been partitioned into commuting sets, measurement circuits need to be constructed. These measurement circuits are submitted to hardware or emulators for simulation. Once the simulation is complete, a result is available to request, and can be retrieved using <code class="docutils literal notranslate"><span class="pre">pytket</span></code>. These results are the outcomes<br>
of the measurement circuit simulation. Each result is a distribution of outcomes, specifically, the probability of observing  specific bitstring. This distribution is post-processed to compute the expectation value of the Hamiltonian, a necessity to evaluate the cost function in a Hybrid Quantum-Classical variational procedure.</p>
<section id="computing-expectation-values-for-pauli-strings">
<h3>3.1 Computing Expectation Values for Pauli-Strings<a class="headerlink" href="#computing-expectation-values-for-pauli-strings" title="Link to this heading">¶</a></h3>
<p>The Hamiltonian we are interested in consists of Pauli-strings. The expectation value of the Pauli-string is in the interval <span class="math notranslate nohighlight">\([-1, 1]\)</span>.</p>
<p>In the code cell below, a function is provided that calculates the expectation value of Pauli-string from a measured distribution. The <a class="reference external" href="https://tket.quantinuum.com/api-docs/partition.html#pytket.partition.MeasurementBitMap"><code class="docutils literal notranslate"><span class="pre">MeasurementBitmap</span></code></a> is used to extract the necessary data from the measured distribution. The resulting distribution can be summed over to estimate the expectation value of one Pauli-string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementBitMap</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_expectation_paulistring</span><span class="p">(</span>
    <span class="n">distribution</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span> <span class="n">bitmap</span><span class="p">:</span> <span class="n">MeasurementBitMap</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">bitstring</span><span class="p">,</span> <span class="n">probability</span> <span class="ow">in</span> <span class="n">distribution</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">probability</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">bitstring</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">bits</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">invert</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the example below, the function <code class="docutils literal notranslate"><span class="pre">compute_expectation_paulistring</span></code> is called to calculate the expectation for the <span class="math notranslate nohighlight">\(\hat{Z} \otimes \hat{Z}\)</span>. First the <code class="docutils literal notranslate"><span class="pre">QubitPauliString</span></code> is initialised, and that is used to extract the relevant data from the MeasurementSetup object defined in section 2. This data is used for postprocessing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytket.pauli</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qubit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.45</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.15</span><span class="p">}</span>
<span class="n">zz</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">])</span>
<span class="n">bitmap_list</span> <span class="o">=</span> <span class="n">measurement_setup</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bitmap</span> <span class="ow">in</span> <span class="n">bitmap_list</span><span class="p">:</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">compute_expectation_paulistring</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-expectation-values-for-sums-of-pauli-strings-multiplied-by-coefficients">
<h3>3.2 Computing Expectation Values for sums of Pauli-strings multiplied by coefficients<a class="headerlink" href="#computing-expectation-values-for-sums-of-pauli-strings-multiplied-by-coefficients" title="Link to this heading">¶</a></h3>
<p>In this step, we will submit circuits to the Quantinuum emulator (<code class="docutils literal notranslate"><span class="pre">H1-1E</span></code>). This circuit will produce a result. The result can be retrieved with the <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> object. First, the symbolic circuit is converted into a numerical circuit. The symbols in the circuit are substituted for numerical parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">symbol_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">sym</span><span class="p">:</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">()}</span>
<span class="n">numerical_circuit</span> <span class="o">=</span> <span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">numerical_circuit</span><span class="o">.</span><span class="n">symbol_substitution</span><span class="p">(</span><span class="n">symbol_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-quantinuumbackend">
<h3>3.3 Using QuantinuumBackend<a class="headerlink" href="#using-quantinuumbackend" title="Link to this heading">¶</a></h3>
<p>The Quantinuum backend was initialized at the start of the notebook to use the H1-1E emulator. This backend will now be used to calculate the expectation value.</p>
<p>The measurement operations from the <code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code> object are appended to the numerical circuit. Once this step is complete, the circuit is ready for submission if tket optimization in the Quantinuum stack is selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="n">measurement_setup</span><span class="o">.</span><span class="n">measurement_circs</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numerical_circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="n">circuit_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="n">compiled_circuit_list</span> <span class="o">=</span> <span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">get_compiled_circuits</span><span class="p">(</span>
    <span class="n">circuit_list</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Before submitting to the emulator, the total cost of running the set of circuits can be checked beforehand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_shots</span> <span class="o">=</span> <span class="mi">500</span>
<span class="k">for</span> <span class="n">comp_circ</span> <span class="ow">in</span> <span class="n">compiled_circuit_list</span><span class="p">:</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">comp_circ</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="n">n_shots</span><span class="p">,</span> <span class="n">syntax_checker</span><span class="o">=</span><span class="s2">&quot;H1-1SC&quot;</span><span class="p">)</span>
    <span class="n">cost_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cost of experiment in HQCs:&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cost_list</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we run the circuits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">handles</span> <span class="o">=</span> <span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">process_circuits</span><span class="p">(</span>
    <span class="n">compiled_circuit_list</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tket-opt-level&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The status of the jobs can be checked with <code class="docutils literal notranslate"><span class="pre">ciruit_status</span></code> method. This method requires the <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> to be passed as input. In this example, the job has completed and the results are reported as being ready to request.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">:</span>
    <span class="n">circuit_status</span> <span class="o">=</span> <span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">circuit_status</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">circuit_status</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The expectation value of the operator can be evaluated with the function <code class="docutils literal notranslate"><span class="pre">compute_expectation_value</span></code> in the next code cell. This function requires a list of <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> objects, a <code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code> instance, and the <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> instance for the expectation value computation. It is assumed the <code class="docutils literal notranslate"><span class="pre">MeasurementSetup</span></code> instance contains the measurement info of all the Pauli-strings in the <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> instance. Otherwise the <code class="docutils literal notranslate"><span class="pre">compute_expectation_value</span></code> function will return zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.utils.operators</span><span class="w"> </span><span class="kn">import</span> <span class="n">QubitPauliOperator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementSetup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.backends.backendresult</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackendResult</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Abs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_expectation_value</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BackendResult</span><span class="p">],</span>
    <span class="n">measurement_setup</span><span class="p">:</span> <span class="n">MeasurementSetup</span><span class="p">,</span>
    <span class="n">operator</span><span class="p">:</span> <span class="n">QubitPauliOperator</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pauli_string</span><span class="p">,</span> <span class="n">bitmaps</span> <span class="ow">in</span> <span class="n">measurement_setup</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">string_coeff</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pauli_string</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Abs</span><span class="p">(</span><span class="n">string_coeff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">bm</span> <span class="ow">in</span> <span class="n">bitmaps</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">circ_index</span>
                <span class="n">distribution</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">()</span>
                <span class="n">value</span> <span class="o">+=</span> <span class="n">compute_expectation_paulistring</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">bm</span><span class="p">)</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">string_coeff</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitmaps</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">energy</span>
</pre></div>
</div>
</div>
</div>
<p>The results of the previously submitted circuits can be retrieved with the <code class="docutils literal notranslate"><span class="pre">get_results</span></code> method on <code class="docutils literal notranslate"><span class="pre">QuantinuumBackend</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">quantinuum_backend</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, the expectation value, <span class="math notranslate nohighlight">\(\langle{\psi (\vec{\theta}_r)} | \hat{H} | { \psi (\vec{\theta}_r)} \rangle\)</span>, of the <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> instance, <span class="math notranslate nohighlight">\(\hat{H}\)</span>, is calculated with respect to <span class="math notranslate nohighlight">\(| { \psi (\vec{\theta}_r)} \rangle\)</span>. The state, <span class="math notranslate nohighlight">\(| \psi \rangle\)</span>, is prepared with the state-preparation circuit, and <span class="math notranslate nohighlight">\(\vec{\theta}_r\)</span> is a random parameter set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expectation_value</span> <span class="o">=</span> <span class="n">compute_expectation_value</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">measurement_setup</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expectation Value: </span><span class="si">{</span><span class="n">expectation_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="variational-procedure">
<h2>4. Variational Procedure<a class="headerlink" href="#variational-procedure" title="Link to this heading">¶</a></h2>
<p>A hybrid quantum-classical variational procedure consists of multiple iterations, controlled by a classical parameter optimizer. The parameters are gate-angles on quantum circuits submitted to Quantinuum for simulation. In <a class="reference internal" href="#variational-batching-expval"><span class="std std-ref">step 3</span></a>, a procedure is showcased to calculate the expectation value of a Hamiltonian with respect to a quantum state. It is shown how to use the measurement reduction and Pauli-string partitioning facility in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> to reduce measurement resources for the experiments. For the variational procedure demonstrated below, the cost function calculates the expectation of an input Hamiltonian. The aim is to find the optimal parameters that minimise this expectation value.</p>
<section id="objective-function">
<h3>4.1. Objective function<a class="headerlink" href="#objective-function" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Objective</span></code> class defined in the code cell performs the following utilities:<br></p>
<ul class="simple">
<li><p>Measurement Reduction;<br></p></li>
<li><p>Creation of a Batch session to use across the variational experiment;<br></p></li>
<li><p>Submission and retrieval of quantum circuits using <code class="docutils literal notranslate"><span class="pre">QuantinuumBackend</span></code>;<br></p></li>
<li><p>Expectation Value evaluation.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Objective</span></code> class requires the following inputs:<br></p>
<ul class="simple">
<li><p>Input symbolic state-preparation circuit;<br></p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">QubitPauliOperator</span></code> instance of the Hamiltonian characterising the use case of interest;<br></p></li>
<li><p>The backend to use. <code class="docutils literal notranslate"><span class="pre">QuantinuumBackend</span></code> is used to access Quantinuum service. The backend needs to be instantiated and the user needs to login within previous code cell.<br></p></li>
<li><p>Number of shots to perform per circuit. Quantinuum hardware have an upper limit of 10000 shots per job.<br></p></li>
<li><p>Maximum consumable HQC credit before the batch is terminated.<br></p></li>
<li><p>Number of iterations before the variational experiment is terminated.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Objective</span></code> class instance can be passed as a callable to <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndarray</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random_sample</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.extensions.quantinuum</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantinuumBackend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PauliPartitionStrat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytket.backends.resulthandle</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResultHandle</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Objective</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">symbolic_circuit</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">,</span>
        <span class="n">problem_hamiltonian</span><span class="p">:</span> <span class="n">QubitPauliOperator</span><span class="p">,</span>
        <span class="n">quantinuum_backend</span><span class="p">:</span> <span class="n">QuantinuumBackend</span><span class="p">,</span>
        <span class="n">n_shots_per_circuit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_batch_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">n_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the objective function needed for a variational</span>
<span class="sd">        procedure on Quantinuum.</span>
<span class="sd">        Args:</span>
<span class="sd">            symbolic_circuit</span>
<span class="sd">            (pytket.circuit.Circuit): State-preparation</span>
<span class="sd">                circuit with symbolic parameters</span>
<span class="sd">            problem_hamiltonian (pytket.utils.operators.QubitPauliOperator):</span>
<span class="sd">                QubitPauliOperator instance defining the Hamiltonian of the</span>
<span class="sd">                problem.</span>
<span class="sd">            quantinuum_backend (pytket.extensions.quantinuum.QuantinuumBackend): Backend</span>
<span class="sd">                instance to use for the simulation. This will be</span>
<span class="sd">                QuantinuumBackend from the pytket.extensions.quantinuum</span>
<span class="sd">                package to run experiments on Quantinuum hardware and emulators.</span>
<span class="sd">            n_shots_per_circuit (int): Number of shots per circuit.</span>
<span class="sd">            max_batch_cost (float): Maximum cost of all jobs in batch. If</span>
<span class="sd">                exceeded the batch will terminate.</span>
<span class="sd">            n_iterations (int): Total number of iterations before ending</span>
<span class="sd">                the batch session.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Callable[[ndarray], float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">problem_hamiltonian</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symbolic_circuit</span><span class="p">:</span> <span class="n">Circuit</span> <span class="o">=</span> <span class="n">symbolic_circuit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hamiltonian</span><span class="p">:</span> <span class="n">QubitPauliOperator</span> <span class="o">=</span> <span class="n">problem_hamiltonian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">:</span> <span class="n">QuantinuumBackend</span> <span class="o">=</span> <span class="n">quantinuum_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nshots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">n_shots_per_circuit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_batch_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">max_batch_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_setup</span><span class="p">:</span> <span class="n">MeasurementSetup</span> <span class="o">=</span> <span class="n">measurement_reduction</span><span class="p">(</span>
            <span class="n">terms</span><span class="p">,</span> <span class="n">strat</span><span class="o">=</span><span class="n">PauliPartitionStrat</span><span class="o">.</span><span class="n">CommutingSets</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_niters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">n_iterations</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objective_function</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration_number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration_number</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_niters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iteration_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">circuit_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syntax_checker</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;H1-1SC&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_symbolic_circuit</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">())</span>
        <span class="n">random_parameters</span> <span class="o">=</span> <span class="n">random_sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nshots</span><span class="p">,</span> <span class="n">syntax_checker</span><span class="o">=</span><span class="n">syntax_checker</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_circuits</span><span class="p">(</span><span class="n">random_parameters</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_objective_function</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span>
        <span class="n">iteration_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Substitutes input parameters into the</span>
<span class="sd">        symbolic state-preparation circuit, and</span>
<span class="sd">        calculates the expectation value.</span>
<span class="sd">        Args:</span>
<span class="sd">            parameters (ndarray): A list of numpy.ndarray</span>
<span class="sd">        Returns:</span>
<span class="sd">            float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_symbolic_circuit</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">())</span>
        <span class="n">circuit_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_circuits</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">QuantinuumBackend</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Batching is not supported for any backend other than QuantinuumBackend.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">iteration_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_startjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">start_batch</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_batch_cost</span><span class="p">,</span>
                <span class="n">circuit_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nshots</span><span class="p">,</span>
                <span class="n">noisy_simulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tket-opt-level&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_startjob</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_submit_batch</span><span class="p">(</span><span class="n">circuit_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_submit_batch</span><span class="p">(</span><span class="n">circuit_list</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">compute_expectation_value</span><span class="p">(</span>
            <span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_setup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hamiltonian</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">expval</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_circuits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Circuit</span><span class="p">]:</span>
        <span class="n">circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symbolic_circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">symbol_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)}</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">symbol_substitution</span><span class="p">(</span><span class="n">symbol_dict</span><span class="p">)</span>
        <span class="n">circuit_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_setup</span><span class="o">.</span><span class="n">measurement_circs</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
            <span class="n">circuit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_compiled_circuits</span><span class="p">(</span>
            <span class="n">circuit_list</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cc_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_submit_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">circuits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Circuit</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ResultHandle</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Submit a list of circuits with N shots each</span>
<span class="sd">        to the Quantinuum batch.</span>
<span class="sd">        Args:</span>
<span class="sd">            circuits (List[Circuit]): A list of circuits</span>
<span class="sd">                to submit to the batch on Quantinuum.</span>
<span class="sd">            first job (ResultHandle): The result handle for the</span>
<span class="sd">                first job submitted in the batch.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[ResultHandle]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">add_to_batch</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_startjob</span><span class="p">,</span>
                <span class="n">c</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nshots</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tket-opt-level&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                <span class="n">noisy_simulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">circuits</span>
        <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Objective</span></code> class is initialised with the essential data needed to perform the variational experiment. The object contains all the necessary information to compute the value of the objective function.</p>
<p>A convenience method <code class="docutils literal notranslate"><span class="pre">circuit_cost</span></code> can be used to estimate the total number of HQCs required to estimate the objective function. The variational loop will be multiples of this value (number of function calls across the variational procedure multiplied by the HQC cost of evaluating the objective function).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_shots_per_circuit</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">max_batch_cost</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span>
    <span class="n">symbolic_circuit</span><span class="p">,</span>
    <span class="n">hamiltonian</span><span class="p">,</span>
    <span class="n">quantinuum_backend</span><span class="p">,</span>
    <span class="n">n_shots_per_circuit</span><span class="p">,</span>
    <span class="n">max_batch_cost</span><span class="o">=</span><span class="n">max_batch_cost</span><span class="p">,</span>
    <span class="n">n_iterations</span><span class="o">=</span><span class="n">n_iterations</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objective</span><span class="o">.</span><span class="n">circuit_cost</span><span class="p">(</span><span class="s2">&quot;H1-1SC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="execute-the-objective-function">
<h3>4.2. Execute the Objective Function<a class="headerlink" href="#execute-the-objective-function" title="Link to this heading">¶</a></h3>
<p>The SciPy minimizer is used to optimize the value of the objective function. Initial parameters are pseudo-random. Passing the <code class="docutils literal notranslate"><span class="pre">Objective</span></code> instance into <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize</span></code> will start the variational experiment.</p>
<p>The first iteration creates a batch session, and all subsequent circuit submission are added to this batch. If additional circuits are not submitted within 1 minute, the batch session will terminate.</p>
<p>Remember that the status of the batch can be checked at any time on the Quantinuum User Portal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random_sample</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;COBYLA&quot;</span>
<span class="n">initial_parameters</span> <span class="o">=</span> <span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbolic_circuit</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">objective</span><span class="p">,</span>
    <span class="n">initial_parameters</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">objective</span><span class="o">.</span><span class="n">_niters</span><span class="p">},</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The minimal value of the objective function can be retrieved with the <code class="docutils literal notranslate"><span class="pre">fun</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VQE Energy:</span><span class="se">\t</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="si">}</span><span class="s2"> Ha&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The ground-state energy estimated with VQE can be compared with the value obtained from the <code class="docutils literal notranslate"><span class="pre">numpy.linalg</span></code> computation. The absolute error and the relative error is calculated here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abs_err</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">experiment</span> <span class="o">-</span> <span class="n">benchmark</span><span class="p">)</span>
<span class="n">rel_err</span> <span class="o">=</span> <span class="p">(</span>
    <span class="k">lambda</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">:</span> <span class="n">abs_err</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span>
    <span class="o">*</span> <span class="mi">100</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ae</span> <span class="o">=</span> <span class="n">abs_err</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">ground_state_energy</span><span class="p">)</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">rel_err</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">ground_state_energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Absolute error:</span><span class="se">\t</span><span class="si">{</span><span class="n">ae</span><span class="si">}</span><span class="s2"> Ha</span><span class="se">\n</span><span class="s2">Relative error:</span><span class="se">\t</span><span class="si">{</span><span class="n">re</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The optimal parameters can be retrieved with the <code class="docutils literal notranslate"><span class="pre">x</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>The Symbols can be mapped to the optimal parameter by iterating through both lists:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">_symbols</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optimal_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These symbols can be saved to an output file for further use if necessary using json. See the example below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">json_io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;parameters.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">optimal_parameters</span><span class="p">,</span> <span class="n">json_io</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Quantinuum_n56_ghz_state_fidelity.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">GHZ State Fidelity</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Quantinuum_toric_code.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Topological Order from Measurements and Feed-Forward</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Variational Experiment with Batching</a><ul>
<li><a class="reference internal" href="#workflow-and-tools">Workflow and Tools</a></li>
<li><a class="reference internal" href="#quantinuumbackend">QuantinuumBackend</a></li>
<li><a class="reference internal" href="#synthesize-symbolic-state-preparation-circuit">1. Synthesize Symbolic State-Preparation Circuit</a></li>
<li><a class="reference internal" href="#hamiltonian-definition-and-analysis">2. Hamiltonian Definition and Analysis</a></li>
<li><a class="reference internal" href="#computing-expectation-values">3. Computing Expectation Values</a><ul>
<li><a class="reference internal" href="#computing-expectation-values-for-pauli-strings">3.1 Computing Expectation Values for Pauli-Strings</a></li>
<li><a class="reference internal" href="#computing-expectation-values-for-sums-of-pauli-strings-multiplied-by-coefficients">3.2 Computing Expectation Values for sums of Pauli-strings multiplied by coefficients</a></li>
<li><a class="reference internal" href="#using-quantinuumbackend">3.3 Using QuantinuumBackend</a></li>
</ul>
</li>
<li><a class="reference internal" href="#variational-procedure">4. Variational Procedure</a><ul>
<li><a class="reference internal" href="#objective-function">4.1. Objective function</a></li>
<li><a class="reference internal" href="#execute-the-objective-function">4.2. Execute the Objective Function</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="../../_static/custom.js?v=4ca7370b"></script>
    </body>
</html>