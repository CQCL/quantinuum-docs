<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Tree Tensor Network (TTN) Tutorial" href="ttn_tutorial.html" /><link rel="prev" title="GeneralState Tutorial" href="general_state_tutorial.html" />

    <link rel="shortcut icon" href="../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>Matrix Product State (MPS) Tutorial - pytket-cutensornet 0.10.1 API documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../_static/tokens.css"/>
<link rel="stylesheet" href="../_static/styles.css"/>
<link rel="stylesheet" href="../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">pytket-cutensornet 0.10.1 API documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">pytket-cutensornet 0.10.1 API documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/general_state.html">General state (exact) simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/structured_state.html">Structured state evolution</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="general_state_tutorial.html"><code class="docutils literal notranslate"><span class="pre">GeneralState</span></code> Tutorial</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Matrix Product State (MPS) Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="ttn_tutorial.html">Tree Tensor Network (TTN) Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changelog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Useful links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/CQCL/pytket-cutensornet/issues">Issue tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/pytket-cutensornet/">PyPi</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/examples/mps_tutorial.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="matrix-product-state-mps-tutorial">
<h1>Matrix Product State (MPS) Tutorial<a class="headerlink" href="#matrix-product-state-mps-tutorial" title="Link to this heading">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">OpType</span>
<span class="kn">from</span> <span class="nn">pytket.circuit.display</span> <span class="kn">import</span> <span class="n">render_circuit_jupyter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.extensions.cutensornet.structured_state</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CuTensorNetHandle</span><span class="p">,</span>
    <span class="n">Config</span><span class="p">,</span>
    <span class="n">SimulationAlgorithm</span><span class="p">,</span>
    <span class="n">simulate</span><span class="p">,</span>
    <span class="n">prepare_circuit_mps</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="introduction">
<h2>Introduction<br><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This notebook provides examples of the usage of the MPS functionalities of <code class="docutils literal notranslate"><span class="pre">pytket_cutensornet</span></code>. For more information, see the docs at https://docs.quantinuum.com/tket/extensions/pytket-cutensornet/.<br>
A Matrix Product State (MPS) represents a state on <code class="docutils literal notranslate"><span class="pre">n</span></code> qubits as a list of <code class="docutils literal notranslate"><span class="pre">n</span></code> tensors connected in a line as show below:<br>
<img alt="MPS" src="../_images/mps.png" /><br>
Each of these circles corresponds to a tensor. We refer to each leg of a tensor as a <em>bond</em> and the number of bonds a tensor has is its <em>rank</em>. In code, a tensor is just a multidimensional array:<br>
<br>
<code class="docutils literal notranslate"><span class="pre">tensor[i][j][k]</span> <span class="pre">=</span> <span class="pre">v</span></code><br>
<br>
In the case above, we are assigning an entry value <code class="docutils literal notranslate"><span class="pre">v</span></code> of a rank-3 tensor (one <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> coordinate per bond). Each bond allows a different number of values for its indices; for instance <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">4</span></code> would mean that the first bond of our tensor can take up to four different indices; we refer to this as the <em>dimension</em> of the bond. We refer to the bonds connecting different tensors in the MPS as <em>virtual bonds</em>; the maximum allowed value for the dimension of virtual bonds is often denoted by the greek letter <code class="docutils literal notranslate"><span class="pre">chi</span></code>. The open bonds are known as <em>physical bonds</em> and, in our case, each will correspond to a qubit; hence, they have dimension <code class="docutils literal notranslate"><span class="pre">2</span></code> – the dimension of the vector space of a single qubit.<br>
In essence, whenever we want to apply a gate to certain qubit we will connect a tensor (matrix) representing the gate to the corresponding physical bond and <em>contract</em> the network back to an MPS form (tensor contraction is a generalisation of matrix multiplication to multidimensional arrays). Whenever a two-qubit gate is applied, the entanglement information after contraction will be kept in the degrees of freedom of the virtual bonds. As such, the dimension of the virtual bonds will generally increase exponentially as we apply entangling gates, leading to large memory footprints of the tensors and, consequently, long runtime for tensor contraction. We provide functionalities to limit the growth of the dimension of the virtual bonds, keeping resource consumption in check. Read the <em>Approximate simulation</em> section on this notebook to learn more.<br>
<strong>References</strong>: To read more about MPS we recommend the following papers.<br></p>
<ul class="simple">
<li><p>For an introduction to MPS and its canonical form: https://arxiv.org/abs/1901.05824.<br></p></li>
<li><p>For a description of the <code class="docutils literal notranslate"><span class="pre">MPSxGate</span></code> algorithm we provide: https://arxiv.org/abs/2002.07730.<br></p></li>
<li><p>For a description of the <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> algorithm we provide: https://arxiv.org/abs/2207.05612.<br></p></li>
<li><p>For insights on the reationship between truncation error and the error model in a quantum computer: https://arxiv.org/abs/2004.02388</p></li>
</ul>
</section>
<section id="basic-functionality-and-exact-simulation">
<h2>Basic functionality and exact simulation<br><a class="headerlink" href="#basic-functionality-and-exact-simulation" title="Link to this heading">¶</a></h2>
<p>Here we show an example of the basic use of our MPS methods. We first generate a simple <code class="docutils literal notranslate"><span class="pre">pytket</span></code> circuit to be simulated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">CZ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">ZZPhase</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">TK2</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">my_circ</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">my_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For <strong>exact</strong> simulation, simply call the <code class="docutils literal notranslate"><span class="pre">simulate</span></code> function on the circuit and choose a contraction algorithm. To learn more about the contraction algorithms we provide see the <em>Contraction algorithms</em> section of this notebook. You will also need to provide a configuration, the default one is provided by <code class="docutils literal notranslate"><span class="pre">Config()</span></code>. Custom settings of <code class="docutils literal notranslate"><span class="pre">Config</span></code> are discussed in the <em>Approximate simulation</em> section.<br>
<strong>NOTE</strong>: whenever you wish to generate an <code class="docutils literal notranslate"><span class="pre">MPS</span></code> object or execute calculations on it you must do so within a <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">CuTensorNetHandle()</span> <span class="pre">as</span> <span class="pre">libhandle:</span></code> block; this will initialise the cuTensorNetwork library for you, and destroy its handles at the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block. You will need to pass the <code class="docutils literal notranslate"><span class="pre">libhandle</span></code> to the <code class="docutils literal notranslate"><span class="pre">MPS</span></code> object via the method that generates it (in the snippet below, <code class="docutils literal notranslate"><span class="pre">simulate</span></code>), or if already initialised, pass it via the <code class="docutils literal notranslate"><span class="pre">update_libhandle</span></code> method.<br>
Due to the nature of Jupyter notebooks, we will be starting most of these cells with a <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">CuTensorNetHandle()</span> <span class="pre">as</span> <span class="pre">libhandle:</span></code>. However, in a standard script, all of these cells would be grouped together and a single <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">CuTensorNetHandle()</span> <span class="pre">as</span> <span class="pre">libhandle:</span></code> statement would be necessary at the beginning of the script.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">my_circ</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">Config</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">my_circ</span></code> uses a rich gateset – in fact, every single-qubit and two-qubit gate supported by <code class="docutils literal notranslate"><span class="pre">pytket</span></code> can be used in our MPS approaches. Gates acting on more than two qubits are not currently supported.</p>
<p>The output of <code class="docutils literal notranslate"><span class="pre">simulate</span></code> is an <code class="docutils literal notranslate"><span class="pre">MPS</span></code> object encoding the output state of the circuit.<br></p>
<section id="obtain-an-amplitude-from-an-mps">
<h3>Obtain an amplitude from an MPS<br><a class="headerlink" href="#obtain-an-amplitude-from-an-mps" title="Link to this heading">¶</a></h3>
<p>Let’s first see how to get the amplitude of the state <code class="docutils literal notranslate"><span class="pre">|10100&gt;</span></code> from the output of the previous circuit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;10100&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span><span class="o">.</span><span class="n">update_libhandle</span><span class="p">(</span><span class="n">libhandle</span><span class="p">)</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">my_mps</span><span class="o">.</span><span class="n">get_amplitude</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Since this is a very small circuit, we can use <code class="docutils literal notranslate"><span class="pre">pytket</span></code>’s state vector simulator capabilities to verify that the state is correct by checking the amplitude of each of the computational states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state_vector</span> <span class="o">=</span> <span class="n">my_circ</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_amplitude</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span><span class="o">.</span><span class="n">update_libhandle</span><span class="p">(</span><span class="n">libhandle</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">):</span>
        <span class="n">correct_amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">state_vector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">my_mps</span><span class="o">.</span><span class="n">get_amplitude</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Are all amplitudes correct?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">correct_amplitude</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sampling-from-an-mps">
<h3>Sampling from an MPS<br><a class="headerlink" href="#sampling-from-an-mps" title="Link to this heading">¶</a></h3>
<p>We can also sample from the output state of a circuit by calling <code class="docutils literal notranslate"><span class="pre">my_mps.sample</span></code>, where <code class="docutils literal notranslate"><span class="pre">my_mps</span></code> is the outcome of simulating the circuit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_samples</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Initialise the sample counter</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span><span class="o">.</span><span class="n">update_libhandle</span><span class="p">(</span><span class="n">libhandle</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="c1"># Draw a sample</span>
        <span class="n">qubit_outcomes</span> <span class="o">=</span> <span class="n">my_mps</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="c1"># Convert qubit outcomes to bitstring</span>
        <span class="n">bitstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">qubit_outcomes</span><span class="p">[</span><span class="n">q</span><span class="p">])</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">my_circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
        <span class="c1"># Convert bitstring to int</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bitstring</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Update the sample dictionary</span>
        <span class="n">sample_count</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate the theoretical number of samples per bitstring</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_samples</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">state_vector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Plot a comparison of theory vs sampled</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">),</span> <span class="n">expected_count</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Theory&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_qubits</span><span class="p">),</span> <span class="n">sample_count</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Experiment&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Basis states&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Samples&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We also provide methods to apply mid-circuit measurements via <code class="docutils literal notranslate"><span class="pre">my_mps.measure(qubits)</span></code> and postselection via <code class="docutils literal notranslate"><span class="pre">my_mps.postselect(qubit_outcomes)</span></code>. Their use is similar to that of <code class="docutils literal notranslate"><span class="pre">my_mps.sample()</span></code> shown above.<br>
<strong>Note:</strong> whereas <code class="docutils literal notranslate"><span class="pre">my_mps.sample()</span></code> does <em>not</em> change the state of the MPS, <code class="docutils literal notranslate"><span class="pre">my_mps.measure(qubits)</span></code> and <code class="docutils literal notranslate"><span class="pre">my_mps.postselect(qubit_outcomes)</span></code> do change it, projecting the state to the resulting outcome and removing the measured qubits.</p>
</section>
<section id="inner-products">
<h3>Inner products<br><a class="headerlink" href="#inner-products" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">vdot</span></code> you can obtain the inner product of two states in MPS form. This method does not change the internal data of neither of the MPS. Moreover, it can be used on the same <code class="docutils literal notranslate"><span class="pre">MPS</span></code> object for both inputs, yielding the squared norm of the state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span><span class="o">.</span><span class="n">update_libhandle</span><span class="p">(</span><span class="n">libhandle</span><span class="p">)</span>
    <span class="n">norm_sq</span> <span class="o">=</span> <span class="n">my_mps</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">my_mps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;As expected, the squared norm of a state is 1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">norm_sq</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s come up with another circuit on the same qubits and apply an inner product between the two <code class="docutils literal notranslate"><span class="pre">MPS</span></code> objects.</p>
<p>Generate circuits</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">other_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">other_circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">other_circ</span><span class="o">.</span><span class="n">CZ</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">other_circ</span><span class="o">.</span><span class="n">XXPhase</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">other_circ</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Simulate them</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">other_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">other_circ</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">Config</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s calculate the inner product and check that it agrees with <code class="docutils literal notranslate"><span class="pre">pytket</span></code>’s state vector based computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">my_mps</span><span class="o">.</span><span class="n">update_libhandle</span><span class="p">(</span><span class="n">libhandle</span><span class="p">)</span>
    <span class="n">inner_product</span> <span class="o">=</span> <span class="n">my_mps</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">other_mps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_state</span> <span class="o">=</span> <span class="n">my_circ</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>
<span class="n">other_state</span> <span class="o">=</span> <span class="n">other_circ</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is the inner product correct?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">my_state</span><span class="p">,</span> <span class="n">other_state</span><span class="p">),</span> <span class="n">inner_product</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mid-circuit-measurements-and-classical-control">
<h3>Mid-circuit measurements and classical control<br><a class="headerlink" href="#mid-circuit-measurements-and-classical-control" title="Link to this heading">¶</a></h3>
<p>Mid-circuit measurements and classical control is supported (only in <code class="docutils literal notranslate"><span class="pre">MPSxGate</span></code> as of v0.8.0). For instance, we can implement the teleportation protocol on a pytket circuit and simulate it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>
<span class="n">alice</span> <span class="o">=</span> <span class="n">circ</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">circ</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="s2">&quot;alice_bits&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">bob</span> <span class="o">=</span> <span class="n">circ</span><span class="o">.</span><span class="n">add_q_register</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Initialise Alice&#39;s first qubit in some arbitrary state</span>
<span class="n">circ</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">orig_state</span> <span class="o">=</span> <span class="n">circ</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>
<span class="c1"># Create a Bell pair shared between Alice and Bob</span>
<span class="n">circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Apply a Bell measurement on Alice&#39;s qubits</span>
<span class="n">circ</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alice_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alice_bits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Apply conditional corrections on Bob&#39;s qubits</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">alice_bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">bob</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">condition_bits</span><span class="o">=</span><span class="p">[</span><span class="n">alice_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">condition_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Reset Alice&#39;s qubits</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">alice</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">Reset</span><span class="p">,</span> <span class="p">[</span><span class="n">alice</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="c1"># Display the circuit</span>
<span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now simulate the circuit and check that the qubit has been successfully teleported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Initial state:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">orig_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">|00&gt;|0&gt; + </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">orig_state</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">|10&gt;|0&gt;&quot;</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">circ</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">Config</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Teleported state:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get_amplitude</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">|00&gt;|0&gt; + </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get_amplitude</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">|00&gt;|1&gt;&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Measurement outcomes:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">get_bits</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="two-qubit-gates-acting-on-non-adjacent-qubits">
<h3>Two-qubit gates acting on non-adjacent qubits<br><a class="headerlink" href="#two-qubit-gates-acting-on-non-adjacent-qubits" title="Link to this heading">¶</a></h3>
<p>Standard MPS algorithms only support simulation of two-qubit gates acting on neighbour qubits. In our implementation, however, two-qubit gates between arbitrary qubits may be applied, as shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">ZZPhase</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">CZ</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">XXPhase</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">TK2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">circ</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">Config</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Did simulation succeed?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note</strong>: Even though two-qubit gates on non-adjacent qubits are simulable, the overhead on these is considerably larger than simulating gates on adjacent qubits. As a rule of thumb if the two qubits are <code class="docutils literal notranslate"><span class="pre">n</span></code> positions apart, the overhead is upper bounded by the cost of simulating <code class="docutils literal notranslate"><span class="pre">n-1</span></code> additional SWAP gates to move the leftmost qubit near the rightmost. In reality, the implementation we use is more nuanced than just applying SWAP gates, and the qubits don’t actually change position.<br>
When circuits are shallow, using our approach to simulate long-distance two-qubit gates is advantageous. In the case of deep circuits with many long-distance gates, it is sometimes beneficial to use TKET routing on the circuit, explicitly adding SWAP gates so that all two-qubit gates act on nearest neighbour qubits. Users may do this by calling <code class="docutils literal notranslate"><span class="pre">prepare_circuit_mps</span></code>, which is a wrapper of the corresponding TKET routing pass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prepared_circ</span><span class="p">,</span> <span class="n">qubit_map</span> <span class="o">=</span> <span class="n">prepare_circuit_mps</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">render_circuit_jupyter</span><span class="p">(</span><span class="n">prepared_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The circuit can now be simulated as usual.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">prepared_circ</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">Config</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Did simulation succeed?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that the qubits in the <code class="docutils literal notranslate"><span class="pre">prepared_circ</span></code> were renamed when applying <code class="docutils literal notranslate"><span class="pre">prepare_circuit_mps</span></code>. Implicit SWAPs may have been added to the circuit, meaning that the logical qubit held at the <code class="docutils literal notranslate"><span class="pre">node[i]</span></code> qubit at the beginning of the circuit may differ from the one it holds at the end; this information is captured by the <code class="docutils literal notranslate"><span class="pre">qubit_map</span></code> output. We recommend applying <code class="docutils literal notranslate"><span class="pre">apply_qubit_relabelling</span></code> on the MPS after simulation, relabelling the qubits according to these implicit SWAPs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">qubit_map</span><span class="p">)</span>
<span class="n">mps</span><span class="o">.</span><span class="n">apply_qubit_relabelling</span><span class="p">(</span><span class="n">qubit_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="approximate-simulation">
<h2>Approximate simulation<br><a class="headerlink" href="#approximate-simulation" title="Link to this heading">¶</a></h2>
<p>We provide two policies for approximate simulation; these are supported by both of our current MPS contraction algorithms:<br></p>
<ul class="simple">
<li><p>Bound the maximum value of the virtual bond dimension <code class="docutils literal notranslate"><span class="pre">chi</span></code>. If a bond dimension would increase past that point, we <em>truncate</em> (i.e. discard) the degrees of freedom that contribute the least to the state description. We can keep track of a lower bound of the error that this truncation causes.<br></p></li>
<li><p>Provide a value for acceptable two-qubit gate fidelity <code class="docutils literal notranslate"><span class="pre">truncation_fidelity</span></code>. After each two-qubit gate we truncate the dimension of virtual bonds as much as we can while guaranteeing the target gate fidelity. The more fidelity you require, the longer it will take to simulate. <strong>Note</strong>: this is <em>not</em> the final fidelity of the output state, but the fidelity per gate.<br>
Values for <code class="docutils literal notranslate"><span class="pre">chi</span></code> and <code class="docutils literal notranslate"><span class="pre">truncation_fidelity</span></code> can be set via <code class="docutils literal notranslate"><span class="pre">Config</span></code>. To showcase approximate simulation, let’s define a circuit where exact MPS contraction starts struggling.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">random_line_circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Circuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random circuit with line connectivity.&quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layers</span><span class="p">):</span>
        <span class="c1"># Layer of TK1 gates</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">TK1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span> <span class="n">q</span><span class="p">)</span>

        <span class="c1"># Layer of CX gates</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Even layers connect (q0,q1), odd (q1,q2)</span>
        <span class="n">qubit_pairs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">n_qubits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Direction of each CX gate is random</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">qubit_pairs</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">qubit_pairs</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit</span> <span class="o">=</span> <span class="n">random_line_circuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For exact contraction, <code class="docutils literal notranslate"><span class="pre">chi</span></code> must be allowed to be up to <code class="docutils literal notranslate"><span class="pre">2**(n_qubits</span> <span class="pre">//</span> <span class="pre">2)</span></code>, meaning that if we set <code class="docutils literal notranslate"><span class="pre">n_qubits</span> <span class="pre">=</span> <span class="pre">20</span></code> it would require <code class="docutils literal notranslate"><span class="pre">chi</span> <span class="pre">=</span> <span class="pre">1024</span></code>; already too much for this particular circuit to be simulated in a gaming laptop using the current implementation. Instead, let’s bound <code class="docutils literal notranslate"><span class="pre">chi</span></code> to a maximum of <code class="docutils literal notranslate"><span class="pre">16</span></code>. Doing so results in faster runtime, at the expense of losing output state fidelity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">chi</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">bound_chi_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken by approximate contraction with bound chi:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lower bound of the fidelity:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bound_chi_mps</span><span class="o">.</span><span class="n">fidelity</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, we can fix <code class="docutils literal notranslate"><span class="pre">truncation_fidelity</span></code> and let <code class="docutils literal notranslate"><span class="pre">chi</span></code> increase as necessary to satisfy it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">truncation_fidelity</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>
    <span class="n">fixed_fidelity_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span>
        <span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">config</span>
    <span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time taken by approximate contraction with fixed truncation fidelity:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lower bound of the fidelity:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">fixed_fidelity_mps</span><span class="o">.</span><span class="n">fidelity</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="contraction-algorithms">
<h2>Contraction algorithms<a class="headerlink" href="#contraction-algorithms" title="Link to this heading">¶</a></h2>
<p>We currently offer two MPS-based simulation algorithms:<br></p>
<ul class="simple">
<li><p><strong>MPSxGate</strong>: Apply gates one by one to the MPS, canonicalising the MPS and truncating when necessary. In particular, we implemented the algorithm from the following paper: https://arxiv.org/abs/2002.07730.<br></p></li>
<li><p><strong>MPSxMPO</strong>: Maintain two MPS copies of the state as it evolves, one updated eagerly using the <strong>MPSxGate</strong> method and the other updated in batches of up to <code class="docutils literal notranslate"><span class="pre">k</span></code> layers of two-qubit gates. Whenever the second MPS is updated, both copies are synchronised and an optimisation algorithm is applied to increase the fidelity of the state. This algorithm is often referred to as DMRG-like simulation. In particular, we implemented the algorithm from the following paper: https://arxiv.org/abs/2207.05612.<br>
The <code class="docutils literal notranslate"><span class="pre">MPSxGate</span></code> algorithm is the one we have been using for all of the examples above. In comparison, the <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> algorithm provides the user with two new parameters to tune:<br></p></li>
<li><p><strong>k</strong>: The maximum number of layers the MPO is allowed to have before being contracted. Increasing this might increase fidelity, but it will also increase resource requirements exponentially. Default value is <code class="docutils literal notranslate"><span class="pre">4</span></code>.<br></p></li>
<li><p><strong>optim_delta</strong>: Stopping criteria for the optimisation when contracting the <code class="docutils literal notranslate"><span class="pre">k</span></code> layers of MPO. Stops when the increase of fidelity between iterations is smaller than <code class="docutils literal notranslate"><span class="pre">optim_delta</span></code>. Default value is <code class="docutils literal notranslate"><span class="pre">1e-5</span></code>.<br>
Both <code class="docutils literal notranslate"><span class="pre">k</span></code> and <code class="docutils literal notranslate"><span class="pre">optim_delta</span></code> can be set via <code class="docutils literal notranslate"><span class="pre">Config</span></code>. Below we compare <code class="docutils literal notranslate"><span class="pre">MPSxGate</span></code> versus <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> with default parameters and <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> with more resource-hungry parameters. The circuit used is the same as in the previous section.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">chi</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fixed_fidelity_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span>
        <span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxGate</span><span class="p">,</span> <span class="n">config</span>
    <span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MPSxGate&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Time taken: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Lower bound of the fidelity: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">fixed_fidelity_mps</span><span class="o">.</span><span class="n">fidelity</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">chi</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fixed_fidelity_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span>
        <span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxMPO</span><span class="p">,</span> <span class="n">config</span>
    <span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MPSxMPO, default parameters&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Time taken: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Lower bound of the fidelity: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">fixed_fidelity_mps</span><span class="o">.</span><span class="n">fidelity</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">optim_delta</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fixed_fidelity_mps</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span>
        <span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxMPO</span><span class="p">,</span> <span class="n">config</span>
    <span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MPSxMPO, custom parameters&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Time taken: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Lower bound of the fidelity: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">fixed_fidelity_mps</span><span class="o">.</span><span class="n">fidelity</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note</strong>: <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> also admits truncation policy in terms of <code class="docutils literal notranslate"><span class="pre">truncation_fidelity</span></code> instead of <code class="docutils literal notranslate"><span class="pre">chi</span></code>.</p>
</section>
<section id="using-the-logger">
<h2>Using the logger<a class="headerlink" href="#using-the-logger" title="Link to this heading">¶</a></h2>
<p>You can request a verbose log to be produced during simulation, by assigning the <code class="docutils literal notranslate"><span class="pre">loglevel</span></code> argument when creating a <code class="docutils literal notranslate"><span class="pre">Config</span></code> instance. Currently, two log levels are supported (other than default, which is silent):<br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">logging.INFO</span></code> will print information about progress percent, memory currently occupied by the MPS and current fidelity. Additionally, some high level information of the current stage of the simulation is provided, such as when <code class="docutils literal notranslate"><span class="pre">MPSxMPO</span></code> is applying optimisation sweeps.<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logging.DEBUG</span></code> provides all of the messages from the loglevel above plus detailed information of the current operation being carried out and the values of important variables.<br>
<strong>Note</strong>: Due to technical issues with the <code class="docutils literal notranslate"><span class="pre">logging</span></code> module and Jupyter notebooks we need to reload the <code class="docutils literal notranslate"><span class="pre">logging</span></code> module. When working with python scripts and command line, just doing <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">logging</span></code> is enough.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>  <span class="c1"># Not needed in Python 2</span>
<span class="kn">import</span> <span class="nn">logging</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">logging</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>An example of the use of <code class="docutils literal notranslate"><span class="pre">logging.INFO</span></code> is provided below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CuTensorNetHandle</span><span class="p">()</span> <span class="k">as</span> <span class="n">libhandle</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">truncation_fidelity</span><span class="o">=</span><span class="mf">0.999</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">simulate</span><span class="p">(</span><span class="n">libhandle</span><span class="p">,</span> <span class="n">circuit</span><span class="p">,</span> <span class="n">SimulationAlgorithm</span><span class="o">.</span><span class="n">MPSxMPO</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ttn_tutorial.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Tree Tensor Network (TTN) Tutorial</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="general_state_tutorial.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><code class="docutils literal notranslate"><span class="pre">GeneralState</span></code> Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Matrix Product State (MPS) Tutorial</a><ul>
<li><a class="reference internal" href="#introduction">Introduction<br></a></li>
<li><a class="reference internal" href="#basic-functionality-and-exact-simulation">Basic functionality and exact simulation<br></a><ul>
<li><a class="reference internal" href="#obtain-an-amplitude-from-an-mps">Obtain an amplitude from an MPS<br></a></li>
<li><a class="reference internal" href="#sampling-from-an-mps">Sampling from an MPS<br></a></li>
<li><a class="reference internal" href="#inner-products">Inner products<br></a></li>
<li><a class="reference internal" href="#mid-circuit-measurements-and-classical-control">Mid-circuit measurements and classical control<br></a></li>
<li><a class="reference internal" href="#two-qubit-gates-acting-on-non-adjacent-qubits">Two-qubit gates acting on non-adjacent qubits<br></a></li>
</ul>
</li>
<li><a class="reference internal" href="#approximate-simulation">Approximate simulation<br></a></li>
<li><a class="reference internal" href="#contraction-algorithms">Contraction algorithms</a></li>
<li><a class="reference internal" href="#using-the-logger">Using the logger</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>