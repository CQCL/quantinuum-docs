<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPQ1FTGDL3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPQ1FTGDL3');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Integrating pytket into Qiskit software" href="qiskit_integration.html" /><link rel="prev" title="Comparison of the simulators available through TKET" href="comparing_simulators.html" />

    <link rel="shortcut icon" href="../../_static/quantinuum_favicon.svg"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>How to create your own Backend using pytket - pytket user guide</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<link rel="stylesheet" href="../../_static/tokens.css"/>
<link rel="stylesheet" href="../../_static/styles.css"/>
<link rel="stylesheet" href="../../_static/tailwind.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="preload"
as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<style>  
  .sidebar-sticky {
    top: calc(3.5rem - 0px);
    height: calc(100vh - 3.5rem);
  }
  
  @media (min-width: 97em) {
    html {
      font-size: 100% !important;
    }
  }
  
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>
<!-- <script type="text/javascript" src="../../_static/syncTheme.global.js" ></script> -->
 <!--Force light mode -->
 <script>document.body.setAttribute('data-theme','light')</script>
<nav style="position:fixed;top:0;z-index:1021;width:100%;">
    <div class="nexus-nav"></div>
</nav>
<script type="text/javascript" src="../../_static/injectNav.global.js"></script>
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pytket user guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">pytket user guide</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_intro.html">What is tket?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_circuit.html">Circuit Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_backend.html">Running on Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_compiler.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_noise.html">Noise and the Quantum Circuit Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_assertion.html">Assertion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/manual_zx.html">ZX Diagrams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_analysis_example.html">Circuit analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/circuit_generation_example.html">Circuit generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_construction/conditional_gate_example.html">Conditional gates</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends_example.html">TKET <code class="docutils literal notranslate"><span class="pre">Backend</span></code> tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparing_simulators.html">Comparison of the simulators available through TKET</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">How to create your own <code class="docutils literal notranslate"><span class="pre">Backend</span></code> using <code class="docutils literal notranslate"><span class="pre">pytket</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="qiskit_integration.html">Integrating <code class="docutils literal notranslate"><span class="pre">pytket</span></code> into Qiskit software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/compilation_example.html">Compilation passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/contextual_optimisation.html">Contextual optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/mapping_example.html">Qubit mapping and routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circuit_compilation/symbolics_example.html">Symbolic compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/ansatz_sequence_example.html">Ansatz sequencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/entanglement_swapping.html">Iterated entanglement swapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/expectation_value_example.html">Expectation values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/measurement_reduction_example.html">Advanced expectation values and measurement reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/phase_estimation.html">Quantum Phase Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/pytket-qujax-classification.html">Binary classification using <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/pytket-qujax_heisenberg_vqe.html">VQE example with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/pytket-qujax_qaoa.html">Symbolic circuits with <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms_and_protocols/ucc_vqe.html">VQE with UCC ansatz</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/examples/backends/creating_backends.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="how-to-create-your-own-backend-using-pytket">
<h1>How to create your own <code class="docutils literal notranslate"><span class="pre">Backend</span></code> using <code class="docutils literal notranslate"><span class="pre">pytket</span></code><a class="headerlink" href="#how-to-create-your-own-backend-using-pytket" title="Link to this heading">¶</a></h1>
<p><strong>Download this notebook - <a class="reference download internal" download="" href="../../_downloads/0d06ad65db22bb43cf80126139640a9f/creating_backends.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">creating_backends.ipynb</span></code></a></strong></p>
<p>In this tutorial, we will focus on:</p>
<ul class="simple">
<li><p>the components of the abstract <code class="docutils literal notranslate"><span class="pre">Backend</span></code> class;</p></li>
<li><p>adaptations for statevector simulation versus measurement sampling.</p></li>
</ul>
<p>To run this example, you will only need the core <code class="docutils literal notranslate"><span class="pre">pytket</span></code> package.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pytket</span></code> framework currently has direct integration with the largest variety of devices and simulators out of any quantum software platform, but this is certainly not a complete collection. New quantum backends are frequently being rolled out as more device manufacturers bring their machines online and advanced in simulation research give rise to many purpose-built simulators for fast execution of specific circuit fragments.</p>
<p>If you have something that can take circuits (i.e. a sequence of gates) and run/simulate them, adding integration with <code class="docutils literal notranslate"><span class="pre">pytket</span></code> connects it to a great number of users and enables existing software solutions to immediately take advantage of your new backend. This reach is further extended beyond just software written with <code class="docutils literal notranslate"><span class="pre">pytket</span></code> by exploiting its integration with the rest of the quantum software ecosystem, such as via the <code class="docutils literal notranslate"><span class="pre">TketBackend</span></code> wrapper to use the new backend within Qiskit projects.</p>
<p>This notebook will take a toy simulator and demonstrate how to write each component of the <code class="docutils literal notranslate"><span class="pre">Backend</span></code> class to make it work with the rest of <code class="docutils literal notranslate"><span class="pre">pytket</span></code>. We’ll start by defining the internal representation of a circuit that our simulator will use. Rather than common gates, this example will use exponentiated Pauli tensors (<span class="math notranslate nohighlight">\(e^{-i \theta P}\)</span> for <span class="math notranslate nohighlight">\(P \in \{I, X, Y, Z\}^n\)</span>) as its basic operation, which are universal for unitary circuits. To keep it simple, we will ignore measurements for now and just consider unitaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Qubit</span>
<span class="kn">from</span> <span class="nn">pytket.pauli</span> <span class="kn">import</span> <span class="n">QubitPauliString</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A minimal representation of a unitary circuit&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qubits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Qubit</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a circuit over some set of qubits</span>
<span class="sd">        :param qubits: The list of qubits in the circuit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qubits</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">add_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qps</span><span class="p">:</span> <span class="n">QubitPauliString</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a gate to the end of the circuit e^{-0.5i * qps * angle}</span>
<span class="sd">        :param qps: Pauli string to rotate around</span>
<span class="sd">        :param angle: Angle of rotation in radians</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">qps</span><span class="p">,</span> <span class="n">angle</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To simulate these, it is enough to generate the matrix of these exponentials and apply them in sequence to our initial state. Calculating these matrix exponentials is easy since we can exploit the following property: if an operator <span class="math notranslate nohighlight">\(A\)</span> satisfies <span class="math notranslate nohighlight">\(A^2 = I\)</span>, then <span class="math notranslate nohighlight">\(e^{i\theta A} = \mathrm{cos}(\theta)I + i \mathrm{sin}(\theta) A\)</span>. This works for any tensor of Pauli matrices. Furthermore, since each Pauli matrix is some combination of a diagonal matrix and a permutation matrix, they benefit greatly from a sparse matrix representation, which we can obtain from the <code class="docutils literal notranslate"><span class="pre">QubitPauliString</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">MySimulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A minimal statevector simulator for unitary circuits&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qubits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Qubit</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise a statevector, setting all qubits to the |0❭ state.</span>
<span class="sd">        We treat qubits[0] as the most-significant qubit</span>
<span class="sd">        :param qubits: The list of qubits in the circuit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qubits</span> <span class="o">=</span> <span class="n">qubits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qstate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qstate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">def</span> <span class="nf">apply_Pauli_rot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qps</span><span class="p">:</span> <span class="n">QubitPauliString</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies e^{-0.5i * qps * angle} to the state</span>
<span class="sd">        :param qps: Pauli to rotate around</span>
<span class="sd">        :param angle: Angle of rotation in radians</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pauli_tensor</span> <span class="o">=</span> <span class="n">qps</span><span class="o">.</span><span class="n">to_sparse_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qubits</span><span class="p">)</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qstate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qstate</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="n">exponent</span>
        <span class="p">)</span> <span class="o">*</span> <span class="n">pauli_tensor</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qstate</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_mycircuit</span><span class="p">(</span><span class="n">circ</span><span class="p">:</span> <span class="n">MyCircuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gives the state after applying the circuit to the all-|0❭ state</span>
<span class="sd">    :param circ: The circuit to simulate</span>
<span class="sd">    :return: The final statevector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">MySimulator</span><span class="p">(</span><span class="n">circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">circ</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">apply_Pauli_rot</span><span class="p">(</span><span class="n">qps</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">_qstate</span>
</pre></div>
</div>
</div>
</div>
<p>And that’s all we need for a basic simulator! We can check that this works by trying to generate a Bell state (up to global phase).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.pauli</span> <span class="kn">import</span> <span class="n">Pauli</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">MyCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="c1"># Hadamard on Qubit(0)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># CX with control Qubit(0) and target Qubit(1)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">}),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">run_mycircuit</span><span class="p">(</span><span class="n">circ</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 5.00000000e-01-5.00000000e-01j -8.32667268e-17-1.11022302e-16j
  0.00000000e+00+0.00000000e+00j  5.00000000e-01-5.00000000e-01j]
</pre></div>
</div>
</div>
</div>
<p>A useful first step to integrating this is to define a conversion from the <code class="docutils literal notranslate"><span class="pre">pytket.Circuit</span></code> class to the <code class="docutils literal notranslate"><span class="pre">MyCircuit</span></code> class. In most cases, this will just amount to converting one gate at a time by a simple syntax map. We need not specify how to convert every possible <code class="docutils literal notranslate"><span class="pre">OpType</span></code>, since we can rely on the compilation passes in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> to map the circuit into the required gate set as long as it is universal. For this example, the definitions of <code class="docutils literal notranslate"><span class="pre">OpType.Rx</span></code>, <code class="docutils literal notranslate"><span class="pre">OpType.Ry</span></code>, <code class="docutils literal notranslate"><span class="pre">OpType.Rz</span></code>, and <code class="docutils literal notranslate"><span class="pre">OpType.ZZMax</span></code> all match the form of a single Pauli exponential.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">OpType</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tk_to_mycircuit</span><span class="p">(</span><span class="n">tkc</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MyCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a pytket Circuit to a MyCircuit object.</span>
<span class="sd">    Supports Rz, Rx, Ry, and ZZMax gates.</span>
<span class="sd">    :param tkc: The Circuit to convert</span>
<span class="sd">    :return: An equivalent MyCircuit object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">MyCircuit</span><span class="p">(</span><span class="n">tkc</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">tkc</span><span class="p">:</span>
        <span class="n">optype</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot convert optype to MyCircuit: &quot;</span><span class="p">,</span> <span class="n">optype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circ</span>
</pre></div>
</div>
</div>
</div>
<p>Now we turn to the <code class="docutils literal notranslate"><span class="pre">Backend</span></code> class. This provides a uniform API to submit <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> objects for evaluation, typically returning either a statevector or a set of measurement shots. It also captures all of the information needed for compilation and asynchronous job management.</p>
<p>We will make a subclass of <code class="docutils literal notranslate"><span class="pre">Backend</span></code> for our statevector simulator. The <code class="docutils literal notranslate"><span class="pre">_supports_state</span></code> flag lets the methods of the abstract <code class="docutils literal notranslate"><span class="pre">Backend</span></code> class know that this implementation supports statevector simulation. We also set <code class="docutils literal notranslate"><span class="pre">_persistent_handles</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> since this <code class="docutils literal notranslate"><span class="pre">Backend</span></code> will not be able to retrieve results from a previous Python session.</p>
<p>Since we do not need to connect to a remote process for the simulator, the constructor doesn’t need to set anything up. The base <code class="docutils literal notranslate"><span class="pre">Backend</span></code> constructor will initialise the <code class="docutils literal notranslate"><span class="pre">_cache</span></code> field for storing job data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends</span> <span class="kn">import</span> <span class="n">Backend</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBackend</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pytket Backend wrapping around the MySimulator statevector simulator&quot;&quot;&quot;</span>
    <span class="n">_supports_state</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_persistent_handles</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new instance of the MyBackend class&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Most <code class="docutils literal notranslate"><span class="pre">Backend</span></code>s will only support a small fragment of the <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> language, either through implementation limitations or since a specific presentation is universal. It is helpful to keep this information in the <code class="docutils literal notranslate"><span class="pre">Backend</span></code> object itself so that users can clearly see how a <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> needs to look before it can be successfully run. The <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> classes in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> can capture many common restrictions. The idea behind the <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code> list is that any <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> satisfying every <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> in the list can be run on the <code class="docutils literal notranslate"><span class="pre">Backend</span></code> successfully as it is.</p>
<p>However, a typical high-level user will not be writing <code class="docutils literal notranslate"><span class="pre">Circuit</span></code>s that satisfies all of the <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code>, preferring instead to use the model that is most natural for the algorithm they are implementing. Providing a <code class="docutils literal notranslate"><span class="pre">default_compilation_pass</span></code> gives users an easy starting point for compiling an arbitrary <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> into a form that can be executed (when not blocked by paradigm constraints like <code class="docutils literal notranslate"><span class="pre">NoMidMeasurePredicate</span></code> or <code class="docutils literal notranslate"><span class="pre">NoClassicalControlPredicate</span></code> that cannot easily be solved by compilation).</p>
<p>You can provide several options using the <code class="docutils literal notranslate"><span class="pre">optimisation_level</span></code> argument. We tend to use <code class="docutils literal notranslate"><span class="pre">0</span></code> for very basic compilation with no optimisation applied, <code class="docutils literal notranslate"><span class="pre">1</span></code> for the inclusion of fast optimisations (e.g. <code class="docutils literal notranslate"><span class="pre">SynthesiseIBM</span></code> is a pre-defined sequence of optimisation passes that scales well with circuit size), and <code class="docutils literal notranslate"><span class="pre">2</span></code> for heavier optimisation (e.g. <code class="docutils literal notranslate"><span class="pre">FullPeepholeOptimise</span></code> incorporates <code class="docutils literal notranslate"><span class="pre">SynthesiseTket</span></code> alongside some extra passes that may take longer for large circuits).</p>
<p>When designing these compilation pass sequences for a given <code class="docutils literal notranslate"><span class="pre">Backend</span></code>, it can be a good idea to start with the passes that solve individual constraints from <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code> (like <code class="docutils literal notranslate"><span class="pre">FullMappingPass</span></code> for <code class="docutils literal notranslate"><span class="pre">ConnectivityPredicate</span></code> or <code class="docutils literal notranslate"><span class="pre">RebaseX</span></code> for <code class="docutils literal notranslate"><span class="pre">GateSetPredicate</span></code>), and find an ordering such that no later pass invalidates the work of an earlier one.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">MyBackend</span></code>, we will need to enforce that our circuits are expressed entirely in terms of <code class="docutils literal notranslate"><span class="pre">OpType.Rx</span></code>, <code class="docutils literal notranslate"><span class="pre">OpType.Ry</span></code>, <code class="docutils literal notranslate"><span class="pre">OpType.Rz</span></code>, and <code class="docutils literal notranslate"><span class="pre">OpType.ZZMax</span></code> gates which we can solve using <code class="docutils literal notranslate"><span class="pre">RebaseCustom</span></code>. Note that we omit <code class="docutils literal notranslate"><span class="pre">OpType.Measure</span></code> since we can only run pure quantum circuits.</p>
<p>The standard docstrings for these and other abstract methods can be seen in the documentation for the <a class="reference external" href="https://docs.quantinuum.com/tket/api-docs/backends.html#pytket.backends.Backend" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backend</span></code></a> abstract base class .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.predicates</span> <span class="kn">import</span> <span class="n">Predicate</span><span class="p">,</span> <span class="n">GateSetPredicate</span><span class="p">,</span> <span class="n">NoClassicalBitsPredicate</span>
<span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BasePass</span><span class="p">,</span>
    <span class="n">SequencePass</span><span class="p">,</span>
    <span class="n">DecomposeBoxes</span><span class="p">,</span>
    <span class="n">SynthesiseTket</span><span class="p">,</span>
    <span class="n">FullPeepholeOptimise</span><span class="p">,</span>
    <span class="n">RebaseCustom</span><span class="p">,</span>
    <span class="n">SquashCustom</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">required_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The minimum set of predicates that a circuit must satisfy before it can</span>
<span class="sd">    be successfully run on this backend.</span>
<span class="sd">    :return: Required predicates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">NoClassicalBitsPredicate</span><span class="p">(),</span>
        <span class="n">GateSetPredicate</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">,</span>
                <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">,</span>
                <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">,</span>
                <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">preds</span>
</pre></div>
</div>
</div>
</div>
<p>Every <code class="docutils literal notranslate"><span class="pre">Backend</span></code> must define a rebasing method, which will normally be called from its default compilation passes (see below), but which may also be called independently. Given the target gate set, it is usually straightforward to define this using the <code class="docutils literal notranslate"><span class="pre">RebaseCustom</span></code> pass, with a couple of helpers defining rebase of an <code class="docutils literal notranslate"><span class="pre">OpType.CX</span></code> and a general <code class="docutils literal notranslate"><span class="pre">OpType.TK1</span></code> gate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cx_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">Sdg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">Sdg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">Vdg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">Vdg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">Sdg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cx_circ</span><span class="o">.</span><span class="n">add_phase</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Sdg q[0]; V q[1]; Sdg q[1]; Vdg q[1]; ZZMax q[0], q[1]; Vdg q[1]; Sdg q[1]; ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circ</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rebase</span> <span class="o">=</span> <span class="n">RebaseCustom</span><span class="p">({</span><span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">,</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">,</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">,</span> <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">},</span> <span class="n">cx_circ</span><span class="p">,</span> <span class="n">sq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">default_compilation_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BasePass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A suggested compilation pass that will guarantee the resulting circuit</span>
<span class="sd">    will be suitable to run on this backend with as few preconditions as</span>
<span class="sd">    possible.</span>
<span class="sd">    :param optimisation_level: The level of optimisation to perform during</span>
<span class="sd">        compilation. Level 0 just solves the device constraints without</span>
<span class="sd">        optimising. Level 1 additionally performs some light optimisations.</span>
<span class="sd">        Level 2 adds more intensive optimisations that can increase compilation</span>
<span class="sd">        time for large circuits. Defaults to 1.</span>
<span class="sd">    :return: Compilation pass guaranteeing required predicates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">optimisation_level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">squash</span> <span class="o">=</span> <span class="n">SquashCustom</span><span class="p">({</span><span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">,</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">,</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">},</span> <span class="n">sq</span><span class="p">)</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">DecomposeBoxes</span><span class="p">()]</span>  <span class="c1"># Decompose boxes into basic gates</span>
    <span class="k">if</span> <span class="n">optimisation_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SynthesiseTket</span><span class="p">())</span>  <span class="c1"># Optional fast optimisation</span>
    <span class="k">elif</span> <span class="n">optimisation_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FullPeepholeOptimise</span><span class="p">())</span>  <span class="c1"># Optional heavy optimisation</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rebase</span><span class="p">)</span>  <span class="c1"># Map to target gate set</span>
    <span class="k">if</span> <span class="n">optimisation_level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">squash</span><span class="p">)</span>  <span class="c1"># Optionally simplify 1qb gate chains within this gate set</span>
    <span class="k">return</span> <span class="n">SequencePass</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">backend_info</span></code> property is used for storing various properties of a backend. By default it provides all device information useful for compilation. Typically we would  make it return a class attribute <code class="docutils literal notranslate"><span class="pre">self._backend_info</span></code> that we initialise on construction, but we will define it at point of request here. We use a <code class="docutils literal notranslate"><span class="pre">FullyConnected</span></code> architecture producing an <code class="docutils literal notranslate"><span class="pre">Architecture</span></code> object with couplings between 4 qubits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends.backendinfo</span> <span class="kn">import</span> <span class="n">BackendInfo</span>
<span class="kn">from</span> <span class="nn">pytket.architecture</span> <span class="kn">import</span> <span class="n">FullyConnected</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">backend_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BackendInfo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">BackendInfo</span><span class="p">(</span>
        <span class="s2">&quot;MyBackend&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MySimulator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
        <span class="n">FullyConnected</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="p">{</span>
            <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">,</span>
            <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">,</span>
            <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">,</span>
            <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">,</span>
            <span class="n">OpType</span><span class="o">.</span><span class="n">Measure</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">supports_midcircuit_measurement</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">misc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;characterisation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Asynchronous job management is all managed through the <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> associated with a particular <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> that has been submitted. We can use it to inspect the status of the job to see if it has completed, or to look up the results if they are available.</p>
<p>For devices, <code class="docutils literal notranslate"><span class="pre">circuit_status</span></code> should query the job to see if it is in a queue, currently being executed, completed successfully, etc. The <code class="docutils literal notranslate"><span class="pre">CircuitStatus</span></code> class is mostly driven by the <code class="docutils literal notranslate"><span class="pre">StatusEnum</span></code> values, but can also contain messages to give more detailed feedback if available. For our simulator, we are not running things asynchronously, so a <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> has either not been run or it will have been completed.</p>
<p>Since a device API will probably define its own data type for job handles, the <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> definition is flexible enough to cover many possible data types so you can likely use the underlying job handle as the <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code>. The <code class="docutils literal notranslate"><span class="pre">_result_id_type</span></code> property specifies what data type a <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> for this <code class="docutils literal notranslate"><span class="pre">Backend</span></code> should look like. Since our simulator has no underlying job handle, we can just use a UUID string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends</span> <span class="kn">import</span> <span class="n">ResultHandle</span><span class="p">,</span> <span class="n">CircuitStatus</span><span class="p">,</span> <span class="n">StatusEnum</span><span class="p">,</span> <span class="n">CircuitNotRunError</span>
<span class="kn">from</span> <span class="nn">pytket.backends.resulthandle</span> <span class="kn">import</span> <span class="n">_ResultIdTuple</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">_result_id_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ResultIdTuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identifier type signature for ResultHandle for this backend.</span>
<span class="sd">    :return: Type signature (tuple of hashable types)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">circuit_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">ResultHandle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CircuitStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a CircuitStatus reporting the status of the circuit execution</span>
<span class="sd">    corresponding to the ResultHandle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CircuitStatus</span><span class="p">(</span><span class="n">StatusEnum</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">CircuitNotRunError</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And finally, we have the method that actually submits a job for execution. <code class="docutils literal notranslate"><span class="pre">process_circuits</span></code> should take a collection of (compiled) <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> objects, process them and return a <code class="docutils literal notranslate"><span class="pre">ResultHandle</span></code> for each <code class="docutils literal notranslate"><span class="pre">Circuit</span></code>. If execution is synchronous, then this can simply wait until it is finished, store the result in <code class="docutils literal notranslate"><span class="pre">_cache</span></code> and return. For backends that support asynchronous jobs, you will need to set up an event to format and store the result on completion.</p>
<p>It is recommended to use the <code class="docutils literal notranslate"><span class="pre">valid_check</span></code> parameter to control a call to <code class="docutils literal notranslate"><span class="pre">Backend._check_all_circuits()</span></code>, which will raise an exception if any of the circuits do not satisfy everything in <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_cache</span></code> fields stores all of the information about current jobs that have been run. When a job has finished execution, the results are expected to be stored in <code class="docutils literal notranslate"><span class="pre">_cache[handle][&quot;result&quot;]</span></code>, though it can also be used to store other data about the job such as some information about the <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> required to properly format the results. Methods like <code class="docutils literal notranslate"><span class="pre">Backend.get_result()</span></code> and <code class="docutils literal notranslate"><span class="pre">Backend.empty_cache()</span></code> expect to interact with the results of a given job in this way.</p>
<p>The final output of the execution is stored in a <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> object. This captures enough information about the results to reinterpret it in numerous ways, such as requesting the statevector in a specific qubit ordering or converting a complete shot table to a summary of the counts. If we create a <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> with quantum data (e.g. a statevector or unitary), we must provide the <code class="docutils literal notranslate"><span class="pre">Qubit</span></code> ids in order from most-significant to least-significant with regards to indexing the state. Similarly, creating one with classical readouts (e.g. a shot table or counts summary), we give the <code class="docutils literal notranslate"><span class="pre">Bit</span></code> ids in the order they appear in a readout (left-to-right).</p>
<p>For a statevector simulation, we should also take into account the global phase stored in the <code class="docutils literal notranslate"><span class="pre">Circuit</span></code> object and any implicit qubit permutations, since these become observable when inspecting the quantum state. We can handle the qubit permutation by changing the order in which we pass the <code class="docutils literal notranslate"><span class="pre">Qubit</span></code> ids into the <code class="docutils literal notranslate"><span class="pre">BackendResult</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.backends.backendresult</span> <span class="kn">import</span> <span class="n">BackendResult</span>
<span class="kn">from</span> <span class="nn">pytket.utils.results</span> <span class="kn">import</span> <span class="n">KwargTypes</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_circuits</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">circuits</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Circuit</span><span class="p">],</span>
    <span class="n">n_shots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">valid_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">KwargTypes</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ResultHandle</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit circuits to the backend for running. The results will be stored</span>
<span class="sd">    in the backend&#39;s result cache to be retrieved by the corresponding</span>
<span class="sd">    get_&lt;data&gt; method.</span>
<span class="sd">    Use keyword arguments to specify parameters to be used in submitting circuits</span>
<span class="sd">    See specific Backend derived class for available parameters, from the following</span>
<span class="sd">    list:</span>
<span class="sd">    * `seed`: RNG seed for simulators</span>
<span class="sd">    :param circuits: Circuits to process on the backend.</span>
<span class="sd">    :param n_shots: Number of shots to run per circuit. None is to be used</span>
<span class="sd">        for state/unitary simulators. Defaults to None.</span>
<span class="sd">    :param valid_check: Explicitly check that all circuits satisfy all required</span>
<span class="sd">        predicates to run on the backend. Defaults to True</span>
<span class="sd">    :return: Handles to results for each input circuit, as an interable in</span>
<span class="sd">        the same order as the circuits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circuit_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">circuits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valid_check</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_circuits</span><span class="p">(</span><span class="n">circuit_list</span><span class="p">)</span>
    <span class="n">handle_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="n">circuit_list</span><span class="p">:</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">ResultHandle</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
        <span class="n">mycirc</span> <span class="o">=</span> <span class="n">tk_to_mycircuit</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">run_mycircuit</span><span class="p">(</span><span class="n">mycirc</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">circuit</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
        <span class="n">implicit_perm</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">implicit_qubit_permutation</span><span class="p">()</span>
        <span class="n">res_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="n">implicit_perm</span><span class="p">[</span><span class="n">qb</span><span class="p">]</span> <span class="k">for</span> <span class="n">qb</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">qubits</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">BackendResult</span><span class="p">(</span><span class="n">q_bits</span><span class="o">=</span><span class="n">res_qubits</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">res</span><span class="p">}</span>
        <span class="n">handle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handle_list</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s redefine our <code class="docutils literal notranslate"><span class="pre">MyBackend</span></code> class to use these methods to finish it off.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBackend</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pytket Backend wrapping around the MySimulator statevector simulator&quot;&quot;&quot;</span>
    <span class="n">_supports_state</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_persistent_handles</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new instance of the MyBackend class&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="n">required_predicates</span> <span class="o">=</span> <span class="n">required_predicates</span>
    <span class="n">rebase_pass</span> <span class="o">=</span> <span class="n">rebase</span>
    <span class="n">default_compilation_pass</span> <span class="o">=</span> <span class="n">default_compilation_pass</span>
    <span class="n">_result_id_type</span> <span class="o">=</span> <span class="n">_result_id_type</span>
    <span class="n">circuit_status</span> <span class="o">=</span> <span class="n">circuit_status</span>
    <span class="n">process_circuits</span> <span class="o">=</span> <span class="n">process_circuits</span>
</pre></div>
</div>
</div>
</div>
<p>Our new <code class="docutils literal notranslate"><span class="pre">Backend</span></code> subclass is now complete, so let’s test it out. If you are planning on maintaining a backend class, it is recommended to set up some unit tests. The following tests will cover basic operation and integration with <code class="docutils literal notranslate"><span class="pre">pytket</span></code> utilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">BasisOrder</span><span class="p">,</span> <span class="n">Unitary1qBox</span>
<span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">CliffordSimp</span>
<span class="kn">from</span> <span class="nn">pytket.utils</span> <span class="kn">import</span> <span class="n">get_operator_expectation_value</span>
<span class="kn">from</span> <span class="nn">pytket.utils.operators</span> <span class="kn">import</span> <span class="n">QubitPauliOperator</span>
<span class="kn">import</span> <span class="nn">pytest</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_bell</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">process_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
        <span class="n">b</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_basisorder</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">process_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">BasisOrder</span><span class="o">.</span><span class="n">dlo</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_implicit_perm</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">CliffordSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">implicit_qubit_permutation</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">implicit_qubit_permutation</span><span class="p">()</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">process_circuits</span><span class="p">([</span><span class="n">c</span><span class="p">,</span> <span class="n">c1</span><span class="p">])</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_results</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">h1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">bo</span> <span class="ow">in</span> <span class="p">[</span><span class="n">BasisOrder</span><span class="o">.</span><span class="n">ilo</span><span class="p">,</span> <span class="n">BasisOrder</span><span class="o">.</span><span class="n">dlo</span><span class="p">]:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">bo</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">bo</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_compilation_pass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">opt_level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_unitary1qbox</span><span class="p">(</span><span class="n">Unitary1qBox</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CRz</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">valid_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="n">opt_level</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">valid_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_invalid_measures</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">valid_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_expectation_value</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}):</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">}):</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">}):</span> <span class="mf">0.8</span><span class="n">j</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">}):</span> <span class="o">-</span><span class="mf">0.4</span><span class="n">j</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MyBackend</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">get_operator_expectation_value</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Explicit calls are needed for this notebook. Normally pytest will just find these “test_X” methods when run from the command line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_bell</span><span class="p">()</span>
<span class="n">test_basisorder</span><span class="p">()</span>
<span class="n">test_implicit_perm</span><span class="p">()</span>
<span class="n">test_compilation_pass</span><span class="p">()</span>
<span class="n">test_invalid_measures</span><span class="p">()</span>
<span class="n">test_expectation_value</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To show how this compares to a sampling simulator, let’s extend our simulator to handle end-of-circuit measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sample_mycircuit</span><span class="p">(</span>
    <span class="n">circ</span><span class="p">:</span> <span class="n">MyCircuit</span><span class="p">,</span> <span class="n">qubits</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Qubit</span><span class="p">],</span> <span class="n">n_shots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the circuit on the all-|0❭ state and measures a set of qubits</span>
<span class="sd">    :param circ: The circuit to simulate</span>
<span class="sd">    :param qubits: The set of qubits to measure</span>
<span class="sd">    :param n_shots: The number of samples to take</span>
<span class="sd">    :param seed: Seed for the random number generator, defaults to no seed</span>
<span class="sd">    :return: Table of shots; each row is a shot, columns are qubit readouts in ascending Qubit order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">run_mycircuit</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
    <span class="n">cumulative_probs</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">shots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_shots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shots</span><span class="p">):</span>
        <span class="c1"># Pick a random point in the distribution</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># Find the corresponding readout</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative_probs</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
        <span class="c1"># Convert index to a binary array</span>
        <span class="c1"># `bin` maps e.g. index 6 to &#39;0b110&#39;</span>
        <span class="c1"># So we ignore the first two symbols and add leading 0s to make it a fixed length</span>
        <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">index</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">))</span>
        <span class="n">shots</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">])</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_shots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)))</span>
    <span class="n">target</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">circ</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">:</span>
            <span class="n">filtered</span><span class="p">[:,</span> <span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">shots</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">target</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">filtered</span>
</pre></div>
</div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">MyCircuit</span></code> doesn’t have a representation for measurement gates, our converter must return both the <code class="docutils literal notranslate"><span class="pre">MyCircuit</span></code> object and some way of capturing the measurements. Since we will also want to know how they map into our <code class="docutils literal notranslate"><span class="pre">Bit</span></code> ids, the simplest option is just a dictionary from <code class="docutils literal notranslate"><span class="pre">Qubit</span></code> to <code class="docutils literal notranslate"><span class="pre">Bit</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Bit</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tk_to_mymeasures</span><span class="p">(</span><span class="n">tkc</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">MyCircuit</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Qubit</span><span class="p">,</span> <span class="n">Bit</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a pytket Circuit to a MyCircuit object and a measurement map.</span>
<span class="sd">    Supports Rz, Rx, Ry, and ZZMax gates, as well as end-of-circuit measurements.</span>
<span class="sd">    :param tkc: The Circuit to convert</span>
<span class="sd">    :return: An equivalent MyCircuit object and a map from measured Qubit to the Bit containing the result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">MyCircuit</span><span class="p">(</span><span class="n">tkc</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
    <span class="n">measure_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">measured_units</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">set</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># Track measured Qubits/used Bits to identify mid-circuit measurement</span>
    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">tkc</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">measured_units</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Circuit contains a mid-circuit measurement&quot;</span><span class="p">)</span>
        <span class="n">optype</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">command</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">:</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">optype</span> <span class="o">==</span> <span class="n">OpType</span><span class="o">.</span><span class="n">Measure</span><span class="p">:</span>
            <span class="n">measure_map</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">measured_units</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">measured_units</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot convert optype to MyCircuit: &quot;</span><span class="p">,</span> <span class="n">optype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circ</span><span class="p">,</span> <span class="n">measure_map</span>
</pre></div>
</div>
</div>
</div>
<p>To build a <code class="docutils literal notranslate"><span class="pre">Backend</span></code> subclass for this sampling simulator, we only need to change how we write <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code> and <code class="docutils literal notranslate"><span class="pre">process_circuits</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.predicates</span> <span class="kn">import</span> <span class="n">NoMidMeasurePredicate</span><span class="p">,</span> <span class="n">NoClassicalControlPredicate</span>
<span class="kn">from</span> <span class="nn">pytket.utils.outcomearray</span> <span class="kn">import</span> <span class="n">OutcomeArray</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySampler</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pytket Backend wrapping around the MySimulator simulator with readout sampling&quot;&quot;&quot;</span>
    <span class="n">_supports_shots</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_supports_counts</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_persistent_handles</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new instance of the MySampler class&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="n">rebase_pass</span> <span class="o">=</span> <span class="n">rebase</span>
    <span class="n">default_compilation_pass</span> <span class="o">=</span> <span class="n">default_compilation_pass</span>
    <span class="n">_result_id_type</span> <span class="o">=</span> <span class="n">_result_id_type</span>
    <span class="n">circuit_status</span> <span class="o">=</span> <span class="n">circuit_status</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">required_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The minimum set of predicates that a circuit must satisfy before it can</span>
<span class="sd">        be successfully run on this backend.</span>
<span class="sd">        :return: Required predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">NoClassicalControlPredicate</span><span class="p">(),</span>
            <span class="n">NoMidMeasurePredicate</span><span class="p">(),</span>
            <span class="n">GateSetPredicate</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">OpType</span><span class="o">.</span><span class="n">Rx</span><span class="p">,</span>
                    <span class="n">OpType</span><span class="o">.</span><span class="n">Ry</span><span class="p">,</span>
                    <span class="n">OpType</span><span class="o">.</span><span class="n">Rz</span><span class="p">,</span>
                    <span class="n">OpType</span><span class="o">.</span><span class="n">ZZMax</span><span class="p">,</span>
                    <span class="n">OpType</span><span class="o">.</span><span class="n">Measure</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">preds</span>
    <span class="k">def</span> <span class="nf">process_circuits</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">circuits</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Circuit</span><span class="p">],</span>
        <span class="n">n_shots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">valid_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">KwargTypes</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ResultHandle</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submit circuits to the backend for running. The results will be stored</span>
<span class="sd">        in the backend&#39;s result cache to be retrieved by the corresponding</span>
<span class="sd">        get_&lt;data&gt; method.</span>
<span class="sd">        Use keyword arguments to specify parameters to be used in submitting circuits</span>
<span class="sd">        See specific Backend derived class for available parameters, from the following</span>
<span class="sd">        list:</span>
<span class="sd">        * `seed`: RNG seed for simulators</span>
<span class="sd">        :param circuits: Circuits to process on the backend.</span>
<span class="sd">        :param n_shots: Number of shots to run per circuit. None is to be used</span>
<span class="sd">            for state/unitary simulators. Defaults to None.</span>
<span class="sd">        :param valid_check: Explicitly check that all circuits satisfy all required</span>
<span class="sd">            predicates to run on the backend. Defaults to True</span>
<span class="sd">        :return: Handles to results for each input circuit, as an interable in</span>
<span class="sd">            the same order as the circuits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">circuit_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">circuits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_circuits</span><span class="p">(</span><span class="n">circuit_list</span><span class="p">)</span>
        <span class="n">handle_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="n">circuit_list</span><span class="p">:</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">ResultHandle</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
            <span class="n">mycirc</span><span class="p">,</span> <span class="n">measure_map</span> <span class="o">=</span> <span class="n">tk_to_mymeasures</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
            <span class="n">qubit_list</span><span class="p">,</span> <span class="n">bit_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">measure_map</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">qubit_shots</span> <span class="o">=</span> <span class="n">sample_mycircuit</span><span class="p">(</span>
                <span class="n">mycirc</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">qubit_list</span><span class="p">),</span> <span class="n">n_shots</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Pad shot table with 0 columns for unused bits</span>
            <span class="n">all_shots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_shots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">bits</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">all_shots</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubit_list</span><span class="p">)]</span> <span class="o">=</span> <span class="n">qubit_shots</span>
            <span class="n">res_bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">measure_map</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">qubit_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">circuit</span><span class="o">.</span><span class="n">bits</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bit_list</span><span class="p">:</span>
                    <span class="n">res_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">BackendResult</span><span class="p">(</span>
                <span class="n">c_bits</span><span class="o">=</span><span class="n">res_bits</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">OutcomeArray</span><span class="o">.</span><span class="n">from_readouts</span><span class="p">(</span><span class="n">all_shots</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">res</span><span class="p">}</span>
            <span class="n">handle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle_list</span>
</pre></div>
</div>
</div>
</div>
<p>Likewise, we run some basic tests to make sure it works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_sampler_bell</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MySampler</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">run_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">get_shots</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span> <span class="o">==</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">5</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_sampler_basisorder</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MySampler</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">run_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span> <span class="o">==</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">10</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">BasisOrder</span><span class="o">.</span><span class="n">dlo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">10</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_sampler_compilation_pass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MySampler</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">opt_level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_unitary1qbox</span><span class="p">(</span><span class="n">Unitary1qBox</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CRz</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">valid_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">optimisation_level</span><span class="o">=</span><span class="n">opt_level</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">valid_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_sampler_expectation_value</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}):</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">}):</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">Qubit</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">}):</span> <span class="mf">0.8</span><span class="n">j</span><span class="p">,</span>
            <span class="n">QubitPauliString</span><span class="p">({</span><span class="n">Qubit</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">}):</span> <span class="o">-</span><span class="mf">0.4</span><span class="n">j</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">MySampler</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">expectation</span> <span class="o">=</span> <span class="n">get_operator_expectation_value</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">expectation</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">expectation</span><span class="p">))</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span>
        <span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="nb">abs</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_sampler_bell</span><span class="p">()</span>
<span class="n">test_sampler_basisorder</span><span class="p">()</span>
<span class="n">test_sampler_compilation_pass</span><span class="p">()</span>
<span class="n">test_sampler_expectation_value</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Exercises:</p>
<ul class="simple">
<li><p>Add some extra gate definitions to the simulator and expand the accepted gate set of the backends. Start with some that are easily represented as exponentiated Pauli tensors like <code class="docutils literal notranslate"><span class="pre">OpType.YYPhase</span></code>. For a challenge, try adding <code class="docutils literal notranslate"><span class="pre">OpType.CCX</span></code> efficiently (it is possible to encode it using seven Pauli rotations).</p></li>
<li><p>Restrict the simulator to a limited qubit connectivity. Express this in the backends by modifying the <code class="docutils literal notranslate"><span class="pre">Architecture</span></code> property of the <code class="docutils literal notranslate"><span class="pre">BackendInfo</span></code> attribute object and adding to the <code class="docutils literal notranslate"><span class="pre">required_predicates</span></code>. Adjust the <code class="docutils literal notranslate"><span class="pre">default_compilation_pass</span></code> to solve for the connectivity.</p></li>
<li><p>The file <code class="docutils literal notranslate"><span class="pre">creating_backends_exercise.py</span></code> extends the simulators above to allow for mid-circuit measurement and conditional gates using a binary decision tree. Implement an appropriate converter and <code class="docutils literal notranslate"><span class="pre">Backend</span></code> class for this simulator.</p></li>
</ul>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="qiskit_integration.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Integrating <code class="docutils literal notranslate"><span class="pre">pytket</span></code> into Qiskit software</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="comparing_simulators.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Comparison of the simulators available through TKET</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              Copyright &#169; 2024 Quantinuum Ltd. All rights reserved.
            </div>
            <div class="terms" style="display:flex; gap:0.5rem; align-items:center; margin: 0.25rem 0rem;">
              <a href="https://www.quantinuum.com/privacy-statement" target="_blank">Privacy Statement</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/cookie-notice" target="_blank">Cookie Notice</a>
              <div role="separator">/</div>
              <a href="https://www.quantinuum.com/terms-conditions" target="_blank">Terms and Conditions</a>
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>